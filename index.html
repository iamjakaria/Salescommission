<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Arvin Controls | Fire Safety Engineering</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; overflow-x: hidden; background: #f3f4f6; }
        .tab-content { display: none; min-height: calc(150vh - 100px); }
        .tab-content.active { display: flex; flex-direction: column; }
        .invoice-sub-tab, .accounts-sub-tab { display: none; }
        .invoice-sub-tab.active, .accounts-sub-tab.active { display: block; }
        .btn-back:hover i { transform: translateX(-5px); transition: transform 0.3s ease; }
        .table-container { overflow-x: auto; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #ef4444; }
        
        .autocomplete-wrapper { position: relative; }
        .suggestions-list { 
            position: absolute; top: 100%; left: 0; right: 0; 
            background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem;
            max-height: 250px; overflow-y: auto; z-index: 1000; display: none;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }
        .suggestion-item { padding: 10px 12px; cursor: pointer; border-bottom: 1px solid #f3f4f6; }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover { background-color: #fffaf0; }
        .suggestion-name { font-weight: 600; font-size: 13px; color: #1f2937; display: block; }
        .suggestion-sub { font-size: 11px; color: #ef4444; display: block; margin-top: 1px; }
        .suggestion-desc { font-size: 11px; color: #f59e0b; display: block; margin-top: 1px; }

        /* animated 'Move top' button style */
        .move-top-btn {
            position: fixed; bottom: 30px; right: 30px; z-index: 999;
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white; border: none; border-radius: 60px; padding: 16px 24px;
            font-size: 1.2rem; font-weight: bold; box-shadow: 0 12px 20px -10px rgba(102,126,234,0.6);
            cursor: pointer; transition: all 0.4s ease; display: flex; align-items: center; gap: 10px;
            border: 2px solid rgba(255,255,255,0.5); backdrop-filter: blur(4px);
            animation: float 3s ease-in-out infinite;
        }
        .move-top-btn i { font-size: 1.4rem; transition: transform 0.3s; }
        .move-top-btn:hover { background: linear-gradient(145deg, #764ba2, #667eea); transform: scale(1.1) translateY(-5px); box-shadow: 0 20px 30px -5px #667eea; }
        .move-top-btn:hover i { transform: translateY(-8px); }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        #moveTopBtn { display: none; }

        /* login overlay */
        #loginOverlay {
            position: fixed; inset:0; background: white; z-index:10000;
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(2px); padding: 1rem;
        }
        .login-card { max-width: 360px; width:100%; background:#fff; border-radius:2rem; box-shadow:0 25px 50px -12px rgba(0,0,0,0.25); padding:2rem 1.5rem; border:1px solid #fee2e2; }
        .login-logo { width:80px; height:80px; background:#fee2e2; border-radius:40px; display:flex; align-items:center; justify-content:center; margin:0 auto 1rem; font-size:2.5rem; color:#dc2626; }
        .login-input { border:1px solid #d1d5db; border-radius:2rem; padding:1rem 1.5rem; width:100%; font-size:1rem; margin-bottom:1rem; background:#f9fafb; }
        .login-btn { background:#dc2626; color:white; border-radius:2rem; padding:1rem; font-weight:bold; width:100%; border:none; font-size:1.1rem; cursor:pointer; transition:0.2s; }
        .login-btn:hover { background:#b91c1c; }
        /* logout button – now moved below menu grid (centered) */
        .logout-btn-container {
            display: flex;
            justify-content: center;
            margin-top: 12px;
            margin-bottom: 8px;
        }
        .logout-btn {
            background:#ef4444; color:white; border:none; border-radius:40px; padding:0.5rem 1.5rem; font-size:14px; font-weight:bold;
            display:inline-flex; align-items:center; gap:8px; box-shadow:0 4px 8px rgba(239,68,68,0.3); border:1px solid rgba(255,255,255,0.3); backdrop-filter:blur(4px);
            cursor: pointer;
            transition: all 0.2s;
        }
        .logout-btn i { font-size:16px; }
        .logout-btn:hover { background:#b91c1c; transform: scale(1.02); }
        body.logged-in #loginOverlay { display: none; }
        body:not(.logged-in) .logout-btn-container { display: none; }

        /* nav sticks */
        nav { position: sticky; top: 0; z-index: 50; background: white; }

        /* new horizontal scroll cards for mobile */
        .stats-scroll-x {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            gap: 0.75rem;
            padding-bottom: 0.25rem;
            scrollbar-width: thin;
        }
        .stats-scroll-x > div {
            flex: 0 0 auto;
            width: 45%;
            min-width: 140px;
        }
        @media (min-width: 768px) {
            .stats-scroll-x > div {
                width: auto;
                flex: 1 1 0;
                min-width: 0;
            }
        }
        .stat-label {
            font-size: 0.6rem;
            line-height: 1rem;
            font-weight: 600;
            letter-spacing: 0.05em;
        }
        .stat-value {
            font-size: 1rem;
            line-height: 1.5rem;
            font-weight: 800;
        }
        
        .modal-close-btn {
            z-index: 101;
            position: relative;
        }

        .img-delete-icon { cursor: pointer; color: #dc2626; font-size: 12px; margin-left: 6px; }
        .img-delete-icon:hover { color: #b91c1c; }
        
        /* New styles for larger menu tabs in 2 columns */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            width: 100%;
            padding: 4px 0;
        }
        
        .menu-grid button {
            padding: 16px 8px;
            font-size: 14px;
            font-weight: 700;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .menu-grid button i {
            font-size: 20px;
            margin-bottom: 6px;
        }
        
        .menu-grid button span {
            font-size: 11px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .menu-grid button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: currentColor;
        }
        
        @media (min-width: 768px) {
            .menu-grid {
                gap: 16px;
                max-width: 800px;
                margin: 0 auto;
            }
            
            .menu-grid button {
                padding: 20px 12px;
            }
            
            .menu-grid button i {
                font-size: 24px;
            }
            
            .menu-grid button span {
                font-size: 12px;
            }
        }

        .developer-credit {
            text-align: center;
            font-size: 10px;
            color: #dc2626;
            margin-top: 8px;
            margin-bottom: 24px;
            line-height: 1.3;
            letter-spacing: 0.3px;
            opacity: 0.9;
            border-top: 1px dashed #dc2626;
            padding-top: 10px;
            width: 100%;
        }
        .developer-credit .phone {
            font-weight: 600;
            color: #b91c1c;
            font-size: 11px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- LOGIN OVERLAY -->
    <div id="loginOverlay">
        <div class="login-card">
            <div class="login-logo"><i class="fas fa-fire-extinguisher"></i></div>
            <h2 class="text-center text-2xl font-bold text-red-600 mb-6">ARVIN CONTROLS</h2>
            <p class="text-center text-xs uppercase tracking-wider text-gray-500 mb-4">Fire Safety Engineering</p>
            <input type="text" id="loginId" placeholder="Login ID" class="login-input" value="" autocomplete="off">
            <input type="password" id="loginPass" placeholder="Password" class="login-input" autocomplete="off">
            <button class="login-btn" onclick="performLogin()"><i class="fas fa-lock-open mr-2"></i> UNLOCK</button>
            <p class="text-center text-[10px] text-gray-400 mt-4">authorised personnel only</p>
        </div>
    </div>

    <!-- Animated Move Top Button (visible on tabs) -->
    <button id="moveTopBtn" class="move-top-btn" onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">
        <i class="fas fa-arrow-up"></i> <span>TOP</span>
    </button>

    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-10">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-4">
                <div class="text-2xl font-bold text-red-600 flex items-center cursor-pointer" onclick="showDashboard()">
                    <i class="fas fa-fire-extinguisher mr-2"></i> <span id="nav-company-name">ARVIN CONTROLS</span>
                </div>
                
                <!-- Menu grid: 2 columns justified -->
                <div id="nav-grid" class="menu-grid">
                    <button onclick="openTab('clients')" class="bg-red-50 text-red-600 hover:bg-red-600 hover:text-white border-red-200">
                        <i class="fas fa-users text-lg mb-1"></i>
                        <span>Clients</span>
                    </button>
                    <button onclick="openTab('products')" class="bg-orange-50 text-orange-600 hover:bg-orange-600 hover:text-white border-orange-200">
                        <i class="fas fa-boxes text-lg mb-1"></i>
                        <span>Products</span>
                    </button>
                    <button onclick="openTab('suppliers')" class="bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white border-blue-200">
                        <i class="fas fa-truck text-lg mb-1"></i>
                        <span>Supplier</span>
                    </button>
                    <button onclick="openTab('inventory')" class="bg-emerald-50 text-emerald-600 hover:bg-emerald-600 hover:text-white border-emerald-200">
                        <i class="fas fa-warehouse text-lg mb-1"></i>
                        <span>Inventory</span>
                    </button>
                    <button onclick="openTab('invoice')" class="bg-yellow-50 text-yellow-600 hover:bg-yellow-600 hover:text-white border-yellow-200">
                        <i class="fas fa-file-invoice-dollar text-lg mb-1"></i>
                        <span>Invoice</span>
                    </button>
                    <button onclick="openTab('accounts')" class="bg-purple-50 text-purple-600 hover:bg-purple-600 hover:text-white border-purple-200">
                        <i class="fas fa-calculator text-lg mb-1"></i>
                        <span>Accounts</span>
                    </button>
                    <button onclick="openTab('quotation')" class="bg-indigo-50 text-indigo-600 hover:bg-indigo-600 hover:text-white border-indigo-200">
                        <i class="fas fa-file-alt text-lg mb-1"></i>
                        <span>Quotation</span>
                    </button>
                    <button onclick="openTab('delivery')" class="bg-teal-50 text-teal-600 hover:bg-teal-600 hover:text-white border-teal-200">
                        <i class="fas fa-truck-loading text-lg mb-1"></i>
                        <span>Delivery</span>
                    </button>
                    <button onclick="openTab('purchase')" class="bg-amber-50 text-amber-600 hover:bg-amber-600 hover:text-white border-amber-200">
                        <i class="fas fa-clipboard-list text-lg mb-1"></i>
                        <span>Purchase</span>
                    </button>
                    <button onclick="openTab('moneyreceipt')" class="bg-lime-50 text-lime-600 hover:bg-lime-600 hover:text-white border-lime-200">
                        <i class="fas fa-receipt text-lg mb-1"></i>
                        <span>Money Rcpt</span>
                    </button>
                    <button onclick="openTab('letter')" class="bg-rose-50 text-rose-600 hover:bg-rose-600 hover:text-white border-rose-200">
                        <i class="fas fa-envelope text-lg mb-1"></i>
                        <span>Letter</span>
                    </button>
                    <button onclick="openTab('settings')" class="bg-gray-100 text-gray-600 hover:bg-gray-600 hover:text-white border-gray-200">
                        <i class="fas fa-cog text-lg mb-1"></i>
                        <span>Settings</span>
                    </button>
                </div>
            </div>
            
            <!-- LOGOUT BUTTON moved below menu tabs, centre aligned, above developer credit -->
            <div class="logout-btn-container">
                <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>

            <!-- DEVELOPER CREDIT (unchanged) -->
            <div class="developer-credit">
                Developed By Jakaria Ahmed<br>
                <span class="phone">+8801717106984</span>
            </div>
        </div>
    </nav>

    <main class="w-full">
        <!-- Clients Tab -->
        <div id="clients" class="tab-content bg-white">
            <div class="flex items-center p-6 border-b border-red-100">
                <div class="flex-none"><button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-red-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button></div>
                <div class="flex-grow flex justify-center"><button onclick="toggleClientModal(true)" class="bg-red-600 text-white px-8 py-2 rounded-lg text-xs font-bold hover:bg-red-700 shadow-md"><i class="fas fa-plus mr-1"></i> ADD CLIENT</button></div>
                <div class="flex-none w-[75px] hidden md:block"></div>
            </div>
            <div class="full-screen-container p-6">
                <input type="text" id="clientSearch" onkeyup="filterClients()" placeholder="Search clients..." class="w-full mb-4 pl-4 pr-4 py-2 border border-gray-200 rounded-lg">
                <div class="table-container bg-gray-50 rounded-xl p-4">
                    <table class="w-full text-left border-collapse text-sm">
                        <thead><tr class="text-red-600 border-b-2 border-red-200 uppercase text-xs"><th class="p-3">SL</th><th class="p-3">Clients</th><th class="p-3">Address</th><th class="p-3">Contact Person</th><th class="p-3">Designation</th><th class="p-3">Mobile</th><th class="p-3">Email</th><th class="p-3 text-center">Action</th></tr></thead>
                        <tbody id="clientTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="products" class="tab-content bg-white">
            <div class="flex items-center p-6 border-b border-orange-100">
                <div class="flex-none"><button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-orange-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button></div>
                <div class="flex-grow flex justify-center"><button onclick="toggleProductModal(true)" class="bg-orange-600 text-white px-8 py-2 rounded-lg text-xs font-bold hover:bg-orange-700 shadow-md"><i class="fas fa-plus mr-1"></i> ADD PRODUCT</button></div>
                <div class="flex-none w-[75px] hidden md:block"></div>
            </div>
            <div class="full-screen-container p-6">
                <input type="text" id="productSearch" onkeyup="filterProducts()" placeholder="Search products..." class="w-full mb-4 pl-4 pr-4 py-2 border border-gray-200 rounded-lg">
                <div class="table-container bg-gray-50 rounded-xl p-4 text-sm">
                    <table class="w-full text-left border-collapse">
                        <thead><tr class="text-orange-600 border-b-2 border-orange-200 uppercase text-xs"><th class="p-3">SL</th><th class="p-3">Items</th><th class="p-3">Description</th><th class="p-3">Unit</th><th class="p-3">Rate</th><th class="p-3">Stock Qty</th><th class="p-3 text-center">Action</th></tr></thead>
                        <tbody id="productTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Suppliers Tab -->
        <div id="suppliers" class="tab-content bg-white">
            <div class="flex items-center p-6 border-b border-blue-100">
                <div class="flex-none"><button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-blue-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button></div>
                <div class="flex-grow flex justify-center"><button onclick="toggleSupplierModal(true)" class="bg-blue-600 text-white px-8 py-2 rounded-lg text-xs font-bold hover:bg-blue-700 shadow-md"><i class="fas fa-plus mr-1"></i> ADD SUPPLIER</button></div>
                <div class="flex-none w-[75px] hidden md:block"></div>
            </div>
            <div class="p-6">
                <input type="text" id="supplierSearch" onkeyup="filterTable('supplierTableBody', this.value)" placeholder="Search suppliers..." class="w-full mb-4 px-4 py-2 border border-gray-200 rounded-lg">
                <div class="table-container bg-gray-50 rounded-xl p-4 text-sm">
                    <table class="w-full text-left border-collapse">
                        <thead><tr class="text-blue-600 border-b-2 border-blue-200 uppercase text-xs"><th class="p-3">SL</th><th class="p-3">Supplier</th><th class="p-3">Address</th><th class="p-3">Type</th><th class="p-3">Contact Person</th><th class="p-3">Designation</th><th class="p-3">Mobile</th><th class="p-3">Email</th><th class="p-3 text-center">Action</th></tr></thead>
                        <tbody id="supplierTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventory" class="tab-content bg-white">
            <div class="flex items-center p-6 border-b border-emerald-100">
                <div class="flex-none"><button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-emerald-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button></div>
                <h2 class="flex-grow text-center font-bold text-emerald-700 uppercase tracking-widest">STOCK STATUS</h2>
                <div class="flex-none w-[75px] hidden md:block"></div>
            </div>
            <div class="p-6">
                <div class="stats-scroll-x mb-6">
                    <div class="bg-emerald-50 p-3 rounded-xl border border-emerald-100">
                        <p class="stat-label text-emerald-600 uppercase">Total Items</p>
                        <p id="totalInvItems" class="stat-value font-black">0</p>
                    </div>
                    <div class="bg-orange-50 p-3 rounded-xl border border-orange-100">
                        <p class="stat-label text-orange-600 uppercase">Low Stock</p>
                        <p id="lowStockCount" class="stat-value font-black text-orange-600">0</p>
                    </div>
                    <div class="bg-red-50 p-3 rounded-xl border border-red-100">
                        <p class="stat-label text-red-600 uppercase">Out of Stock</p>
                        <p id="outStockCount" class="stat-value font-black text-red-600">0</p>
                    </div>
                </div>
                <div class="table-container bg-gray-50 rounded-xl p-4 text-sm">
                    <table class="w-full text-left border-collapse">
                        <thead><tr class="text-emerald-600 border-b-2 border-emerald-200 uppercase text-xs"><th class="p-3">Items</th><th class="p-3">Description</th><th class="p-3">Stock Qty</th><th class="p-3">Status</th></tr></thead>
                        <tbody id="inventoryTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ACCOUNTS -->
        <div id="accounts" class="tab-content bg-white">
            <div class="flex flex-col md:flex-row items-center p-4 border-b border-purple-100 gap-4">
                <button onclick="showDashboard()" class="btn-back bg-gray-100 px-4 py-2 rounded-full text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> BACK</button>
                
                <div id="accounts-nav" class="grid grid-cols-4 gap-2 w-full md:w-auto">
                    <button onclick="switchAccountsTab('income')" id="tab-income" class="flex flex-col items-center justify-center px-4 py-2 rounded-lg bg-green-50 text-green-600 shadow-sm border border-green-100 transition">
                        <i class="fas fa-hand-holding-usd text-xs mb-1"></i>
                        <span class="text-[8px] uppercase font-bold tracking-tight">Income</span>
                    </button>
                    <button onclick="switchAccountsTab('expense')" id="tab-expense" class="flex flex-col items-center justify-center px-4 py-2 rounded-lg bg-red-50 text-red-600 shadow-sm border border-red-100 transition">
                        <i class="fas fa-file-invoice text-xs mb-1"></i>
                        <span class="text-[8px] uppercase font-bold tracking-tight">Expense</span>
                    </button>
                    <button onclick="switchAccountsTab('transactions')" id="tab-transactions" class="flex flex-col items-center justify-center px-4 py-2 rounded-lg bg-blue-50 text-blue-600 shadow-sm border border-blue-100 transition">
                        <i class="fas fa-exchange-alt text-xs mb-1"></i>
                        <span class="text-[8px] uppercase font-bold tracking-tight">Transactions</span>
                    </button>
                    <button onclick="switchAccountsTab('orders')" id="tab-orders" class="flex flex-col items-center justify-center px-4 py-2 rounded-lg bg-orange-50 text-orange-600 shadow-sm border border-orange-100 transition">
                        <i class="fas fa-shopping-cart text-xs mb-1"></i>
                        <span class="text-[8px] uppercase font-bold tracking-tight">Orders</span>
                    </button>
                </div>
                <div class="flex-grow"></div>
                <button id="addAccBtn" class="bg-purple-600 text-white px-6 py-2 rounded-lg text-xs font-bold shadow-md hover:bg-purple-700 uppercase"><i class="fas fa-plus mr-1"></i> Add Entry</button>
            </div>

            <div class="p-6">
                <div id="accounts-stats" class="stats-scroll-x mb-6">
                    <div id="statCard1" class="p-3 rounded-xl border">
                        <p id="statLabel1" class="stat-label font-bold uppercase">Total Income</p>
                        <p id="statVal1" class="stat-value font-black">0.00</p>
                    </div>
                    <div id="statCard2" class="p-3 rounded-xl border">
                        <p id="statLabel2" class="stat-label font-bold uppercase">This Year</p>
                        <p id="statVal2" class="stat-value font-black">0.00</p>
                    </div>
                    <div id="statCard3" class="p-3 rounded-xl border">
                        <p id="statLabel3" class="stat-label font-bold uppercase">This Month</p>
                        <p id="statVal3" class="stat-value font-black">0.00</p>
                    </div>
                </div>

                <div id="accounts-income" class="accounts-sub-tab">
                    <div class="table-container bg-gray-50 rounded-xl p-4 text-sm">
                        <table class="w-full text-left border-collapse">
                            <thead><tr class="text-green-600 border-b-2 border-green-200 uppercase text-xs"><th class="p-3">SL</th><th class="p-3">Date</th><th class="p-3">Purpose</th><th class="p-3">Amount</th><th class="p-3 text-center">Action</th></tr></thead>
                            <tbody id="incomeTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="accounts-expense" class="accounts-sub-tab">
                    <div class="table-container bg-gray-50 rounded-xl p-4 text-sm">
                        <table class="w-full text-left border-collapse">
                            <thead><tr class="text-red-600 border-b-2 border-red-200 uppercase text-xs"><th class="p-3">SL</th><th class="p-3">Date</th><th class="p-3">Purpose</th><th class="p-3">Amount</th><th class="p-3 text-center">Action</th></tr></thead>
                            <tbody id="expenseTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="accounts-transactions" class="accounts-sub-tab active">
                    <div class="table-container bg-gray-50 rounded-xl p-4 text-sm">
                        <table class="w-full text-left border-collapse">
                            <thead><tr class="text-blue-600 border-b-2 border-blue-200 uppercase text-xs"><th class="p-3">Date</th><th class="p-3">Type</th><th class="p-3">Purpose</th><th class="p-3">Amount</th></tr></thead>
                            <tbody id="transactionsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="accounts-orders" class="accounts-sub-tab">
                    <div class="table-container bg-gray-50 rounded-xl p-4 text-sm">
                        <table class="w-full text-left border-collapse">
                            <thead><tr class="text-orange-600 border-b-2 border-orange-200 uppercase text-xs"><th class="p-3">SL</th><th class="p-3">Clients</th><th class="p-3">Date</th><th class="p-3">WO Value</th><th class="p-3">WO Cost</th><th class="p-3">Type</th><th class="p-3">Profit</th><th class="p-3 text-center">Action</th></tr></thead>
                            <tbody id="ordersTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- INVOICE (FIXED ITEM ADDITION - exactly same PDF layout) -->
        <div id="invoice" class="tab-content bg-white">
            <div class="flex flex-col md:flex-row items-center p-4 border-b border-yellow-100 gap-4">
                <button onclick="showDashboard()" class="btn-back bg-gray-100 px-4 py-2 rounded-full text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> BACK</button>
                <div class="flex bg-gray-100 p-1 rounded-xl">
                    <button onclick="startNewInvoiceTab()" id="btn-sub-create" class="px-6 py-2 rounded-lg text-xs font-bold transition-all bg-white shadow-sm text-yellow-600 uppercase">Create Invoice</button>
                    <button onclick="switchInvoiceSubTab('saved')" id="btn-sub-saved" class="px-6 py-2 rounded-lg text-xs font-bold transition-all text-gray-500 uppercase">Saved Files</button>
                </div>
                <div class="flex-grow"></div>
                <button id="saveInvoiceBtn" onclick="saveInvoice()" class="bg-green-600 text-white px-6 py-2 rounded-lg text-xs font-bold shadow-md hover:bg-green-700 uppercase">SAVE INVOICE</button>
            </div>
            
            <div id="invoice-create" class="invoice-sub-tab active">
                <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-2 bg-gray-50 p-6 rounded-2xl shadow-inner space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="autocomplete-wrapper">
                                <label class="text-[10px] font-bold text-gray-500 uppercase">Client Name</label>
                                <input type="text" id="invClientInput" oninput="showClientSuggestions()" placeholder="Type client name..." class="w-full border-b-2 bg-transparent py-1">
                                <div id="clientSuggestions" class="suggestions-list"></div>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-gray-500 uppercase">Order ID</label>
                                <input type="text" id="invOrderId" class="w-full border-b-2 bg-transparent py-1">
                            </div>
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-gray-500 uppercase">Subject</label>
                            <input type="text" id="invSubject" placeholder="Enter invoice subject..." class="w-full border-b-2 bg-transparent py-1 font-bold text-gray-700">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-gray-500 uppercase">Address</label>
                            <input type="text" id="invAddress" readonly class="w-full border-b-2 bg-transparent py-1 text-gray-400">
                        </div>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-2xl shadow-inner space-y-4">
                        <input type="hidden" id="editInvoiceIndex" value="-1">
                        <div>
                            <label class="text-[10px] font-bold text-gray-500 uppercase">Invoice No.</label>
                            <input type="text" id="invNo" readonly class="w-full font-mono font-bold text-red-600 bg-transparent py-1">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-gray-500 uppercase">Date</label>
                            <input type="date" id="invDate" class="w-full border-b-2 bg-transparent py-1">
                        </div>
                    </div>
                </div>

                <div class="px-6 pb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-700 uppercase text-xs tracking-widest">Billing Items</h3>
                        <button onclick="toggleItemModal(true)" class="bg-yellow-500 text-white px-4 py-1 rounded-full text-[10px] font-bold hover:bg-yellow-600">
                            <i class="fas fa-plus mr-1"></i> ADD ITEM
                        </button>
                    </div>
                    <div class="table-container bg-white border rounded-xl overflow-hidden">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-gray-100 text-[10px] uppercase text-gray-600">
                                <tr><th class="p-3">SL</th><th class="p-3">Item</th><th class="p-3">Qty</th><th class="p-3">Price</th><th class="p-3">Total</th><th class="p-3">Action</th></tr>
                            </thead>
                            <tbody id="invoiceItemsBody" class="text-sm"></tbody>
                            <tfoot class="text-sm border-t-2 border-gray-200">
                                <tr class="border-b">
                                    <td colspan="4" class="p-3 text-right font-bold text-gray-600 bg-gray-50">GRAND TOTAL:</td>
                                    <td id="invGrandTotal" class="p-3 font-black text-yellow-700">0.00</td>
                                    <td class="bg-gray-50"></td>
                                </tr>
                                <tr class="border-b">
                                    <td colspan="4" class="p-3 text-right font-bold text-gray-600 bg-gray-50">PAID AMOUNT:</td>
                                    <td class="p-3">
                                        <input type="number" id="invPaid" oninput="calculateBalance()" class="w-full bg-transparent text-green-600 font-bold focus:ring-0" value="0">
                                    </td>
                                    <td class="bg-gray-50"></td>
                                </tr>
                                <tr class="border-b">
                                    <td colspan="4" class="p-3 text-right font-bold text-gray-600 bg-gray-50">DUE AMOUNT:</td>
                                    <td class="p-3">
                                        <input type="number" id="invDue" readonly class="w-full bg-transparent text-red-600 font-bold" value="0">
                                    </td>
                                    <td class="bg-gray-50"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <div id="invoice-saved" class="invoice-sub-tab p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="savedInvoicesList"></div>
            </div>
        </div>

        <!-- SETTINGS -->
        <div id="settings" class="tab-content bg-white">
            <div class="p-6">
                <div class="flex items-center mb-6">
                    <button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-gray-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button>
                    <h2 class="ml-4 text-xl font-bold text-gray-700 uppercase tracking-widest"><i class="fas fa-cogs mr-2 text-red-600"></i> Company Settings</h2>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-6 bg-blue-50 p-6 rounded-2xl border border-blue-100">
                        <h3 class="font-bold text-blue-700 border-b border-blue-200 pb-2 uppercase text-xs tracking-wider">GENERAL INFORMATION</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Company Name</label><input type="text" id="setCompanyName" class="w-full border-b-2 border-blue-200 bg-transparent py-1"></div>
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Slogan / Subtitle</label><input type="text" id="setSlogan" class="w-full border-b-2 border-blue-200 bg-transparent py-1"></div>
                        </div>
                        <div><label class="text-[10px] font-bold text-gray-500 uppercase">Office Address</label><textarea id="setAddress" rows="2" class="w-full border-b-2 border-blue-200 bg-transparent py-1"></textarea></div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Email</label><input type="email" id="setEmail" class="w-full border-b-2 border-blue-200 bg-transparent py-1"></div>
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Mobile</label><input type="text" id="setMobile" class="w-full border-b-2 border-blue-200 bg-transparent py-1"></div>
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Website</label><input type="text" id="setWebsite" class="w-full border-b-2 border-blue-200 bg-transparent py-1"></div>
                        </div>
                    </div>

                    <div class="space-y-6 bg-purple-50 p-6 rounded-2xl border border-purple-100">
                        <h3 class="font-bold text-purple-700 border-b border-purple-200 pb-2 uppercase text-xs tracking-wider">AUTHORIZATION & SIGNATORY</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Signatory Name</label><input type="text" id="setSignatoryName" class="w-full border-b-2 border-purple-200 bg-transparent py-1"></div>
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Designation</label><input type="text" id="setSignatoryDesig" class="w-full border-b-2 border-purple-200 bg-transparent py-1"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div>
                                <label class="text-[10px] font-bold text-gray-500 uppercase block mb-1">Company Logo</label>
                                <input type="file" id="setLogo" accept="image/*" class="text-[9px] w-full">
                                <div id="logoPreview" class="mt-2 h-12 w-12 border bg-white rounded flex items-center justify-center overflow-hidden relative"><i class="fas fa-image text-gray-300"></i></div>
                                <button type="button" onclick="deleteImage('logo')" class="img-delete-icon mt-1"><i class="fas fa-trash-alt"></i> Delete</button>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-gray-500 uppercase block mb-1">Company Seal</label>
                                <input type="file" id="setSeal" accept="image/*" class="text-[9px] w-full">
                                <div id="sealPreview" class="mt-2 h-12 w-12 border bg-white rounded flex items-center justify-center overflow-hidden relative"><i class="fas fa-stamp text-gray-300"></i></div>
                                <button type="button" onclick="deleteImage('seal')" class="img-delete-icon mt-1"><i class="fas fa-trash-alt"></i> Delete</button>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-gray-500 uppercase block mb-1">Signatory Sign</label>
                                <input type="file" id="setSign" accept="image/*" class="text-[9px] w-full">
                                <div id="signPreview" class="mt-2 h-12 w-12 border bg-white rounded flex items-center justify-center overflow-hidden relative"><i class="fas fa-signature text-gray-300"></i></div>
                                <button type="button" onclick="deleteImage('sign')" class="img-delete-icon mt-1"><i class="fas fa-trash-alt"></i> Delete</button>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-2 space-y-6 bg-gray-50 p-6 rounded-2xl border border-gray-200">
                        <h3 class="font-bold text-gray-700 border-b border-gray-300 pb-2 uppercase text-xs tracking-wider">TERMS & CONDITIONS</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Quotation Terms</label><textarea id="termsQuotation" rows="3" class="w-full border rounded-lg p-2 text-xs"></textarea></div>
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Invoice Terms</label><textarea id="termsInvoice" rows="3" class="w-full border rounded-lg p-2 text-xs"></textarea></div>
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">Challan Terms</label><textarea id="termsChallan" rows="3" class="w-full border rounded-lg p-2 text-xs"></textarea></div>
                            <div><label class="text-[10px] font-bold text-gray-500 uppercase">PO Terms</label><textarea id="termsPO" rows="3" class="w-full border rounded-lg p-2 text-xs"></textarea></div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 flex justify-center">
                    <button onclick="saveSettings()" class="bg-green-600 text-white px-12 py-3 rounded-xl font-bold shadow-xl hover:bg-green-700 hover:scale-105 transition-all uppercase tracking-widest">
                        <i class="fas fa-save mr-2"></i> Save All Settings
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== NEW TABS (empty, no content) ===== -->
        <!-- Quotation -->
        <div id="quotation" class="tab-content bg-white">
            <div class="flex items-center p-6 border-b border-indigo-100">
                <div class="flex-none"><button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-indigo-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button></div>
                <h2 class="flex-grow text-center font-bold text-indigo-700 uppercase tracking-widest">QUOTATION</h2>
                <div class="flex-none w-[75px]"></div>
            </div>
            <div class="p-6 flex items-center justify-center text-gray-400 italic">Quotation content will appear here.</div>
        </div>
        <!-- Delivery Challan -->
        <div id="delivery" class="tab-content bg-white">
            <div class="flex items-center p-6 border-b border-teal-100">
                <div class="flex-none"><button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-teal-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button></div>
                <h2 class="flex-grow text-center font-bold text-teal-700 uppercase tracking-widest">DELIVERY CHALLAN</h2>
                <div class="flex-none w-[75px]"></div>
            </div>
            <div class="p-6 flex items-center justify-center text-gray-400 italic">Delivery challan content will appear here.</div>
        </div>
        <!-- Purchase Order -->
        <div id="purchase" class="tab-content bg-white">
            <div class="flex items-center p-6 border-b border-amber-100">
                <div class="flex-none"><button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-amber-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button></div>
                <h2 class="flex-grow text-center font-bold text-amber-700 uppercase tracking-widest">PURCHASE ORDER</h2>
                <div class="flex-none w-[75px]"></div>
            </div>
            <div class="p-6 flex items-center justify-center text-gray-400 italic">Purchase order content will appear here.</div>
        </div>
        <!-- Money Receipt -->
        <div id="moneyreceipt" class="tab-content bg-white">
            <div class="flex items-center p-6 border-b border-lime-100">
                <div class="flex-none"><button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-lime-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button></div>
                <h2 class="flex-grow text-center font-bold text-lime-700 uppercase tracking-widest">MONEY RECEIPT</h2>
                <div class="flex-none w-[75px]"></div>
            </div>
            <div class="p-6 flex items-center justify-center text-gray-400 italic">Money receipt content will appear here.</div>
        </div>
        <!-- Letter -->
        <div id="letter" class="tab-content bg-white">
            <div class="flex items-center p-6 border-b border-rose-100">
                <div class="flex-none"><button onclick="showDashboard()" class="btn-back flex items-center gap-2 bg-gray-100 hover:bg-rose-600 hover:text-white px-4 py-2 rounded-full transition-all text-xs font-bold uppercase"><i class="fas fa-arrow-left"></i> Back</button></div>
                <h2 class="flex-grow text-center font-bold text-rose-700 uppercase tracking-widest">LETTER</h2>
                <div class="flex-none w-[75px]"></div>
            </div>
            <div class="p-6 flex items-center justify-center text-gray-400 italic">Letter content will appear here.</div>
        </div>
    </main>

    <!-- Modals -->
    <div id="clientModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="bg-red-600 p-4 text-white flex justify-between items-center sticky top-0 z-10">
                <h3 id="clientModalTitle" class="font-bold uppercase">Add Client</h3>
                <button onclick="toggleClientModal(false)" class="text-white hover:text-gray-200 text-2xl modal-close-btn">&times;</button>
            </div>
            <form id="clientForm" class="p-6 space-y-4">
                <input type="hidden" id="editClientIndex" value="-1">
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">SL</label><input type="text" id="clientSl" readonly class="w-full border-b-2 border-gray-200 bg-gray-50 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Clients</label><input type="text" id="clientName" required class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Address</label><input type="text" id="address" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Contact Person</label><input type="text" id="contactPerson" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Designation</label><input type="text" id="designation" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Mobile</label><input type="text" id="mobile" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Email</label><input type="email" id="email" class="w-full border-b-2 border-gray-200 py-1"></div>
                <button type="submit" class="w-full bg-red-600 text-white font-bold py-2 rounded-lg uppercase shadow-md">Save Client</button>
            </form>
        </div>
    </div>

    <div id="productModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md maxh-[90vh] overflow-y-auto">
            <div class="bg-orange-600 p-4 text-white flex justify-between items-center sticky top-0 z-10">
                <h3 id="productModalTitle" class="font-bold uppercase">Add Product</h3>
                <button onclick="toggleProductModal(false)" class="text-white hover:text-gray-200 text-2xl modal-close-btn">&times;</button>
            </div>
            <form id="productForm" class="p-6 space-y-4">
                <input type="hidden" id="editProductIndex" value="-1">
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">SL</label><input type="text" id="productSl" readonly class="w-full border-b-2 border-gray-200 bg-gray-50 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Items</label><input type="text" id="itemName" required class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Description</label><input type="text" id="description" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Unit</label><input type="text" id="unit" placeholder="e.g. Pcs, Box" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Rate (৳)</label><input type="number" id="rate" step="0.01" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Stock Qty</label><input type="number" id="stockQty" class="w-full border-b-2 border-gray-200 py-1"></div>
                <button type="submit" class="w-full bg-orange-600 text-white font-bold py-2 rounded-lg uppercase shadow-md">Save Product</button>
            </form>
        </div>
    </div>

    <div id="supplierModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="bg-blue-600 p-4 text-white flex justify-between items-center sticky top-0 z-10">
                <h3 class="font-bold uppercase">Supplier</h3>
                <button onclick="toggleSupplierModal(false)" class="text-white hover:text-gray-200 text-2xl modal-close-btn">&times;</button>
            </div>
            <form id="supplierForm" class="p-6 space-y-4">
                <input type="hidden" id="editSupplierIndex" value="-1">
                <div><label class="text-[10px] font-bold">SL</label><input type="text" id="supplierSl" readonly class="w-full border-b-2 border-gray-200 bg-gray-50 py-1"></div>
                <div><label class="text-[10px] font-bold">Supplier</label><input type="text" id="suppName" required class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold">Address</label><input type="text" id="suppAddress" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold">Type</label><input type="text" id="suppType" placeholder="e.g. Wholesale, Retail" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold">Contact Person</label><input type="text" id="suppPerson" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold">Designation</label><input type="text" id="suppDesignation" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold">Mobile</label><input type="text" id="suppMobile" class="w-full border-b-2 border-gray-200 py-1"></div>
                <div><label class="text-[10px] font-bold">Email</label><input type="email" id="suppEmail" class="w-full border-b-2 border-gray-200 py-1"></div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 rounded-lg">Save</button>
            </form>
        </div>
    </div>

    <!-- ITEM MODAL -->
    <div id="itemModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[150] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md">
            <div class="bg-yellow-500 p-4 text-white flex justify-between items-center sticky top-0 z-10">
                <h3 class="font-bold uppercase">Add Item to Invoice</h3>
                <button onclick="toggleItemModal(false)" class="text-white hover:text-gray-200 text-2xl modal-close-btn">&times;</button>
            </div>
            <form id="itemForm" onsubmit="event.preventDefault(); addItemToInvoice();" class="p-6 space-y-4">
                <div class="autocomplete-wrapper">
                    <label class="text-[10px] font-bold text-gray-500 uppercase">Product</label>
                    <input type="text" id="invProductInput" oninput="showProductSuggestions()" placeholder="Type product name..." class="w-full border-b-2 border-gray-200 py-1" required>
                    <div id="productSuggestions" class="suggestions-list"></div>
                </div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Description</label><input type="text" id="itemDesc" readonly class="w-full border-b-2 bg-gray-50 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Unit</label><input type="text" id="itemUnit" readonly class="w-full border-b-2 bg-gray-50 py-1"></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Qty</label><input type="number" id="itemQty" oninput="calcItemTotal()" class="w-full border-b-2 py-1" value="1" min="1" required></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Price (৳)</label><input type="number" id="itemPrice" step="0.01" oninput="calcItemTotal()" class="w-full border-b-2 py-1" required></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Total</label><input type="text" id="itemTotal" readonly class="w-full border-b-2 bg-gray-50 py-1 font-bold text-yellow-600"></div>
                <button type="submit" class="w-full bg-yellow-500 text-white font-bold py-2 rounded-lg uppercase shadow-md hover:bg-yellow-600"><i class="fas fa-plus mr-1"></i> Add to Invoice</button>
            </form>
        </div>
    </div>

    <!-- Account Modal -->
    <div id="accModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md">
            <div id="accModalHeader" class="p-4 text-white flex justify-between items-center sticky top-0 z-10"><h3 id="accModalTitle" class="font-bold uppercase">Add Entry</h3><button onclick="toggleAccModal(false)" class="text-white hover:text-gray-200 text-2xl modal-close-btn">&times;</button></div>
            <form id="accForm" class="p-6 space-y-4">
                <input type="hidden" id="accType" value="income">
                <input type="hidden" id="editAccIndex" value="-1">
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Date</label><input type="date" id="accDate" class="w-full border-b-2 py-1" required></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Amount (৳)</label><input type="number" id="accAmount" step="0.01" class="w-full border-b-2 py-1" required></div>
                <div><label class="text-[10px] font-bold text-gray-500 uppercase">Purpose / Description</label><input type="text" id="accPurpose" class="w-full border-b-2 py-1" required></div>
                <button id="accSubmitBtn" type="submit" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg uppercase shadow-lg">Save</button>
            </form>
        </div>
    </div>

    <div id="orderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md">
            <div class="bg-orange-600 p-4 text-white flex justify-between items-center sticky top-0 z-10"><h3 class="font-bold uppercase">Work Order</h3><button onclick="toggleOrderModal(false)" class="text-white hover:text-gray-200 text-2xl modal-close-btn">&times;</button></div>
            <form id="orderForm" class="p-6 space-y-4">
                <input type="hidden" id="editOrderIndex" value="-1">
                <div><label class="text-[10px] font-bold">Client</label><input type="text" id="orderClient" required class="w-full border py-2 px-3"></div>
                <div><label class="text-[10px] font-bold">Date</label><input type="date" id="orderDate" class="w-full border py-2 px-3"></div>
                <div><label class="text-[10px] font-bold">Type (e.g., Supply, Service)</label><input type="text" id="orderType" class="w-full border py-2 px-3"></div>
                <div><label class="text-[10px] font-bold">Order Value (৳)</label><input type="number" id="orderValue" step="0.01" required class="w-full border py-2 px-3"></div>
                <div><label class="text-[10px] font-bold">Cost (৳)</label><input type="number" id="orderCost" step="0.01" required class="w-full border py-2 px-3"></div>
                <button type="submit" class="w-full bg-orange-600 text-white font-bold py-2 rounded-lg">Save Order</button>
            </form>
        </div>
    </div>

    <script>
        // LOGIN SYSTEM (ID: 1234@ , PASS: @1234) – keep logged in until manual logout
        function performLogin() {
            const loginId = document.getElementById('loginId').value.trim();
            const loginPass = document.getElementById('loginPass').value.trim();
            if (loginId === '1234@' && loginPass === '@1234') {
                document.body.classList.add('logged-in');
                localStorage.setItem('arvin_logged_in', 'yes');
                loadAllData();
            } else {
                alert('Invalid credentials');
            }
        }
        function logout() {
            document.body.classList.remove('logged-in');
            localStorage.removeItem('arvin_logged_in');
            document.getElementById('loginId').value = '';
            document.getElementById('loginPass').value = '';
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('nav-grid').classList.remove('hidden');
            document.getElementById('moveTopBtn').style.display = 'none';
        }
        window.onload = function() {
            if (localStorage.getItem('arvin_logged_in') === 'yes') {
                document.body.classList.add('logged-in');
                loadAllData();
            } 
        };
        function loadAllData() {
            clients = JSON.parse(localStorage.getItem('arvin_clients_list')) || [];
            products = JSON.parse(localStorage.getItem('arvin_products_list')) || [];
            suppliers = JSON.parse(localStorage.getItem('arvin_suppliers_list')) || [];
            invoices = JSON.parse(localStorage.getItem('arvin_invoices_list')) || [];
            income = JSON.parse(localStorage.getItem('arvin_income_list')) || [];
            expense = JSON.parse(localStorage.getItem('arvin_expense_list')) || [];
            orders = JSON.parse(localStorage.getItem('arvin_orders_list')) || [];
            settings = JSON.parse(localStorage.getItem('arvin_settings')) || {
                company: 'ARVIN CONTROLS',
                slogan: 'FIRE SAFETY ENGINEERING & CONSULTANT',
                address: 'Dhaka, Bangladesh',
                email: '', mobile: '', website: '',
                signatory: '', designation: '',
                logo: '', seal: '', sign: '',
                terms_quot: '', terms_inv: '', terms_challan: '', terms_po: ''
            };
            currentInvoiceItems = [];
            selectedClientIndex = -1;
            activeAccountsTab = 'transactions';
            renderClients();
            renderProducts();
            renderSuppliers();
            renderSavedInvoices();
            loadSettingsFields();
            updateUINames();
            showDashboard();
        }

        // Data store variables
        let clients = [], products = [], suppliers = [], invoices = [], income = [], expense = [], orders = [];
        let settings = {};
        let currentInvoiceItems = [];
        let selectedClientIndex = -1;
        let activeAccountsTab = 'transactions';

        // --- Utility functions ---
        function formatFriendlyDate(dateStr) {
            if (!dateStr) return 'N/A';
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return dateStr;
            const day = date.getDate();
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const month = monthNames[date.getMonth()];
            const year = date.getFullYear();
            let suffix = 'th';
            if (day === 1 || day === 21 || day === 31) suffix = 'st';
            else if (day === 2 || day === 22) suffix = 'nd';
            else if (day === 3 || day === 23) suffix = 'rd';
            return `${day}${suffix} ${month}, ${year}`;
        }

        function updateUINames() {
            document.getElementById('nav-company-name').innerText = settings.company || 'ARVIN CONTROLS';
        }

        // Settings Logic
        function loadSettingsFields() {
            document.getElementById('setCompanyName').value = settings.company || '';
            document.getElementById('setSlogan').value = settings.slogan || '';
            document.getElementById('setAddress').value = settings.address || '';
            document.getElementById('setEmail').value = settings.email || '';
            document.getElementById('setMobile').value = settings.mobile || '';
            document.getElementById('setWebsite').value = settings.website || '';
            document.getElementById('setSignatoryName').value = settings.signatory || '';
            document.getElementById('setSignatoryDesig').value = settings.designation || '';
            document.getElementById('termsQuotation').value = settings.terms_quot || '';
            document.getElementById('termsInvoice').value = settings.terms_inv || '';
            document.getElementById('termsChallan').value = settings.terms_challan || '';
            document.getElementById('termsPO').value = settings.terms_po || '';

            if(settings.logo) document.getElementById('logoPreview').innerHTML = `<img src="${settings.logo}" class="h-full w-full object-contain">`; else document.getElementById('logoPreview').innerHTML = '<i class="fas fa-image text-gray-300"></i>';
            if(settings.seal) document.getElementById('sealPreview').innerHTML = `<img src="${settings.seal}" class="h-full w-full object-contain">`; else document.getElementById('sealPreview').innerHTML = '<i class="fas fa-stamp text-gray-300"></i>';
            if(settings.sign) document.getElementById('signPreview').innerHTML = `<img src="${settings.sign}" class="h-full w-full object-contain">`; else document.getElementById('signPreview').innerHTML = '<i class="fas fa-signature text-gray-300"></i>';
        }

        function deleteImage(type) {
            if (type === 'logo') { settings.logo = ''; document.getElementById('logoPreview').innerHTML = '<i class="fas fa-image text-gray-300"></i>'; }
            if (type === 'seal') { settings.seal = ''; document.getElementById('sealPreview').innerHTML = '<i class="fas fa-stamp text-gray-300"></i>'; }
            if (type === 'sign') { settings.sign = ''; document.getElementById('signPreview').innerHTML = '<i class="fas fa-signature text-gray-300"></i>'; }
        }

        async function saveSettings() {
            settings.company = document.getElementById('setCompanyName').value;
            settings.slogan = document.getElementById('setSlogan').value;
            settings.address = document.getElementById('setAddress').value;
            settings.email = document.getElementById('setEmail').value;
            settings.mobile = document.getElementById('setMobile').value;
            settings.website = document.getElementById('setWebsite').value;
            settings.signatory = document.getElementById('setSignatoryName').value;
            settings.designation = document.getElementById('setSignatoryDesig').value;
            settings.terms_quot = document.getElementById('termsQuotation').value;
            settings.terms_inv = document.getElementById('termsInvoice').value;
            settings.terms_challan = document.getElementById('termsChallan').value;
            settings.terms_po = document.getElementById('termsPO').value;

            const logoFile = document.getElementById('setLogo').files[0];
            const sealFile = document.getElementById('setSeal').files[0];
            const signFile = document.getElementById('setSign').files[0];

            if(logoFile) settings.logo = await toBase64(logoFile);
            if(sealFile) settings.seal = await toBase64(sealFile);
            if(signFile) settings.sign = await toBase64(signFile);

            localStorage.setItem('arvin_settings', JSON.stringify(settings));
            updateUINames();
            alert("Settings Saved Successfully!");
        }

        const toBase64 = file => new Promise((res, rej) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => res(reader.result);
            reader.onerror = error => rej(error);
        });

        // Tab Logic
        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.getElementById('nav-grid').classList.add('hidden');
            if(tabId === 'invoice') switchInvoiceSubTab('create');
            if(tabId === 'inventory') renderInventory();
            if(tabId === 'accounts') switchAccountsTab('transactions');
            document.getElementById('moveTopBtn').style.display = 'flex';
        }

        function showDashboard() {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('nav-grid').classList.remove('hidden');
            document.getElementById('moveTopBtn').style.display = 'none';
        }

        // Supplier Logic
        function toggleSupplierModal(s, idx=-1) {
            document.getElementById('supplierModal').classList.toggle('hidden', !s);
            if(s && idx > -1) {
                const sp = suppliers[idx];
                document.getElementById('editSupplierIndex').value = idx;
                document.getElementById('supplierSl').value = idx + 1;
                document.getElementById('suppName').value = sp.name;
                document.getElementById('suppAddress').value = sp.address || '';
                document.getElementById('suppType').value = sp.type || '';
                document.getElementById('suppPerson').value = sp.person || '';
                document.getElementById('suppDesignation').value = sp.designation || '';
                document.getElementById('suppMobile').value = sp.mobile || '';
                document.getElementById('suppEmail').value = sp.email || '';
            } else if (s) {
                document.getElementById('supplierForm').reset();
                document.getElementById('editSupplierIndex').value = -1;
                document.getElementById('supplierSl').value = suppliers.length + 1;
            }
        }

        document.getElementById('supplierForm').onsubmit = (e) => {
            e.preventDefault();
            const idx = parseInt(document.getElementById('editSupplierIndex').value);
            const data = { 
                name: document.getElementById('suppName').value,
                address: document.getElementById('suppAddress').value || '',
                type: document.getElementById('suppType').value || '',
                person: document.getElementById('suppPerson').value || '',
                designation: document.getElementById('suppDesignation').value || '',
                mobile: document.getElementById('suppMobile').value || '',
                email: document.getElementById('suppEmail').value || ''
            };
            if(idx > -1) suppliers[idx] = data; else suppliers.push(data);
            localStorage.setItem('arvin_suppliers_list', JSON.stringify(suppliers));
            renderSuppliers(); toggleSupplierModal(false);
        };

        function renderSuppliers() {
            document.getElementById('supplierTableBody').innerHTML = suppliers.map((s, i) => `<tr class="border-b"><td class="p-3 font-bold text-blue-600">${i+1}</td><td class="p-3 font-bold">${s.name}</td><td class="p-3">${s.address || ''}</td><td class="p-3">${s.type || ''}</td><td class="p-3">${s.person || ''}</td><td class="p-3">${s.designation || ''}</td><td class="p-3">${s.mobile || ''}</td><td class="p-3">${s.email || ''}</td><td class="p-3 text-center"><button onclick="toggleSupplierModal(true, ${i})" class="text-blue-500 mr-2"><i class="fas fa-edit"></i></button><button onclick="deleteSupp(${i})" class="text-red-400"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function deleteSupp(i) { if(confirm('Delete?')) { suppliers.splice(i,1); localStorage.setItem('arvin_suppliers_list', JSON.stringify(suppliers)); renderSuppliers(); }}

        // Inventory Logic
        function renderInventory() {
            let low = 0, out = 0;
            document.getElementById('inventoryTableBody').innerHTML = products.map(p => {
                const stock = parseInt(p.stock) || 0;
                let status = '<span class="text-green-600 font-bold">In Stock</span>';
                if(stock <= 0) { status = '<span class="text-red-600 font-bold">Out of Stock</span>'; out++; }
                else if(stock < 5) { status = '<span class="text-orange-600 font-bold">Low Stock</span>'; low++; }
                return `<tr class="border-b"><td class="p-3"><b>${p.item}</b></td><td class="p-3 text-xs">${p.desc || ''}</td><td class="p-3 font-bold">${stock} ${p.unit}</td><td class="p-3 text-xs uppercase">${status}</td></tr>`;
            }).join('');
            document.getElementById('totalInvItems').innerText = products.length;
            document.getElementById('lowStockCount').innerText = low;
            document.getElementById('outStockCount').innerText = out;
        }

        // ACCOUNTS LOGIC
        function switchAccountsTab(sub) {
            activeAccountsTab = sub;
            document.querySelectorAll('.accounts-sub-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('accounts-' + sub).classList.add('active');
            
            const subTabs = ['income', 'expense', 'transactions', 'orders'];
            subTabs.forEach(id => {
                const btn = document.getElementById('tab-' + id);
                if(id === sub) {
                    btn.classList.add('ring-2', 'ring-purple-400', 'bg-white');
                } else {
                    btn.classList.remove('ring-2', 'ring-purple-400', 'bg-white');
                }
            });

            const addBtn = document.getElementById('addAccBtn');
            if(sub === 'transactions') addBtn.classList.add('hidden');
            else {
                addBtn.classList.remove('hidden');
                addBtn.onclick = () => {
                    if(sub === 'income' || sub === 'expense') toggleAccModal(true, sub);
                    else if(sub === 'orders') toggleOrderModal(true);
                }
            }
            renderAccounts();
        }

        function toggleAccModal(show, type = '', idx = -1) {
            const modal = document.getElementById('accModal');
            modal.classList.toggle('hidden', !show);
            if(!show) return;

            document.getElementById('accForm').reset();
            document.getElementById('accDate').valueAsDate = new Date();
            document.getElementById('accType').value = type;
            document.getElementById('editAccIndex').value = idx;
            
            const header = document.getElementById('accModalHeader');
            const submit = document.getElementById('accSubmitBtn');
            const title = document.getElementById('accModalTitle');

            if(type === 'income') {
                header.className = 'p-4 text-white flex justify-between items-center bg-green-600 sticky top-0 z-10';
                submit.className = 'w-full bg-green-600 text-white font-bold py-3 rounded-lg uppercase shadow-lg';
                title.innerText = idx > -1 ? 'Edit Income' : 'Add Income';
            } else {
                header.className = 'p-4 text-white flex justify-between items-center bg-red-600 sticky top-0 z-10';
                submit.className = 'w-full bg-red-600 text-white font-bold py-3 rounded-lg uppercase shadow-lg';
                title.innerText = idx > -1 ? 'Edit Expense' : 'Add Expense';
            }

            if(idx > -1) {
                const list = type === 'income' ? income : expense;
                const item = list[idx];
                document.getElementById('accDate').value = item.date;
                document.getElementById('accAmount').value = item.amount;
                document.getElementById('accPurpose').value = item.purpose;
            }
        }

        document.getElementById('accForm').onsubmit = (e) => {
            e.preventDefault();
            const type = document.getElementById('accType').value;
            const idx = parseInt(document.getElementById('editAccIndex').value);
            const data = {
                date: document.getElementById('accDate').value,
                amount: parseFloat(document.getElementById('accAmount').value),
                purpose: document.getElementById('accPurpose').value
            };

            if(type === 'income') {
                if(idx > -1) income[idx] = data; else income.push(data);
                localStorage.setItem('arvin_income_list', JSON.stringify(income));
            } else {
                if(idx > -1) expense[idx] = data; else expense.push(data);
                localStorage.setItem('arvin_expense_list', JSON.stringify(expense));
            }
            renderAccounts();
            toggleAccModal(false);
        };

        function toggleOrderModal(show, idx = -1) {
            const modal = document.getElementById('orderModal');
            modal.classList.toggle('hidden', !show);
            if(!show) return;

            document.getElementById('orderForm').reset();
            document.getElementById('editOrderIndex').value = idx;
            document.getElementById('orderDate').valueAsDate = new Date();

            if(idx > -1) {
                const item = orders[idx];
                document.getElementById('orderClient').value = item.client;
                document.getElementById('orderDate').value = item.date;
                document.getElementById('orderType').value = item.type;
                document.getElementById('orderValue').value = item.value;
                document.getElementById('orderCost').value = item.cost;
            }
        }

        document.getElementById('orderForm').onsubmit = (e) => {
            e.preventDefault();
            const idx = parseInt(document.getElementById('editOrderIndex').value);
            const val = parseFloat(document.getElementById('orderValue').value);
            const cost = parseFloat(document.getElementById('orderCost').value);
            const data = {
                client: document.getElementById('orderClient').value,
                date: document.getElementById('orderDate').value,
                type: document.getElementById('orderType').value,
                value: val,
                cost: cost,
                profit: val - cost
            };

            if(idx > -1) orders[idx] = data; else orders.push(data);
            localStorage.setItem('arvin_orders_list', JSON.stringify(orders));
            renderAccounts();
            toggleOrderModal(false);
        };

        function deleteAcc(type, idx) {
            if(!confirm('Delete this entry?')) return;
            if(type === 'income') { income.splice(idx, 1); localStorage.setItem('arvin_income_list', JSON.stringify(income)); }
            else if(type === 'expense') { expense.splice(idx, 1); localStorage.setItem('arvin_expense_list', JSON.stringify(expense)); }
            else if(type === 'order') { orders.splice(idx, 1); localStorage.setItem('arvin_orders_list', JSON.stringify(orders)); }
            renderAccounts();
        }

        function renderAccounts() {
            const now = new Date();
            const thisYear = now.getFullYear();
            const thisMonth = now.getMonth();

            const sortedIncome = [...income].sort((a,b) => new Date(b.date) - new Date(a.date));
            document.getElementById('incomeTableBody').innerHTML = sortedIncome.map((item, i) => `
                <tr class="border-b">
                    <td class="p-3">${i+1}</td>
                    <td class="p-3">${formatFriendlyDate(item.date)}</td>
                    <td class="p-3 font-bold">${item.purpose}</td>
                    <td class="p-3 text-green-600 font-bold">${item.amount.toFixed(2)}</td>
                    <td class="p-3 text-center">
                        <button onclick="toggleAccModal(true, 'income', ${income.indexOf(item)})" class="text-blue-500 mr-2"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteAcc('income', ${income.indexOf(item)})" class="text-red-400"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');

            const sortedExpense = [...expense].sort((a,b) => new Date(b.date) - new Date(a.date));
            document.getElementById('expenseTableBody').innerHTML = sortedExpense.map((item, i) => `
                <tr class="border-b">
                    <td class="p-3">${i+1}</td>
                    <td class="p-3">${formatFriendlyDate(item.date)}</td>
                    <td class="p-3 font-bold">${item.purpose}</td>
                    <td class="p-3 text-red-600 font-bold">${item.amount.toFixed(2)}</td>
                    <td class="p-3 text-center">
                        <button onclick="toggleAccModal(true, 'expense', ${expense.indexOf(item)})" class="text-blue-500 mr-2"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteAcc('expense', ${expense.indexOf(item)})" class="text-red-400"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');

            let combined = [
                ...income.map(i => ({...i, type: 'INCOME', color: 'text-green-600'})),
                ...expense.map(e => ({...e, type: 'EXPENSE', color: 'text-red-600'}))
            ].sort((a, b) => new Date(b.date) - new Date(a.date));

            document.getElementById('transactionsTableBody').innerHTML = combined.map(tr => `
                <tr class="border-b">
                    <td class="p-3 text-xs">${formatFriendlyDate(tr.date)}</td>
                    <td class="p-3"><span class="text-[10px] font-bold px-2 py-1 rounded bg-gray-100 ${tr.color}">${tr.type}</span></td>
                    <td class="p-3 truncate max-w-[200px]">${tr.purpose}</td>
                    <td class="p-3 font-bold ${tr.color}">${tr.amount.toFixed(2)}</td>
                </tr>
            `).join('');

            const sortedOrders = [...orders].sort((a,b) => new Date(b.date) - new Date(a.date));
            document.getElementById('ordersTableBody').innerHTML = sortedOrders.map((item, i) => `
                <tr class="border-b">
                    <td class="p-3">${i+1}</td>
                    <td class="p-3 font-bold">${item.client}</td>
                    <td class="p-3 text-xs">${formatFriendlyDate(item.date)}</td>
                    <td class="p-3 font-bold">${item.value.toFixed(2)}</td>
                    <td class="p-3 text-red-500">${item.cost.toFixed(2)}</td>
                    <td class="p-3 text-[10px] uppercase">${item.type}</td>
                    <td class="p-3 font-black text-green-600">${item.profit.toFixed(2)}</td>
                    <td class="p-3 text-center">
                        <button onclick="toggleOrderModal(true, ${orders.indexOf(item)})" class="text-blue-500 mr-2"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteAcc('order', ${orders.indexOf(item)})" class="text-red-400"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');

            const totalInc = income.reduce((s, i) => s + i.amount, 0);
            const totalExp = expense.reduce((s, e) => s + e.amount, 0);

            if (activeAccountsTab === 'income') {
                const yearInc = income.filter(i => new Date(i.date).getFullYear() === thisYear).reduce((s, i) => s + i.amount, 0);
                const monthInc = income.filter(i => { const d = new Date(i.date); return d.getFullYear() === thisYear && d.getMonth() === thisMonth; }).reduce((s, i) => s + i.amount, 0);
                updateStatsUI('INCOME', 'text-green-600', 'bg-green-50', 'border-green-100', 'Total Income', totalInc, 'This Year', yearInc, 'This Month', monthInc);
            } 
            else if (activeAccountsTab === 'expense') {
                const yearExp = expense.filter(e => new Date(e.date).getFullYear() === thisYear).reduce((s, e) => s + e.amount, 0);
                const monthExp = expense.filter(e => { const d = new Date(e.date); return d.getFullYear() === thisYear && d.getMonth() === thisMonth; }).reduce((s, e) => s + e.amount, 0);
                updateStatsUI('EXPENSE', 'text-red-600', 'bg-red-50', 'border-red-100', 'Total Expense', totalExp, 'This Year', yearExp, 'This Month', monthExp);
            }
            else if (activeAccountsTab === 'transactions') {
                updateStatsUI('TRANSACTIONS', 'text-blue-600', 'bg-blue-50', 'border-blue-100', 'Total Income', totalInc, 'Total Expense', totalExp, 'Net Balance', totalInc - totalExp);
            }
            else if (activeAccountsTab === 'orders') {
                const totValue = orders.reduce((s, o) => s + o.value, 0);
                const totCost = orders.reduce((s, o) => s + o.cost, 0);
                const totProf = orders.reduce((s, o) => s + o.profit, 0);
                updateStatsUI('ORDERS', 'text-orange-600', 'bg-orange-50', 'border-orange-100', 'Total Orders Value', totValue, 'Total Cost', totCost, 'Total Profit', totProf);
            }
        }

        function updateStatsUI(type, textColor, bgColor, borderColor, l1, v1, l2, v2, l3, v3) {
            document.getElementById('statLabel1').innerText = l1;
            document.getElementById('statVal1').innerText = v1.toFixed(2);
            document.getElementById('statLabel2').innerText = l2;
            document.getElementById('statVal2').innerText = v2.toFixed(2);
            document.getElementById('statLabel3').innerText = l3;
            document.getElementById('statVal3').innerText = v3.toFixed(2);
            
            const cards = ['statCard1', 'statCard2', 'statCard3'];
            cards.forEach(id => {
                const el = document.getElementById(id);
                el.className = `p-3 rounded-xl border ${bgColor} ${borderColor}`;
                const labelEl = el.querySelector('p:first-child');
                if(labelEl) labelEl.className = `stat-label font-bold uppercase ${textColor}`;
                const valEl = el.querySelector('p:last-child');
                if(valEl) valEl.className = `stat-value font-black ${textColor}`;
            });
        }

        // --- INVOICE LOGIC (unchanged) ---
        function switchInvoiceSubTab(sub) {
            document.querySelectorAll('.invoice-sub-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('invoice-' + sub).classList.add('active');
            const btnCreate = document.getElementById('btn-sub-create');
            const btnSaved = document.getElementById('btn-sub-saved');
            const btnSaveAction = document.getElementById('saveInvoiceBtn');
            if(sub === 'create') {
                btnCreate.classList.add('bg-white', 'shadow-sm', 'text-yellow-600');
                btnSaved.classList.remove('bg-white', 'shadow-sm', 'text-yellow-600');
                btnSaveAction.classList.remove('hidden');
            } else {
                btnSaved.classList.add('bg-white', 'shadow-sm', 'text-yellow-600');
                btnCreate.classList.remove('bg-white', 'shadow-sm', 'text-yellow-600');
                btnSaveAction.classList.add('hidden');
                renderSavedInvoices();
            }
        }

        function startNewInvoiceTab() { initInvoiceFields(); switchInvoiceSubTab('create'); }

        function renderClients() {
            document.getElementById('clientTableBody').innerHTML = clients.map((c, i) => `<tr class="border-b"><td class="p-3 font-bold text-red-600">${i+1}</td><td class="p-3">${c.name}</td><td class="p-3 text-xs">${c.address}</td><td class="p-3">${c.person}</td><td class="p-3">${c.designation || ''}</td><td class="p-3">${c.mobile}</td><td class="p-3">${c.email || ''}</td><td class="p-3 text-center"><button onclick="toggleClientModal(true, ${i})" class="text-blue-500 mr-2"><i class="fas fa-edit"></i></button><button onclick="deleteItem('clients', ${i})" class="text-red-400"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }

        function toggleClientModal(s, idx=-1) {
            const m = document.getElementById('clientModal'); m.classList.toggle('hidden', !s);
            if(s) { 
                if(idx>-1) { 
                    const c=clients[idx]; 
                    document.getElementById('clientModalTitle').innerText="Edit Client"; 
                    document.getElementById('editClientIndex').value=idx; 
                    document.getElementById('clientSl').value=idx+1; 
                    document.getElementById('clientName').value=c.name; 
                    document.getElementById('address').value=c.address; 
                    document.getElementById('contactPerson').value=c.person;
                    document.getElementById('designation').value=c.designation || '';
                    document.getElementById('mobile').value=c.mobile;
                    document.getElementById('email').value=c.email || '';
                } else { 
                    document.getElementById('clientForm').reset(); 
                    document.getElementById('clientSl').value=clients.length+1; 
                    document.getElementById('editClientIndex').value=-1;
                }
            }
        }

        document.getElementById('clientForm').onsubmit = (e) => { 
            e.preventDefault(); 
            const idx=parseInt(document.getElementById('editClientIndex').value); 
            const data={ 
                name: document.getElementById('clientName').value, 
                address: document.getElementById('address').value||'N/A', 
                person: document.getElementById('contactPerson').value||'N/A',
                designation: document.getElementById('designation').value||'',
                mobile: document.getElementById('mobile').value||'N/A',
                email: document.getElementById('email').value||''
            }; 
            if(idx>-1) clients[idx]=data; else clients.push(data); 
            localStorage.setItem('arvin_clients_list', JSON.stringify(clients)); 
            renderClients(); toggleClientModal(false); 
        };

        function renderProducts() {
            document.getElementById('productTableBody').innerHTML = products.map((p, i) => `<tr class="border-b"><td class="p-3 font-bold text-orange-600">${i+1}</td><td class="p-3">${p.item}</td><td class="p-3">${p.desc || ''}</td><td class="p-3">${p.unit}</td><td class="p-3">${p.rate}</td><td class="p-3">${p.stock}</td><td class="p-3 text-center"><button onclick="toggleProductModal(true, ${i})" class="text-blue-500 mr-2"><i class="fas fa-edit"></i></button><button onclick="deleteItem('products', ${i})" class="text-red-400"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }

        function toggleProductModal(s, idx=-1) {
            const m = document.getElementById('productModal'); m.classList.toggle('hidden', !s);
            if(s) { 
                if(idx>-1) { 
                    const p=products[idx]; 
                    document.getElementById('productModalTitle').innerText="Edit Product"; 
                    document.getElementById('editProductIndex').value=idx; 
                    document.getElementById('productSl').value=idx+1; 
                    document.getElementById('itemName').value=p.item; 
                    document.getElementById('description').value=p.desc || ''; 
                    document.getElementById('unit').value=p.unit; 
                    document.getElementById('rate').value=p.rate; 
                    document.getElementById('stockQty').value=p.stock; 
                } else { 
                    document.getElementById('productForm').reset(); 
                    document.getElementById('productSl').value=products.length+1; 
                    document.getElementById('editProductIndex').value=-1; 
                }
            }
        }

        document.getElementById('productForm').onsubmit = (e) => { 
            e.preventDefault(); 
            const idx=parseInt(document.getElementById('editProductIndex').value); 
            const data={ 
                item: document.getElementById('itemName').value, 
                desc: document.getElementById('description').value||'N/A', 
                unit: document.getElementById('unit').value||'N/A', 
                rate: document.getElementById('rate').value||0, 
                stock: document.getElementById('stockQty').value||0 
            }; 
            if(idx>-1) products[idx]=data; else products.push(data); 
            localStorage.setItem('arvin_products_list', JSON.stringify(products)); 
            renderProducts(); toggleProductModal(false); 
        };

        function deleteItem(t, i) { if(confirm('Delete?')) { if(t==='clients') clients.splice(i,1); else products.splice(i,1); localStorage.setItem('arvin_'+t+'_list', JSON.stringify(t==='clients'?clients:products)); t==='clients'?renderClients():renderProducts(); }}

        function filterTable(tbodyId, val) {
            const rows = document.getElementById(tbodyId).getElementsByTagName('tr');
            Array.from(rows).forEach(row => { row.style.display = row.innerText.toLowerCase().includes(val.toLowerCase()) ? '' : 'none'; });
        }

        function showClientSuggestions() {
            const val = document.getElementById('invClientInput').value.toLowerCase();
            const list = document.getElementById('clientSuggestions');
            if(!val) { list.style.display = 'none'; return; }
            const matches = clients.filter(c => c.name.toLowerCase().includes(val));
            if(matches.length > 0) {
                list.innerHTML = matches.map(m => `<div class="suggestion-item" onclick="selectClient('${m.name}')"><span class="suggestion-name">${m.name}</span><span class="suggestion-sub"><i class="fas fa-map-marker-alt mr-1"></i>${m.address}</span></div>`).join('');
                list.style.display = 'block';
            } else { list.style.display = 'none'; }
        }

        function selectClient(name) {
            const cIdx = clients.findIndex(c => c.name === name);
            if(cIdx > -1) {
                selectedClientIndex = cIdx;
                document.getElementById('invClientInput').value = name;
                document.getElementById('invAddress').value = clients[cIdx].address;
                document.getElementById('clientSuggestions').style.display = 'none';
            }
        }

        function showProductSuggestions() {
            const val = document.getElementById('invProductInput').value.toLowerCase();
            const list = document.getElementById('productSuggestions');
            if(!val) { list.style.display = 'none'; return; }
            const matches = products.filter(p => p.item.toLowerCase().includes(val));
            if(matches.length > 0) {
                list.innerHTML = matches.map(m => `<div class="suggestion-item" onclick="selectProduct('${m.item}')"><span class="suggestion-name">${m.item}</span><span class="suggestion-desc"><i class="fas fa-info-circle mr-1"></i>${m.desc || 'No description'}</span></div>`).join('');
                list.style.display = 'block';
            } else { list.style.display = 'none'; }
        }

        function selectProduct(item) {
            const pIdx = products.findIndex(p => p.item === item);
            if(pIdx > -1) {
                const p = products[pIdx];
                document.getElementById('invProductInput').value = item;
                document.getElementById('itemDesc').value = p.desc || '';
                document.getElementById('itemUnit').value = p.unit || 'Pcs';
                document.getElementById('itemPrice').value = p.rate || 0;
                calcItemTotal();
                document.getElementById('productSuggestions').style.display = 'none';
            }
        }

        document.addEventListener('click', (e) => { if(!e.target.closest('.autocomplete-wrapper')) document.querySelectorAll('.suggestions-list').forEach(l => l.style.display = 'none'); });

        function initInvoiceFields() {
            const nextNo = 100100 + invoices.length;
            document.getElementById('invNo').value = `INV-${nextNo}`;
            document.getElementById('invDate').valueAsDate = new Date();
            document.getElementById('invClientInput').value = "";
            document.getElementById('invOrderId').value = "";
            document.getElementById('invSubject').value = "";
            document.getElementById('invAddress').value = "";
            document.getElementById('editInvoiceIndex').value = "-1";
            document.getElementById('saveInvoiceBtn').innerText = "SAVE INVOICE";
            selectedClientIndex = -1;
            currentInvoiceItems = [];
            document.getElementById('invPaid').value = 0;
            renderInvoiceItems();
        }

        function toggleItemModal(s) { 
            document.getElementById('itemModal').classList.toggle('hidden', !s); 
            if(s) { 
                document.getElementById('itemForm').reset(); 
                document.getElementById('invProductInput').value = ""; 
                document.getElementById('itemDesc').value = "";
                document.getElementById('itemUnit').value = "";
                document.getElementById('itemPrice').value = "";
                document.getElementById('itemQty').value = "1";
                document.getElementById('itemTotal').value = "0.00";
            } 
        }
        function calcItemTotal() { const q = document.getElementById('itemQty').value || 0; const p = document.getElementById('itemPrice').value || 0; document.getElementById('itemTotal').value = (q * p).toFixed(2); }

        function addItemToInvoice() {
            const name = document.getElementById('invProductInput').value;
            if(!name) return alert("Select a product");
            const qty = parseFloat(document.getElementById('itemQty').value) || 0;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            if(qty <= 0 || price <= 0) return alert("Qty and Price must be positive");
            currentInvoiceItems.push({ 
                name: name, 
                desc: document.getElementById('itemDesc').value || '', 
                unit: document.getElementById('itemUnit').value || 'Pcs', 
                qty: qty, 
                price: price, 
                total: (qty * price).toFixed(2) 
            });
            renderInvoiceItems(); 
            toggleItemModal(false);
        }

        function renderInvoiceItems() {
            let g = 0;
            document.getElementById('invoiceItemsBody').innerHTML = currentInvoiceItems.map((it, i) => { g += parseFloat(it.total); return `<tr class="border-b"><td class="p-3">${i+1}</td><td class="p-3"><b>${it.name}</b></td><td class="p-3">${it.qty}</td><td class="p-3">${it.price}</td><td class="p-3 font-bold">${it.total}</td><td class="p-3"><button onclick="removeItemFromInv(${i})" class="text-red-400"><i class="fas fa-times"></i></button></td></tr>`; }).join('');
            document.getElementById('invGrandTotal').innerText = g.toFixed(2);
            calculateBalance();
        }

        function removeItemFromInv(i) { currentInvoiceItems.splice(i, 1); renderInvoiceItems(); }
        function calculateBalance() { const g = parseFloat(document.getElementById('invGrandTotal').innerText) || 0; const p = parseFloat(document.getElementById('invPaid').value) || 0; document.getElementById('invDue').value = (g - p).toFixed(2); }

        function saveInvoice() {
            const clientName = document.getElementById('invClientInput').value;
            const editIdx = parseInt(document.getElementById('editInvoiceIndex').value);
            if(!clientName || currentInvoiceItems.length === 0) return alert("Fill all details");
            const inv = { id: document.getElementById('invNo').value, client: clientName, orderId: document.getElementById('invOrderId').value, subject: document.getElementById('invSubject').value || '', date: document.getElementById('invDate').value, total: document.getElementById('invGrandTotal').innerText, paid: document.getElementById('invPaid').value, due: document.getElementById('invDue').value, items: JSON.parse(JSON.stringify(currentInvoiceItems)) };
            if(editIdx > -1) { invoices[editIdx] = inv; alert("Invoice Updated!"); } else { invoices.push(inv); alert("Invoice Saved!"); }
            localStorage.setItem('arvin_invoices_list', JSON.stringify(invoices));
            initInvoiceFields(); switchInvoiceSubTab('saved');
        }

        function renderSavedInvoices() {
            const container = document.getElementById('savedInvoicesList');
            if(invoices.length === 0) { container.innerHTML = '<div class="col-span-full text-center py-10 text-gray-400">No saved invoices yet.</div>'; return; }
            container.innerHTML = invoices.map((inv, i) => `
                <div class="bg-white border-l-4 border-yellow-500 shadow-sm rounded-xl p-4 hover:shadow-md transition-all border border-gray-100">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-[11px] font-bold text-yellow-600 uppercase tracking-wider">${inv.id}</span>
                        <span class="text-[10px] text-gray-400">${formatFriendlyDate(inv.date)}</span>
                    </div>
                    <h4 class="text-sm font-bold text-gray-800 truncate mb-3">${inv.client}</h4>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="editInvoice(${i})" class="flex-1 bg-yellow-50 text-yellow-600 py-2 rounded-lg text-[10px] font-bold">EDIT</button>
                        <button onclick="downloadPDF(${i})" class="flex-1 bg-green-50 text-green-600 py-2 rounded-lg text-[10px] font-bold">PDF</button>
                        <button onclick="deleteInvoice(${i})" class="bg-red-50 text-red-500 px-3 py-2 rounded-lg"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }

        function editInvoice(i) {
            const inv = invoices[i];
            document.getElementById('editInvoiceIndex').value = i;
            document.getElementById('invNo').value = inv.id;
            document.getElementById('invDate').value = inv.date;
            document.getElementById('invOrderId').value = inv.orderId || "";
            document.getElementById('invSubject').value = inv.subject || "";
            document.getElementById('invClientInput').value = inv.client;
            const c = clients.find(cl => cl.name === inv.client);
            document.getElementById('invAddress').value = c ? c.address : "N/A";
            currentInvoiceItems = JSON.parse(JSON.stringify(inv.items));
            document.getElementById('invPaid').value = inv.paid || 0;
            document.getElementById('saveInvoiceBtn').innerText = "UPDATE INVOICE";
            renderInvoiceItems(); switchInvoiceSubTab('create');
        }

        function deleteInvoice(i) { if(confirm('Delete?')) { invoices.splice(i, 1); localStorage.setItem('arvin_invoices_list', JSON.stringify(invoices)); renderSavedInvoices(); }}

        function numberToWords(num) {
            const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
            const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
            if (!n) return '';
            let str = '';
            str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'Crore ' : '';
            str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'Lakh ' : '';
            str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'Thousand ' : '';
            str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'Hundred ' : '';
            str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) : '';
            return str.trim() + ' Taka Only';
        }

        // PDF Generation Layout - exactly same as original (unchanged)
        function downloadPDF(index) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const inv = invoices[index];
            const clientData = clients.find(c => c.name === inv.client) || { address: 'N/A', mobile: 'N/A' };

            const addHeaderAndFooter = (data) => {
                if(settings.logo) { 
                    try { 
                        doc.addImage(settings.logo, 'PNG', 95, 3, 15, 15); 
                    } catch(e){} 
                }
                doc.setFontSize(16); 
                doc.setTextColor(0, 0, 0); 
                doc.setFont("helvetica", "bold"); 
                doc.text(settings.company, 105, 22, { align: "center" });
                
                doc.setFontSize(8); 
                doc.setFont("helvetica", "normal"); 
                doc.text(settings.address, 105, 26, { align: "center" });
                
                const contactLine = `Mobile: ${settings.mobile || 'N/A'} | Email: ${settings.email || 'N/A'} | Website: ${settings.website || 'N/A'}`;
                doc.text(contactLine, 105, 30, { align: "center" });
                
                doc.setFontSize(18); 
                doc.setFont("helvetica", "bold"); 
                doc.text("INVOICE", 196, 16, { align: "right" });
                
                doc.setDrawColor(0, 0, 0); 
                doc.setLineWidth(0.5); 
                doc.line(14, 34, 196, 34);
                
                const pageCount = doc.internal.getNumberOfPages();
                doc.setFontSize(8); 
                doc.setFont("helvetica", "normal"); 
                doc.text(`Page ${data.pageNumber} of ${pageCount}`, 196, 288, { align: "right" });
                doc.text("Thank you for your business!", 105, 288, { align: "center" });
            };

            doc.setFontSize(10); 
            doc.setFont("helvetica", "bold"); 
            doc.text("BILL TO:", 14, 42); 
            doc.setFont("helvetica", "normal"); 
            doc.text(inv.client, 14, 47); 
            doc.text(clientData.address, 14, 52, { maxWidth: 80 }); 
            doc.text("Contact: " + clientData.mobile, 14, 60);
            
            doc.setFont("helvetica", "bold"); 
            doc.text("INVOICE DETAILS:", 130, 42);
            doc.setFont("helvetica", "normal"); 
            doc.text(`Invoice No: ${inv.id}`, 130, 47); 
            doc.text(`Date: ${formatFriendlyDate(inv.date)}`, 130, 52); 
            doc.text(`Order ID: ${inv.orderId || 'N/A'}`, 130, 57);

            let currentY = 70; 
            if (inv.subject) { 
                doc.setFont("helvetica", "bold"); 
                doc.text("Subject: " + inv.subject, 14, currentY, { maxWidth: 180 }); 
                currentY += 6; 
            }
            
            const tableData = inv.items.map((item, i) => [i + 1, item.name, item.desc || 'N/A', item.unit || 'Pcs', item.price, item.total]);

            doc.autoTable({
                startY: currentY,
                head: [['SL', 'Items', 'Description', 'Unit', 'Rate', 'Total']],
                body: tableData, 
                theme: 'grid',
                styles: { textColor: [0, 0, 0], fontSize: 9, lineColor: [0, 0, 0], lineWidth: 0.1 },
                headStyles: { fillColor: false, textColor: [0, 0, 0], fontStyle: 'bold', lineWidth: 0.1, lineColor: [0, 0, 0], halign: 'center' },
                columnStyles: {
                    0: { halign: 'center' },
                    3: { halign: 'center' },
                    4: { halign: 'center' },
                    5: { halign: 'center' }
                },
                margin: { top: 38, bottom: 45 }, 
                didDrawPage: (data) => { addHeaderAndFooter(data); }
            });

            let finalY = doc.lastAutoTable.finalY + 6; 
            if (finalY > 235) { doc.addPage(); finalY = 45; }
            
            doc.setFont("helvetica", "bold"); 
            doc.text("Amount in Words:", 14, finalY);
            doc.setFont("helvetica", "normal"); 
            doc.text(numberToWords(Math.round(parseFloat(inv.total))), 14, finalY + 5, { maxWidth: 100 });
            
            doc.setFont("helvetica", "bold"); 
            doc.text("Grand Total:", 140, finalY); 
            doc.text(inv.total, 196, finalY, { align: "right" });
            
            doc.setFont("helvetica", "normal"); 
            doc.text("Paid Amount:", 140, finalY + 6); 
            doc.text(inv.paid || "0.00", 196, finalY + 6, { align: "right" });
            
            doc.setFont("helvetica", "bold"); 
            doc.text("Due Amount:", 140, finalY + 12); 
            doc.text(inv.due || "0.00", 196, finalY + 12, { align: "right" });

            finalY += 18; 
            doc.setFontSize(8); 
            doc.setFont("helvetica", "bold"); 
            doc.text("TERMS & CONDITIONS:", 14, finalY);
            doc.setFont("helvetica", "normal"); 
            doc.text(settings.terms_inv || "1. Payment should be made via check/cash. 2. Goods once sold are not returnable.", 14, finalY + 4, { maxWidth: 120 });

            let sigY = finalY - 5;
            
            if(settings.seal) { 
                try { 
                    doc.addImage(settings.seal, 'PNG', 105, sigY, 18, 18); 
                } catch(e){} 
            }
            
            if(settings.sign) { 
                try { 
                    doc.addImage(settings.sign, 'PNG', 155, sigY + 20, 30, 10); 
                } catch(e){} 
            }
            
            doc.setFont("helvetica", "bold"); 
            doc.text("Authorized Signature", 150, sigY + 35);
            doc.setFont("helvetica", "normal"); 
            doc.text(settings.signatory, 150, sigY + 39); 
            doc.text(settings.designation, 150, sigY + 43);

            doc.save(`${inv.id}_${inv.client}.pdf`);
        }

        function filterClients() { filterTable('clientTableBody', document.getElementById('clientSearch').value); }
        function filterProducts() { filterTable('productTableBody', document.getElementById('productSearch').value); }
    </script>
</body>
</html>