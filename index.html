<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arvin Controls | Enterprise Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --bg-dark: #0f172a;
            --accent-blue: #38bdf8;
            --card-bg: rgba(30, 41, 59, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --modal-bg: rgba(15, 23, 42, 0.98);
            --income-green: #10b981;
            --expense-red: #ef4444;
            --profit-gold: #f59e0b;
        }

        body {
            margin: 0; padding: 0;
            background: radial-gradient(circle at top right, #1e293b 0%, #0f172a 100%);
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden;
        }

        header { text-align: center; padding: 40px 20px 10px; }
        header h1 { margin: 0; font-weight: 800; letter-spacing: -0.05em; font-size: 1.8rem; text-transform: uppercase; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        header p { color: var(--accent-blue); font-size: 0.75rem; font-weight: 600; letter-spacing: 0.2em; margin-top: 5px; text-transform: uppercase; }

        #active-view-indicator {
            margin-bottom: 20px;
            padding: 5px 15px;
            background: rgba(56, 189, 248, 0.1);
            border: 1px solid rgba(56, 189, 248, 0.2);
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 800;
            color: var(--accent-blue);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            display: none;
        }

        .view-container { width: 90%; max-width: 420px; display: none; animation: fadeIn 0.3s ease-out; }
        .view-container.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .search-container { margin-bottom: 15px; position: relative; }
        .search-container i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 0.8rem; }
        .quick-search { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 10px; padding: 10px 10px 10px 35px; color: white; box-sizing: border-box; outline: none; font-size: 0.85rem; transition: 0.3s; }
        .quick-search:focus { border-color: var(--accent-blue); background: rgba(255,255,255,0.1); }

        .bento-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding-bottom: 40px; }

        .nav-header { grid-column: span 3; display: flex; gap: 10px; margin-bottom: 12px; }
        .back-btn, .add-folder-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border); border-radius: 12px; padding: 12px; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .back-btn { flex: 2; color: var(--accent-blue); }
        .add-folder-btn { flex: 1; color: #4ade80; }

        .nav-card { background: var(--card-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid var(--glass-border); border-radius: 18px; height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; text-decoration: none; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; overflow: hidden;}
        .nav-card:hover { border-color: rgba(56, 189, 248, 0.4); background: rgba(30, 41, 59, 0.8); transform: translateY(-2px); }
        .icon-bg { position: absolute; width: 35px; height: 35px; border-radius: 50%; filter: blur(18px); z-index: 1; opacity: 0.15; }
        .nav-card i { font-size: 1.6rem; margin-bottom: 10px; position: relative; z-index: 2; }
        .nav-card span { font-size: 0.65rem; font-weight: 600; color: var(--text-main); position: relative; z-index: 2; text-align: center; width: 90%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .folder-actions { position: absolute; top: 5px; right: 5px; display: flex; gap: 5px; opacity: 0; transition: 0.2s; z-index: 10; }
        .nav-card:hover .folder-actions { opacity: 1; }
        .folder-actions button { background: rgba(0,0,0,0.5); border: none; color: white; width: 20px; height: 20px; border-radius: 4px; font-size: 0.6rem; cursor: pointer; }

        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: var(--bg-dark); border: 1px solid var(--glass-border); border-radius: 24px; padding: 25px; width: 100%; max-width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; }
        .modal-content h3 { margin-top: 0; font-size: 1.1rem; color: var(--accent-blue); display: flex; align-items: center; gap: 10px; }
        
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 0.7rem; color: var(--text-muted); margin-bottom: 5px; text-transform: uppercase; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 10px; padding: 10px; color: white; box-sizing: border-box; outline: none; font-size: 0.9rem; }
        
        .color-picker { display: flex; gap: 10px; margin-top: 5px; }
        .color-opt { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .color-opt.selected { border-color: white; transform: scale(1.1); }

        .q-table-container { margin-top: 15px; overflow-x: auto; }
        .q-table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
        .q-table th { text-align: left; color: var(--text-muted); padding: 8px; border-bottom: 1px solid var(--glass-border); }
        .q-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .grand-total-row { font-weight: 800; color: #4ade80; font-size: 0.9rem; }

        .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
        .modal-actions button { flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-cancel { background: #334155; color: white; }
        .btn-create { background: var(--accent-blue); color: #000; }
        .btn-delete { background: #ef4444; color: white; }
        .btn-download { background: #4ade80; color: #000; }
        .btn-share { background: #25d366; color: white; }
        .btn-print { background: #64748b; color: white; }
        .btn-convert { background: #fbbf24; color: #000; }
        .btn-add-item { background: rgba(56, 189, 248, 0.1); color: var(--accent-blue); border: 1px dashed var(--accent-blue) !important; width: 100%; margin-top: 10px; padding: 8px; font-weight: 600; cursor: pointer; }

        .settings-section { margin-bottom: 10px; border: 1px solid var(--glass-border); border-radius: 15px; background: rgba(255,255,255,0.02); overflow: hidden; }
        .settings-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.3s; background: rgba(255,255,255,0.03); }
        .settings-header:hover { background: rgba(255,255,255,0.07); }
        .settings-header h4 { margin: 0; font-size: 0.85rem; color: var(--accent-blue); text-transform: uppercase; letter-spacing: 0.05em; display: flex; align-items: center; gap: 10px; }
        .settings-header i.chevron { transition: 0.3s; font-size: 0.8rem; color: var(--text-muted); }
        
        .settings-content { padding: 0 15px; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding 0.4s; }
        .settings-section.open .settings-content { max-height: 1000px; padding: 15px; }
        .settings-section.open .settings-header i.chevron { transform: rotate(180deg); color: var(--accent-blue); }

        .img-preview { width: 60px; height: 60px; border: 1px solid var(--glass-border); border-radius: 8px; margin-top: 5px; object-fit: contain; background: #fff; display: none; }

        .inventory-qty-input { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); color: #4ade80; padding: 4px 8px; border-radius: 4px; width: 60px; outline: none; font-weight: bold; text-align: center; }

        #pdf-template { display: none; }

        /* Accounts Summary Cards */
        .summary-cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
        .summary-card { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 12px; padding: 15px; text-align: center; }
        .summary-card.income { border-color: rgba(16, 185, 129, 0.3); }
        .summary-card.expense { border-color: rgba(239, 68, 68, 0.3); }
        .summary-card.balance { border-color: rgba(56, 189, 248, 0.3); }
        .summary-card .value { font-size: 1.4rem; font-weight: 800; margin: 8px 0; }
        .summary-card.income .value { color: var(--income-green); }
        .summary-card.expense .value { color: var(--expense-red); }
        .summary-card.balance .value { color: var(--accent-blue); }
        .summary-card .label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); }

        /* Work Order Summary Cards */
        .summary-card.order { border-color: rgba(245, 158, 11, 0.3); }
        .summary-card.value-card { border-color: rgba(139, 92, 246, 0.3); }
        .summary-card.cost { border-color: rgba(239, 68, 68, 0.3); }
        .summary-card.profit { border-color: rgba(16, 185, 129, 0.3); }
        .summary-card.order .value { color: #f59e0b; }
        .summary-card.value-card .value { color: #8b5cf6; }
        .summary-card.cost .value { color: #ef4444; }
        .summary-card.profit .value { color: #10b981; }

        /* Accounts Table Styling */
        .accounts-table { width: 100%; border-collapse: collapse; font-size: 0.75rem; margin-top: 10px; }
        .accounts-table th { text-align: left; padding: 10px; border-bottom: 2px solid var(--glass-border); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
        .accounts-table.income th { color: var(--income-green); border-color: rgba(16, 185, 129, 0.3); }
        .accounts-table.expense th { color: var(--expense-red); border-color: rgba(239, 68, 68, 0.3); }
        .accounts-table.transactions th { color: var(--accent-blue); border-color: rgba(56, 189, 248, 0.3); }
        .accounts-table.workorder th { color: #f59e0b; border-color: rgba(245, 158, 11, 0.3); }
        
        .accounts-table td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .accounts-table tr:hover { background: rgba(255,255,255,0.03); }
        
        .income-amount { color: var(--income-green); font-weight: 600; }
        .expense-amount { color: var(--expense-red); font-weight: 600; }
        .profit-amount { color: #10b981; font-weight: 600; }
        .loss-amount { color: #ef4444; font-weight: 600; }
        
        .accounts-table tfoot tr { background: rgba(255,255,255,0.05); font-weight: 800; }
        .accounts-table.income tfoot tr { background: rgba(16, 185, 129, 0.1); }
        .accounts-table.expense tfoot tr { background: rgba(239, 68, 68, 0.1); }
        .accounts-table.transactions tfoot tr { background: rgba(56, 189, 248, 0.1); }
        .accounts-table.workorder tfoot tr { background: rgba(245, 158, 11, 0.1); }

        /* Action buttons */
        .table-actions { display: flex; gap: 8px; }
        .table-actions button { background: none; border: none; color: inherit; cursor: pointer; font-size: 0.7rem; opacity: 0.7; transition: opacity 0.2s; }
        .table-actions button:hover { opacity: 1; }

        /* Category Management Styles */
        .category-management {
            padding: 15px;
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            margin-top: 15px;
        }
        
        .category-list {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .category-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        
        .category-item:hover {
            background: rgba(255,255,255,0.07);
            border-color: rgba(56, 189, 248, 0.2);
        }
        
        .category-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .category-name {
            flex: 1;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-main);
        }
        
        .category-actions {
            display: flex;
            gap: 8px;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        
        .category-item:hover .category-actions {
            opacity: 1;
        }
        
        .category-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .edit-btn {
            background: rgba(56, 189, 248, 0.2);
            color: var(--accent-blue);
        }
        
        .delete-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .empty-state i {
            font-size: 2rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        /* Autocomplete styling - Updated for inline suggestions */
        .autocomplete-container { position: relative; }
        .autocomplete-suggestions { 
            position: absolute; 
            border: 1px solid var(--glass-border);
            border-radius: 10px; 
            background: var(--card-bg); 
            backdrop-filter: blur(12px); 
            z-index: 99; 
            top: 100%; 
            left: 0; 
            right: 0; 
            max-height: 200px; 
            overflow-y: auto;
            display: none;
        }
        .autocomplete-suggestion { 
            padding: 10px; 
            cursor: pointer; 
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.85rem;
        }
        .autocomplete-suggestion:hover { 
            background: rgba(56, 189, 248, 0.1); 
        }
        .autocomplete-suggestion strong { 
            color: var(--accent-blue); 
        }
        .autocomplete-suggestion small { 
            color: var(--text-muted); 
            font-size: 0.75rem;
            margin-left: 8px;
        }

        /* Tab-specific category management */
        .tab-management-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .tab-management-title {
            font-size: 1rem;
            color: var(--accent-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tab-back-btn {
            background: rgba(56, 189, 248, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 8px 15px;
            color: var(--accent-blue);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* File Management Styles */
        .file-upload-container {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.02);
            border: 1px dashed var(--glass-border);
            border-radius: 15px;
        }
        
        .file-upload-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px;
            border-radius: 10px;
            background: rgba(255,255,255,0.03);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--accent-blue);
        }
        
        .file-upload-area i {
            font-size: 2.5rem;
            color: var(--accent-blue);
            margin-bottom: 15px;
        }
        
        .file-upload-area p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-muted);
            text-align: center;
        }
        
        .file-upload-area input {
            display: none;
        }
        
        .file-upload-form {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            border: 1px solid var(--glass-border);
        }
        
        .file-upload-form.active {
            display: block;
        }
        
        .files-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        .file-card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .file-card:hover {
            border-color: rgba(56, 189, 248, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .file-icon {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .file-name {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .file-size {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        
        .file-actions {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
        }
        
        .file-btn {
            padding: 6px 10px;
            border-radius: 6px;
            border: none;
            font-size: 0.65rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .preview-btn {
            background: rgba(56, 189, 248, 0.2);
            color: var(--accent-blue);
        }
        
        .download-btn {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }
        
        .delete-file-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .file-preview-modal {
            z-index: 1100;
        }
        
        .file-preview-content {
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .file-preview-container {
            margin-top: 20px;
            text-align: center;
        }
        
        .file-preview-img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
        }
        
        .file-preview-pdf {
            width: 100%;
            height: 400px;
            border: none;
            border-radius: 10px;
        }
        
        .file-preview-text {
            width: 100%;
            height: 300px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 15px;
            color: var(--text-main);
            font-family: monospace;
            font-size: 0.8rem;
            overflow: auto;
            text-align: left;
        }
        
        .file-preview-placeholder {
            padding: 40px 20px;
            text-align: center;
            color: var(--text-muted);
        }
        
        .file-preview-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }
        
        .file-type-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.6rem;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .file-type-image { background: rgba(56, 189, 248, 0.2); color: var(--accent-blue); }
        .file-type-pdf { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .file-type-doc { background: rgba(37, 99, 235, 0.2); color: #2563eb; }
        .file-type-excel { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .file-type-text { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
        .file-type-other { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }

        @media (max-width: 350px) { 
            .bento-grid { grid-template-columns: repeat(2, 1fr); } 
            .nav-header { grid-column: span 2; }
            .summary-cards { grid-template-columns: 1fr; }
            .category-item { flex-direction: column; align-items: flex-start; gap: 10px; }
            .category-actions { align-self: flex-end; }
            .files-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <header>
        <h1 id="brand-header">ARVIN CONTROLS</h1>
        <p id="brand-slogan">ENTERPRISE RESOURCE PLANNING</p>
    </header>

    <div id="active-view-indicator">Home</div>

    <div id="main-menu" class="view-container active">
        <div class="bento-grid">
            <a onclick="openView('main-menu')" class="nav-card"><div class="icon-bg" style="background:#38bdf8"></div><i class="fas fa-house" style="color:#38bdf8"></i><span>Home</span></a>
            <a href="#" class="nav-card"><div class="icon-bg" style="background:#f87171"></div><i class="fas fa-user-tie" style="color:#f87171"></i><span>Management</span></a>
            <a onclick="openView('documents-menu')" class="nav-card"><div class="icon-bg" style="background:#a78bfa"></div><i class="fas fa-file-shield" style="color:#a78bfa"></i><span>Documents</span></a>
            <a onclick="openView('clients-view')" class="nav-card"><div class="icon-bg" style="background:#4ade80"></div><i class="fas fa-handshake" style="color:#4ade80"></i><span>Clients</span></a>
            <a onclick="openView('supplier-view')" class="nav-card"><div class="icon-bg" style="background:#2dd4bf"></div><i class="fas fa-truck-ramp-box" style="color:#2dd4bf"></i><span>Supplier</span></a>
            <a onclick="openView('products-menu')" class="nav-card"><div class="icon-bg" style="background:#fbbf24"></div><i class="fas fa-microchip" style="color:#fbbf24"></i><span>Products</span></a>
            <a onclick="openView('inventory-view')" class="nav-card"><div class="icon-bg" style="background:#60a5fa"></div><i class="fas fa-warehouse" style="color:#60a5fa"></i><span>Inventory</span></a>
            <a onclick="openView('commercial-menu')" class="nav-card"><div class="icon-bg" style="background:#c084fc"></div><i class="fas fa-briefcase" style="color:#c084fc"></i><span>Commercial</span></a>
            <a onclick="openView('accounts-menu')" class="nav-card"><div class="icon-bg" style="background:#34d399"></div><i class="fas fa-vault" style="color:#34d399"></i><span>Accounts</span></a>
            <a onclick="openView('workorder-menu')" class="nav-card"><div class="icon-bg" style="background:#f97316"></div><i class="fas fa-screwdriver-wrench" style="color:#f97316"></i><span>Work Order</span></a>
            <a onclick="openView('projects-menu')" class="nav-card"><div class="icon-bg" style="background:#818cf8"></div><i class="fas fa-diagram-project" style="color:#818cf8"></i><span>Projects</span></a>
            <a onclick="openView('settings-view')" class="nav-card"><div class="icon-bg" style="background:#fb923c"></div><i class="fas fa-gears" style="color:#fb923c"></i><span>Settings</span></a>
        </div>
    </div>

    <div id="inventory-view" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div>
        </div>
        <h3 style="text-align:center; color: #60a5fa; margin-top: 0;">Stock Inventory</h3>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search inventory..." onkeyup="quickFilterTable('inventory-table-body', this.value)">
        </div>

        <div class="q-table-container">
            <table class="q-table">
                <thead>
                    <tr>
                        <th>SL</th>
                        <th>Items</th>
                        <th>Description</th>
                        <th>Available Qty</th>
                    </tr>
                </thead>
                <tbody id="inventory-table-body"></tbody>
            </table>
        </div>
    </div>

    <div id="products-menu" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openView('category-management-view')"><i class="fas fa-folder-plus"></i> Manage Categories</div>
        </div>
        <div class="bento-grid" id="products-menu-folder-grid"></div>
    </div>

    <div id="category-management-view" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('products-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openCategoryModal()"><i class="fas fa-plus"></i> New Category</div>
        </div>
        
        <h3 style="text-align:center; color: var(--accent-blue); margin-top: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <i class="fas fa-folder-tree"></i> Category Management
        </h3>
        
        <p style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin: 10px 0 20px 0;">
            Manage all product categories from here
        </p>
        
        <div class="category-management">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" class="quick-search" placeholder="Search categories..." onkeyup="filterCategories(this.value)">
            </div>
            
            <div class="category-list" id="categories-list">
                <!-- Categories will be loaded here -->
            </div>
        </div>
    </div>

    <div id="folder-content-view" class="view-container">
        <div class="nav-header">
            <div class="back-btn" id="folder-view-back-btn" onclick="openView('products-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" id="add-item-btn-container" onclick="openProductEntryModal()"><i class="fas fa-plus"></i> Add Item</div>
        </div>
        <h3 id="folder-view-title" style="text-align:center; color: var(--accent-blue); margin-top: 0;">Folder</h3>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search items in this folder..." onkeyup="quickFilterTable('folder-products-table-body', this.value)">
        </div>

        <div class="q-table-container">
            <table class="q-table">
                <thead>
                    <tr>
                        <th>SL</th>
                        <th>Items</th>
                        <th>Description</th>
                        <th>Unit</th>
                        <th>Unit Price</th>
                        <th id="folder-action-header">Action</th>
                    </tr>
                </thead>
                <tbody id="folder-products-table-body"></tbody>
            </table>
        </div>
    </div>

    <!-- Documents Menu - Updated with Category Management -->
    <div id="documents-menu" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openView('documents-category-management')"><i class="fas fa-folder-plus"></i> Manage Folders</div>
        </div>
        <div class="bento-grid" id="documents-menu-folder-grid"></div>
    </div>

    <!-- Documents Category Management -->
    <div id="documents-category-management" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('documents-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openTabCategoryModal('documents')"><i class="fas fa-plus"></i> New Folder</div>
        </div>
        
        <div class="tab-management-header">
            <h3 class="tab-management-title">
                <i class="fas fa-file-shield"></i> Documents Folders
            </h3>
        </div>
        
        <p style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin: 10px 0 20px 0;">
            Manage all document folders from here
        </p>
        
        <div class="category-management">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" class="quick-search" placeholder="Search document folders..." onkeyup="filterTabCategories(this.value, 'documents')">
            </div>
            
            <div class="category-list" id="documents-categories-list">
                <!-- Document categories will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Projects Menu - Updated with Category Management -->
    <div id="projects-menu" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openView('projects-category-management')"><i class="fas fa-folder-plus"></i> Manage Folders</div>
        </div>
        <div class="bento-grid" id="projects-menu-folder-grid"></div>
    </div>

    <!-- Projects Category Management -->
    <div id="projects-category-management" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('projects-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openTabCategoryModal('projects')"><i class="fas fa-plus"></i> New Folder</div>
        </div>
        
        <div class="tab-management-header">
            <h3 class="tab-management-title">
                <i class="fas fa-diagram-project"></i> Projects Folders
            </h3>
        </div>
        
        <p style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin: 10px 0 20px 0;">
            Manage all project folders from here
        </p>
        
        <div class="category-management">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" class="quick-search" placeholder="Search project folders..." onkeyup="filterTabCategories(this.value, 'projects')">
            </div>
            
            <div class="category-list" id="projects-categories-list">
                <!-- Project categories will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Documents Folder Files View -->
    <div id="documents-folder-files-view" class="view-container">
        <div class="nav-header">
            <div class="back-btn" id="documents-folder-back-btn"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="showFileUploadForm()"><i class="fas fa-upload"></i> Upload File</div>
        </div>
        
        <h3 id="documents-folder-title" style="text-align:center; color: var(--accent-blue); margin-top: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <i class="fas fa-folder"></i> Folder
        </h3>
        
        <div class="file-upload-container" id="file-upload-container">
            <div class="file-upload-area" onclick="triggerFileUpload()">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to upload or drag & drop files here</p>
                <p style="font-size: 0.7rem; margin-top: 5px;">Supports: JPG, PNG, PDF, Excel, Word, Text, XML, HSE files</p>
                <input type="file" id="file-input" multiple onchange="handleFileSelection(this.files)">
            </div>
            
            <div class="file-upload-form" id="file-upload-form">
                <div class="form-group">
                    <label>File Name</label>
                    <input type="text" id="file-name" placeholder="Enter file name (optional)">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="file-description" rows="2" placeholder="File description (optional)"></textarea>
                </div>
                <div class="modal-actions">
                    <button class="btn-cancel" onclick="cancelFileUpload()">Cancel</button>
                    <button class="btn-create" onclick="uploadFile()">Upload File</button>
                </div>
            </div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search files..." onkeyup="filterFiles(this.value)">
        </div>
        
        <div class="files-grid" id="documents-files-grid">
            <!-- Files will be loaded here -->
        </div>
    </div>

    <!-- Projects Folder Files View -->
    <div id="projects-folder-files-view" class="view-container">
        <div class="nav-header">
            <div class="back-btn" id="projects-folder-back-btn"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="showFileUploadForm('projects')"><i class="fas fa-upload"></i> Upload File</div>
        </div>
        
        <h3 id="projects-folder-title" style="text-align:center; color: var(--accent-blue); margin-top: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <i class="fas fa-folder"></i> Folder
        </h3>
        
        <div class="file-upload-container" id="projects-file-upload-container">
            <div class="file-upload-area" onclick="triggerFileUpload('projects')">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to upload or drag & drop files here</p>
                <p style="font-size: 0.7rem; margin-top: 5px;">Supports: JPG, PNG, PDF, Excel, Word, Text, XML, HSE files</p>
                <input type="file" id="projects-file-input" multiple onchange="handleFileSelection(this.files, 'projects')">
            </div>
            
            <div class="file-upload-form" id="projects-file-upload-form">
                <div class="form-group">
                    <label>File Name</label>
                    <input type="text" id="projects-file-name" placeholder="Enter file name (optional)">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="projects-file-description" rows="2" placeholder="File description (optional)"></textarea>
                </div>
                <div class="modal-actions">
                    <button class="btn-cancel" onclick="cancelFileUpload('projects')">Cancel</button>
                    <button class="btn-create" onclick="uploadFile('projects')">Upload File</button>
                </div>
            </div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search files..." onkeyup="filterFiles(this.value, 'projects')">
        </div>
        
        <div class="files-grid" id="projects-files-grid">
            <!-- Files will be loaded here -->
        </div>
    </div>

    <!-- Work Order Menu - Updated with Category Management -->
    <div id="workorder-menu" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openView('workorder-category-management')"><i class="fas fa-folder-plus"></i> Manage Folders</div>
        </div>
        <div class="bento-grid" id="workorder-menu-folder-grid">
            <!-- Work order folders will be rendered here -->
        </div>
    </div>

    <!-- Work Order Category Management -->
    <div id="workorder-category-management" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('workorder-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openTabCategoryModal('workorder')"><i class="fas fa-plus"></i> New Folder</div>
        </div>
        
        <div class="tab-management-header">
            <h3 class="tab-management-title">
                <i class="fas fa-screwdriver-wrench"></i> Work Order Folders
            </h3>
        </div>
        
        <p style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin: 10px 0 20px 0;">
            Manage all work order folders from here
        </p>
        
        <div class="category-management">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" class="quick-search" placeholder="Search work order folders..." onkeyup="filterTabCategories(this.value, 'workorder')">
            </div>
            
            <div class="category-list" id="workorder-categories-list">
                <!-- Work order categories will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Work Order Folder Files View -->
    <div id="workorder-folder-files-view" class="view-container">
        <div class="nav-header">
            <div class="back-btn" id="workorder-folder-back-btn"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="showFileUploadForm('workorder')"><i class="fas fa-upload"></i> Upload File</div>
        </div>
        
        <h3 id="workorder-folder-title" style="text-align:center; color: var(--accent-blue); margin-top: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <i class="fas fa-folder"></i> Folder
        </h3>
        
        <div class="file-upload-container" id="workorder-file-upload-container">
            <div class="file-upload-area" onclick="triggerFileUpload('workorder')">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to upload or drag & drop files here</p>
                <p style="font-size: 0.7rem; margin-top: 5px;">Supports: JPG, PNG, PDF, Excel, Word, Text, XML, HSE files</p>
                <input type="file" id="workorder-file-input" multiple onchange="handleFileSelection(this.files, 'workorder')">
            </div>
            
            <div class="file-upload-form" id="workorder-file-upload-form">
                <div class="form-group">
                    <label>File Name</label>
                    <input type="text" id="workorder-file-name" placeholder="Enter file name (optional)">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="workorder-file-description" rows="2" placeholder="File description (optional)"></textarea>
                </div>
                <div class="modal-actions">
                    <button class="btn-cancel" onclick="cancelFileUpload('workorder')">Cancel</button>
                    <button class="btn-create" onclick="uploadFile('workorder')">Upload File</button>
                </div>
            </div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search files..." onkeyup="filterFiles(this.value, 'workorder')">
        </div>
        
        <div class="files-grid" id="workorder-files-grid">
            <!-- Files will be loaded here -->
        </div>
    </div>

    <!-- File Preview Modal -->
    <div id="file-preview-modal" class="modal-overlay file-preview-modal">
        <div class="modal-content file-preview-content">
            <h3 id="file-preview-title">File Preview</h3>
            <div class="file-preview-container" id="file-preview-container">
                <!-- File preview will be loaded here -->
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('file-preview-modal')">Close</button>
                <button class="btn-download" onclick="downloadPreviewedFile()"><i class="fas fa-download"></i> Download</button>
            </div>
        </div>
    </div>

    <div id="category-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="category-modal-title">Create New Category</h3>
            <div class="form-group">
                <label>Category Name</label>
                <input type="text" id="category-name" placeholder="Enter category name">
            </div>
            <div class="form-group">
                <label>Category Color</label>
                <div class="color-picker" id="category-color-picker">
                    <div class="color-opt" style="background:#38bdf8" onclick="selectCategoryColor('#38bdf8', this)"></div>
                    <div class="color-opt" style="background:#f87171" onclick="selectCategoryColor('#f87171', this)"></div>
                    <div class="color-opt" style="background:#4ade80" onclick="selectCategoryColor('#4ade80', this)"></div>
                    <div class="color-opt" style="background:#fbbf24" onclick="selectCategoryColor('#fbbf24', this)"></div>
                    <div class="color-opt" style="background:#a78bfa" onclick="selectCategoryColor('#a78bfa', this)"></div>
                    <div class="color-opt" style="background:#2dd4bf" onclick="selectCategoryColor('#2dd4bf', this)"></div>
                    <div class="color-opt" style="background:#fb923c" onclick="selectCategoryColor('#fb923c', this)"></div>
                    <div class="color-opt" style="background:#c084fc" onclick="selectCategoryColor('#c084fc', this)"></div>
                </div>
            </div>
            <input type="hidden" id="category-edit-id" value="">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('category-modal')">Cancel</button>
                <button class="btn-create" onclick="saveCategory()">Save Category</button>
            </div>
        </div>
    </div>

    <div id="product-entry-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="p-modal-title">Add Product Info</h3>
            <div class="form-group"><label>Item Name</label><input type="text" id="p-item"></div>
            <div class="form-group"><label>Description</label><textarea id="p-desc" rows="2"></textarea></div>
            <div class="form-group"><label>Unit</label><input type="text" id="p-unit" placeholder="Pcs, Kg, etc."></div>
            <div class="form-group"><label>Unit Price</label><input type="number" id="p-price"></div>
            <input type="hidden" id="p-edit-idx" value="-1">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('product-entry-modal')">Cancel</button>
                <button class="btn-create" onclick="saveProductEntry()">Save Entry</button>
            </div>
        </div>
    </div>

    <div id="clients-view" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openClientModal()"><i class="fas fa-plus"></i> Add</div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search clients..." onkeyup="quickFilterTable('clients-table-body', this.value)">
        </div>

        <div class="q-table-container">
            <table class="q-table">
                <thead>
                    <tr>
                        <th>SL</th>
                        <th>Client</th>
                        <th>Person</th>
                        <th>Phone</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="clients-table-body"></tbody>
            </table>
        </div>
    </div>

    <div id="supplier-view" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openSupplierModal()"><i class="fas fa-plus"></i> Add</div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search suppliers..." onkeyup="quickFilterTable('supplier-table-body', this.value)">
        </div>

        <div class="q-table-container">
            <table class="q-table">
                <thead>
                    <tr>
                        <th>SL</th>
                        <th>Org</th>
                        <th>Product</th>
                        <th>Phone</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="supplier-table-body"></tbody>
            </table>
        </div>
    </div>

    <div id="folder-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="folder-modal-title">Create Sub Folder</h3>
            <div class="form-group"><label>Folder Name</label><input type="text" id="f-name"></div>
            <div class="form-group">
                <label>Folder Color</label>
                <div class="color-picker" id="f-color-picker">
                    <div class="color-opt" style="background:#38bdf8" onclick="selectFolderColor('#38bdf8', this)"></div>
                    <div class="color-opt" style="background:#f87171" onclick="selectFolderColor('#f87171', this)"></div>
                    <div class="color-opt" style="background:#4ade80" onclick="selectFolderColor('#4ade80', this)"></div>
                    <div class="color-opt" style="background:#fbbf24" onclick="selectFolderColor('#fbbf24', this)"></div>
                    <div class="color-opt" style="background:#a78bfa" onclick="selectFolderColor('#a78bfa', this)"></div>
                </div>
            </div>
            <input type="hidden" id="f-parent">
            <input type="hidden" id="f-edit-id">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('folder-modal')">Cancel</button>
                <button class="btn-create" onclick="saveFolder()">Save Folder</button>
            </div>
        </div>
    </div>

    <div id="settings-view" class="view-container">
        <div class="nav-header" style="margin-bottom: 20px;">
            <div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div>
        </div>

        <div class="settings-section">
            <div class="settings-header" onclick="toggleSection(this)">
                <h4><i class="fas fa-building"></i> General Information</h4>
                <i class="fas fa-chevron-down chevron"></i>
            </div>
            <div class="settings-content">
                <div class="form-group"><label>Company Name</label><input type="text" id="set-comp-name"></div>
                <div class="form-group"><label>Company Slogan</label><input type="text" id="set-comp-slogan" placeholder="e.g. Innovation in Control"></div>
                <div class="form-group"><label>Company Address</label><textarea id="set-comp-addr" rows="2"></textarea></div>
                <div class="form-group"><label>Mobile</label><input type="text" id="set-comp-mobile"></div>
                <div class="form-group"><label>Email</label><input type="text" id="set-comp-email"></div>
                <div class="form-group"><label>Website</label><input type="text" id="set-comp-web"></div>
                <div class="form-group"><label>Currency Symbol</label>
                    <select id="set-currency">
                        <option value=""> (BDT)</option>
                        <option value="$">$ (USD)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-header" onclick="toggleSection(this)">
                <h4><i class="fas fa-file-pdf"></i> PDF Page Layout</h4>
                <i class="fas fa-chevron-down chevron"></i>
            </div>
            <div class="settings-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group"><label>Top (in)</label><input type="number" step="0.1" id="set-m-top" value="0.5"></div>
                    <div class="form-group"><label>Bottom (in)</label><input type="number" step="0.1" id="set-m-bottom" value="0.5"></div>
                    <div class="form-group"><label>Left (in)</label><input type="number" step="0.1" id="set-m-left" value="0.5"></div>
                    <div class="form-group"><label>Right (in)</label><input type="number" step="0.1" id="set-m-right" value="0.5"></div>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-header" onclick="toggleSection(this)">
                <h4><i class="fas fa-stamp"></i> Media & Seals</h4>
                <i class="fas fa-chevron-down chevron"></i>
            </div>
            <div class="settings-content">
                <div class="form-group"><label>Company Logo</label><input type="file" accept="image/*" onchange="encodeImg(this, 'prev-logo', 'data-logo')"><img id="prev-logo" class="img-preview"></div>
                <div class="form-group"><label>Company Seal</label><input type="file" accept="image/*" onchange="encodeImg(this, 'prev-seal', 'data-seal')"><img id="prev-seal" class="img-preview"></div>
                <div class="form-group"><label>Doc Signature (General)</label><input type="file" accept="image/*" onchange="encodeImg(this, 'prev-gen-sig', 'data-gen-sig')"><img id="prev-gen-sig" class="img-preview"></div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-header" onclick="toggleSection(this)">
                <h4><i class="fas fa-user-shield"></i> Executive Management</h4>
                <i class="fas fa-chevron-down chevron"></i>
            </div>
            <div class="settings-content">
                <div class="form-group"><label>Chairman's Name</label><input type="text" id="set-chair-name"></div>
                <div class="form-group"><label>Chairman's Message</label><textarea id="set-chair-msg"></textarea></div>
                <div class="form-group"><label>Chairman's Signature</label><input type="file" accept="image/*" onchange="encodeImg(this, 'prev-chair-sig', 'data-chair-sig')"><img id="prev-chair-sig" class="img-preview"></div>
                <hr style="border:0; border-top:1px solid var(--glass-border); margin:15px 0;">
                <div class="form-group"><label>MD's Name</label><input type="text" id="set-md-name"></div>
                <div class="form-group"><label>MD's Message</label><textarea id="set-md-msg"></textarea></div>
                <div class="form-group"><label>MD's Signature</label><input type="file" accept="image/*" onchange="encodeImg(this, 'prev-md-sig', 'data-md-sig')"><img id="prev-md-sig" class="img-preview"></div>
                <hr style="border:0; border-top:1px solid var(--glass-border); margin:15px 0;">
                <div class="form-group"><label>Director's Name</label><input type="text" id="set-dir-name"></div>
                <div class="form-group"><label>Director's Message</label><textarea id="set-dir-msg"></textarea></div>
                <div class="form-group"><label>Director's Signature</label><input type="file" accept="image/*" onchange="encodeImg(this, 'prev-dir-sig', 'data-dir-sig')"><img id="prev-dir-sig" class="img-preview"></div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-header" onclick="toggleSection(this)">
                <h4><i class="fas fa-file-signature"></i> Authorized Signatory</h4>
                <i class="fas fa-chevron-down chevron"></i>
            </div>
            <div class="settings-content">
                <div class="form-group"><label>Signatory Name</label><input type="text" id="set-sig-name"></div>
                <div class="form-group"><label>Signatory Designation</label><input type="text" id="set-sig-desig"></div>
                <div class="form-group"><label>Upload Signature</label><input type="file" accept="image/*" onchange="encodeImg(this, 'prev-auth-sig', 'data-auth-sig')"><img id="prev-auth-sig" class="img-preview"></div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-header" onclick="toggleSection(this)">
                <h4><i class="fas fa-list-check"></i> Terms & Conditions</h4>
                <i class="fas fa-chevron-down chevron"></i>
            </div>
            <div class="settings-content">
                <div class="form-group"><label>Quotation Terms</label><textarea id="set-terms-q" rows="3"></textarea></div>
                <div class="form-group"><label>Invoice Terms</label><textarea id="set-terms-inv" rows="3"></textarea></div>
                <div class="form-group"><label>Challan Terms</label><textarea id="set-terms-ch" rows="3"></textarea></div>
                <div class="form-group"><label>PO Terms</label><textarea id="set-terms-po" rows="3"></textarea></div>
            </div>
        </div>

        <div class="modal-actions" style="margin-bottom: 50px;">
            <button class="btn-create" onclick="saveSettings()">Save & Update</button>
        </div>
    </div>

    <div id="commercial-menu" class="view-container">
        <div class="bento-grid">
            <div class="nav-header"><div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div></div>
            <a onclick="openView('folder-quotation')" class="nav-card"><div class="icon-bg" style="background:#c084fc"></div><i class="fas fa-file-lines" style="color:#c084fc"></i><span>Quotation</span></a>
            <a onclick="openView('folder-invoice')" class="nav-card"><div class="icon-bg" style="background:#c084fc"></div><i class="fas fa-file-invoice" style="color:#c084fc"></i><span>Invoice</span></a>
            <a onclick="openView('folder-challan')" class="nav-card"><div class="icon-bg" style="background:#c084fc"></div><i class="fas fa-truck-fast" style="color:#c084fc"></i><span>Delivery Challan</span></a>
            <a onclick="openView('folder-po')" class="nav-card"><div class="icon-bg" style="background:#c084fc"></div><i class="fas fa-cart-shopping" style="color:#c084fc"></i><span>Purchase Order</span></a>
            <a onclick="openView('folder-receipt')" class="nav-card"><div class="icon-bg" style="background:#c084fc"></div><i class="fas fa-receipt" style="color:#c084fc"></i><span>Money Receipt</span></a>
        </div>
    </div>

    <div id="folder-quotation" class="view-container"><div class="bento-grid" id="grid-quotation"><div class="nav-header"><div class="back-btn" onclick="openView('commercial-menu')"><i class="fas fa-arrow-left"></i> Back</div><div class="add-folder-btn" onclick="openDocModal('QUOTATION')"><i class="fas fa-plus"></i> New</div></div></div></div>
    <div id="folder-invoice" class="view-container"><div class="bento-grid" id="grid-invoice"><div class="nav-header"><div class="back-btn" onclick="openView('commercial-menu')"><i class="fas fa-arrow-left"></i> Back</div><div class="add-folder-btn" onclick="openDocModal('INVOICE')"><i class="fas fa-plus"></i> New</div></div></div></div>
    <div id="folder-challan" class="view-container"><div class="bento-grid" id="grid-challan"><div class="nav-header"><div class="back-btn" onclick="openView('commercial-menu')"><i class="fas fa-arrow-left"></i> Back</div><div class="add-folder-btn" onclick="openDocModal('CHALLAN')"><i class="fas fa-plus"></i> New</div></div></div></div>
    <div id="folder-po" class="view-container"><div class="bento-grid" id="grid-po"><div class="nav-header"><div class="back-btn" onclick="openView('commercial-menu')"><i class="fas fa-arrow-left"></i> Back</div><div class="add-folder-btn" onclick="openDocModal('PO')"><i class="fas fa-plus"></i> New</div></div></div></div>
    <div id="folder-receipt" class="view-container"><div class="bento-grid" id="grid-receipt"><div class="nav-header"><div class="back-btn" onclick="openView('commercial-menu')"><i class="fas fa-arrow-left"></i> Back</div><div class="add-folder-btn" onclick="openMR()"><i class="fas fa-plus"></i> New</div></div></div></div>

    <div id="accounts-menu" class="view-container">
        <div class="bento-grid">
            <div class="nav-header"><div class="back-btn" onclick="openView('main-menu')"><i class="fas fa-arrow-left"></i> Back</div></div>
            <a onclick="openView('folder-income')" class="nav-card"><div class="icon-bg" style="background:#4ade80"></div><i class="fas fa-money-bill-trend-up" style="color:#4ade80"></i><span>Income</span></a>
            <a onclick="openView('folder-expense')" class="nav-card"><div class="icon-bg" style="background:#f87171"></div><i class="fas fa-money-bill-transfer" style="color:#f87171"></i><span>Expense</span></a>
            <a onclick="openView('folder-transactions')" class="nav-card"><div class="icon-bg" style="background:#60a5fa"></div><i class="fas fa-building-columns" style="color:#60a5fa"></i><span>Transactions</span></a>
        </div>
    </div>

    <div id="folder-income" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('accounts-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openIncomeModal()"><i class="fas fa-plus"></i> Add Income</div>
        </div>
        <h3 style="text-align:center; color:var(--income-green); margin-top: 0;">Income Records</h3>
        
        <div class="summary-cards">
            <div class="summary-card income">
                <div class="label">Total Income</div>
                <div class="value" id="total-income"> 0</div>
            </div>
            <div class="summary-card balance">
                <div class="label">This Month</div>
                <div class="value" id="month-income"> 0</div>
            </div>
            <div class="summary-card income" style="grid-column: span 2;">
                <div class="label">This Year</div>
                <div class="value" id="year-income"> 0</div>
            </div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search income records..." onkeyup="quickFilterTable('income-table-body', this.value)">
        </div>

        <div class="q-table-container">
            <table class="accounts-table income">
                <thead>
                    <tr>
                        <th>SL</th>
                        <th>Date</th>
                        <th>Purpose</th>
                        <th>Amount</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="income-table-body"></tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; font-weight: 800;">Grand Total:</td>
                        <td id="income-grand-total" style="color: var(--income-green); font-weight: 800;"> 0</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div id="folder-expense" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('accounts-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openExpenseModal()"><i class="fas fa-plus"></i> Add Expense</div>
        </div>
        <h3 style="text-align:center; color:var(--expense-red); margin-top: 0;">Expense Tracking</h3>
        
        <div class="summary-cards">
            <div class="summary-card expense">
                <div class="label">Total Expense</div>
                <div class="value" id="total-expense"> 0</div>
            </div>
            <div class="summary-card balance">
                <div class="label">This Month</div>
                <div class="value" id="month-expense"> 0</div>
            </div>
            <div class="summary-card expense" style="grid-column: span 2;">
                <div class="label">This Year</div>
                <div class="value" id="year-expense"> 0</div>
            </div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search expense records..." onkeyup="quickFilterTable('expense-table-body', this.value)">
        </div>

        <div class="q-table-container">
            <table class="accounts-table expense">
                <thead>
                    <tr>
                        <th>SL</th>
                        <th>Date</th>
                        <th>Purpose</th>
                        <th>Amount</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="expense-table-body"></tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; font-weight: 800;">Grand Total:</td>
                        <td id="expense-grand-total" style="color: var(--expense-red); font-weight: 800;"> 0</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div id="folder-transactions" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('accounts-menu')"><i class="fas fa-arrow-left"></i> Back</div>
        </div>
        <h3 style="text-align:center; color:var(--accent-blue); margin-top: 0;">Transaction History</h3>
        
        <div class="summary-cards">
            <div class="summary-card income">
                <div class="label">Total Income</div>
                <div class="value" id="summary-total-income"> 0</div>
            </div>
            <div class="summary-card expense">
                <div class="label">Total Expense</div>
                <div class="value" id="summary-total-expense"> 0</div>
            </div>
            <div class="summary-card balance" style="grid-column: span 2;">
                <div class="label">Current Balance</div>
                <div class="value" id="current-balance"> 0</div>
            </div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search transactions..." onkeyup="quickFilterTable('transactions-table-body', this.value)">
        </div>

        <div class="q-table-container">
            <table class="accounts-table transactions">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="transactions-table-body"></tbody>
            </table>
        </div>
    </div>

    <div id="folder-workorder-summary" class="view-container">
        <div class="nav-header">
            <div class="back-btn" onclick="openView('workorder-menu')"><i class="fas fa-arrow-left"></i> Back</div>
            <div class="add-folder-btn" onclick="openWorkOrderModal()"><i class="fas fa-plus"></i> Add Order</div>
        </div>
        <h3 style="text-align:center; color:#f59e0b; margin-top: 0;">Work Order Summary</h3>
        
        <div class="summary-cards">
            <div class="summary-card order">
                <div class="label">Total Orders</div>
                <div class="value" id="total-orders">0</div>
            </div>
            <div class="summary-card value-card">
                <div class="label">Total Value</div>
                <div class="value" id="total-order-value"> 0</div>
            </div>
            <div class="summary-card cost">
                <div class="label">Total Cost</div>
                <div class="value" id="total-order-cost"> 0</div>
            </div>
            <div class="summary-card profit">
                <div class="label">Total Profit</div>
                <div class="value" id="total-order-profit"> 0</div>
            </div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" class="quick-search" placeholder="Search work orders..." onkeyup="quickFilterTable('workorder-table-body', this.value)">
        </div>

        <div class="q-table-container">
            <table class="accounts-table workorder">
                <thead>
                    <tr>
                        <th>SL</th>
                        <th>Date</th>
                        <th>Client</th>
                        <th>Order ID</th>
                        <th>Type</th>
                        <th>Value</th>
                        <th>Cost</th>
                        <th>Profit</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="workorder-table-body"></tbody>
                <tfoot>
                    <tr>
                        <td colspan="5" style="text-align: right; font-weight: 800;">Grand Total Profit:</td>
                        <td id="workorder-total-value" style="color: #8b5cf6; font-weight: 800;"> 0</td>
                        <td id="workorder-total-cost" style="color: #ef4444; font-weight: 800;"> 0</td>
                        <td id="workorder-grand-profit" style="color: #10b981; font-weight: 800;"> 0</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Tab Category Modal (for Documents, Work Order, Projects) -->
    <div id="tab-category-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="tab-category-modal-title">Create New Folder</h3>
            <div class="form-group">
                <label>Folder Name</label>
                <input type="text" id="tab-category-name" placeholder="Enter folder name">
            </div>
            <div class="form-group">
                <label>Folder Color</label>
                <div class="color-picker" id="tab-category-color-picker">
                    <div class="color-opt" style="background:#38bdf8" onclick="selectTabCategoryColor('#38bdf8', this)"></div>
                    <div class="color-opt" style="background:#f87171" onclick="selectTabCategoryColor('#f87171', this)"></div>
                    <div class="color-opt" style="background:#4ade80" onclick="selectTabCategoryColor('#4ade80', this)"></div>
                    <div class="color-opt" style="background:#fbbf24" onclick="selectTabCategoryColor('#fbbf24', this)"></div>
                    <div class="color-opt" style="background:#a78bfa" onclick="selectTabCategoryColor('#a78bfa', this)"></div>
                    <div class="color-opt" style="background:#2dd4bf" onclick="selectTabCategoryColor('#2dd4bf', this)"></div>
                    <div class="color-opt" style="background:#fb923c" onclick="selectTabCategoryColor('#fb923c', this)"></div>
                    <div class="color-opt" style="background:#c084fc" onclick="selectTabCategoryColor('#c084fc', this)"></div>
                </div>
            </div>
            <input type="hidden" id="tab-category-edit-id" value="">
            <input type="hidden" id="tab-category-parent" value="">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('tab-category-modal')">Cancel</button>
                <button class="btn-create" onclick="saveTabCategory()">Save Folder</button>
            </div>
        </div>
    </div>

    <!-- Income Modal -->
    <div id="income-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="income-modal-title">Add Income Record</h3>
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="income-date">
            </div>
            <div class="form-group">
                <label>Purpose</label>
                <input type="text" id="income-purpose" placeholder="e.g., Invoice Payment, Service Fee, etc.">
            </div>
            <div class="form-group">
                <label>Amount ()</label>
                <input type="number" id="income-amount" min="0" step="0.01">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="income-description" rows="2" placeholder="Additional details..."></textarea>
            </div>
            <input type="hidden" id="income-edit-id" value="-1">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('income-modal')">Cancel</button>
                <button class="btn-create" onclick="saveIncome()">Save Record</button>
            </div>
        </div>
    </div>

    <!-- Expense Modal -->
    <div id="expense-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="expense-modal-title">Add Expense Record</h3>
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="expense-date">
            </div>
            <div class="form-group">
                <label>Purpose</label>
                <input type="text" id="expense-purpose" placeholder="e.g., Office Supplies, Utilities, etc.">
            </div>
            <div class="form-group">
                <label>Amount ()</label>
                <input type="number" id="expense-amount" min="0" step="0.01">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="expense-description" rows="2" placeholder="Additional details..."></textarea>
            </div>
            <input type="hidden" id="expense-edit-id" value="-1">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('expense-modal')">Cancel</button>
                <button class="btn-create" onclick="saveExpense()">Save Record</button>
            </div>
        </div>
    </div>

    <!-- Work Order Modal -->
    <div id="workorder-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="workorder-modal-title">Add Work Order</h3>
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="workorder-date">
            </div>
            <div class="form-group autocomplete-container">
                <label>Client</label>
                <input type="text" id="workorder-client" placeholder="Type client name..." onkeyup="filterClients(this)">
                <div id="client-autocomplete" class="autocomplete-suggestions"></div>
            </div>
            <div class="form-group">
                <label>Order ID</label>
                <input type="text" id="workorder-id" placeholder="e.g., WO-2024-001">
            </div>
            <div class="form-group">
                <label>Order Type</label>
                <input type="text" id="workorder-type" placeholder="e.g., Installation, Maintenance, etc.">
            </div>
            <div class="form-group">
                <label>Order Value ()</label>
                <input type="number" id="workorder-value" min="0" step="0.01">
            </div>
            <div class="form-group">
                <label>Order Cost ()</label>
                <input type="number" id="workorder-cost" min="0" step="0.01">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="workorder-description" rows="2" placeholder="Order details..."></textarea>
            </div>
            <input type="hidden" id="workorder-edit-id" value="-1">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('workorder-modal')">Cancel</button>
                <button class="btn-create" onclick="saveWorkOrder()">Save Order</button>
            </div>
        </div>
    </div>

    <div id="client-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="cl-modal-title">Client Information</h3>
            <div class="form-group"><label>Client Name</label><input type="text" id="cl-name"></div>
            <div class="form-group"><label>Address</label><textarea id="cl-address" rows="2"></textarea></div>
            <div class="form-group"><label>Contact Person</label><input type="text" id="cl-person"></div>
            <div class="form-group"><label>Phone</label><input type="text" id="cl-phone"></div>
            <div class="form-group"><label>Email</label><input type="email" id="cl-email"></div>
            <input type="hidden" id="cl-edit-idx" value="-1">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('client-modal')">Cancel</button>
                <button class="btn-create" onclick="saveClient()">Save Client</button>
            </div>
        </div>
    </div>

    <div id="supplier-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="sup-modal-title">Supplier Information</h3>
            <div class="form-group"><label>Organization</label><input type="text" id="sup-org"></div>
            <div class="form-group"><label>Address</label><textarea id="sup-address" rows="2"></textarea></div>
            <div class="form-group"><label>Contact Person</label><input type="text" id="sup-person"></div>
            <div class="form-group"><label>Phone</label><input type="text" id="sup-phone"></div>
            <div class="form-group"><label>Email</label><input type="email" id="sup-email"></div>
            <div class="form-group"><label>Product Type</label><input type="text" id="sup-type" placeholder="e.g. Electronics, Raw Materials"></div>
            <input type="hidden" id="sup-edit-idx" value="-1">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('supplier-modal')">Cancel</button>
                <button class="btn-create" onclick="saveSupplier()">Save Supplier</button>
            </div>
        </div>
    </div>

    <div id="action-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 280px;">
            <h3 id="action-target-id">Options</h3>
            <div class="modal-actions" style="flex-direction: column;" id="standard-actions">
                <button class="btn-download" onclick="triggerDownload('download')"><i class="fas fa-file-pdf"></i> Download PDF</button>
                <button class="btn-print" onclick="triggerDownload('print')"><i class="fas fa-print"></i> Print PDF</button>
                <button class="btn-share" onclick="triggerDownload('share')"><i class="fab fa-whatsapp"></i> Share on WhatsApp</button>
                <div id="convert-options" style="display: none; width: 100%; flex-direction: column; gap: 10px;">
                    <button class="btn-convert" onclick="convertDoc('INVOICE')"><i class="fas fa-file-invoice"></i> Convert to Invoice</button>
                    <button class="btn-convert" onclick="convertDoc('CHALLAN')"><i class="fas fa-truck-fast"></i> Convert to Challan</button>
                </div>
                <button class="btn-create" onclick="triggerEdit()"><i class="fas fa-edit"></i> Edit</button>
                <button class="btn-delete" onclick="triggerDelete()"><i class="fas fa-trash"></i> Delete</button>
                <button class="btn-cancel" onclick="closeModal('action-modal')">Cancel</button>
            </div>
        </div>
    </div>

    <div id="doc-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <h3 id="doc-title">Document</h3>
            
            <!-- Client Autocomplete Field -->
            <div class="form-group autocomplete-container">
                <label>Client</label>
                <input type="text" id="doc-client" placeholder="Type client name..." onkeyup="showClientSuggestions(this)">
                <div id="client-suggestions" class="autocomplete-suggestions"></div>
            </div>
            
            <div class="form-group"><label>Address</label><textarea id="doc-address" rows="2" readonly></textarea></div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex: 1;"><label>ID</label><input type="text" id="doc-id" readonly></div>
                <div class="form-group" style="flex: 1;"><label>Date</label><input type="date" id="doc-date"></div>
            </div>
            <div id="tax-fields" style="display: none; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="form-group"><label>VAT (%)</label><input type="number" id="doc-vat" value="0"></div>
                <div class="form-group"><label>AIT (%)</label><input type="number" id="doc-ait" value="0"></div>
            </div>
            <div id="payment-fields" style="display: none;">
                <div class="form-group"><label>Paid Amount</label><input type="number" id="doc-paid" value="0" oninput="renderDocTable()"></div>
            </div>
            <div id="extra-fields"></div>
            <div class="q-table-container">
                <table class="q-table"><thead><tr id="doc-table-head"></tr></thead><tbody id="doc-table-body"></tbody><tfoot><tr id="doc-table-foot"></tr></tfoot></table>
                <button class="btn-add-item" onclick="openItemModal()">+ Add Item</button>
            </div>
            <div class="modal-actions"><button class="btn-cancel" onclick="closeModal('doc-modal')">Cancel</button><button class="btn-create" onclick="saveDocument()">Save</button></div>
        </div>
    </div>

    <div id="mr-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Money Receipt</h3>
            <!-- Client Autocomplete for Money Receipt -->
            <div class="form-group autocomplete-container">
                <label>Received From</label>
                <input type="text" id="mr-client" placeholder="Type client name..." onkeyup="showClientSuggestions(this, 'mr')">
                <div id="mr-client-suggestions" class="autocomplete-suggestions"></div>
            </div>
            <div class="form-group"><label>Address</label><textarea id="mr-address" readonly rows="2"></textarea></div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex:1;"><label>Receipt ID</label><input type="text" id="mr-id" readonly></div>
                <div class="form-group" style="flex:1;"><label>Date</label><input type="date" id="mr-date"></div>
            </div>
            <div class="form-group"><label>Received Amount</label><input type="number" id="mr-amount" oninput="updateWords()"></div>
            <div class="form-group"><label>Amount In Words</label><input type="text" id="mr-words" readonly style="color: #4ade80; font-weight: 600;"></div>
            <div class="form-group"><label>Payment Mode</label>
                <select id="mr-mode" onchange="toggleChequeFields()">
                    <option value="Cash">Cash</option>
                    <option value="Cheque">Cheque</option>
                    <option value="Pay Order">Pay Order</option>
                    <option value="TT">TT</option>
                    <option value="Mobile Banking">Mobile Banking</option>
                </select>
            </div>
            <div id="cheque-details" style="display:none;">
                <div style="display: flex; gap:10px;">
                    <div class="form-group" style="flex:1;"><label>Cheque No.</label><input type="text" id="mr-chq-no"></div>
                    <div class="form-group" style="flex:1;"><label>Bank Name</label><input type="text" id="mr-bank"></div>
                </div>
            </div>
            <div class="modal-actions"><button class="btn-cancel" onclick="closeModal('mr-modal')">Cancel</button><button class="btn-create" onclick="saveMoneyReceipt()">Save Receipt</button></div>
        </div>
    </div>

    <div id="item-modal" class="modal-overlay" style="z-index: 1200;">
        <div class="modal-content" style="max-width: 320px;">
            <h3>Item Details</h3>
            <!-- Product Autocomplete Field -->
            <div class="form-group autocomplete-container">
                <label>Product</label>
                <input type="text" id="item-select" placeholder="Type product name..." onkeyup="showProductSuggestions(this)">
                <div id="product-suggestions" class="autocomplete-suggestions"></div>
            </div>
            <div class="form-group"><label>Desc</label><input type="text" id="item-desc"></div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex: 1;"><label>Qty</label><input type="number" id="item-qty"></div>
                <div class="form-group" style="flex: 1;"><label>Unit</label><input type="text" id="item-unit"></div>
            </div>
            <div class="form-group" id="item-price-field"><label>Price</label><input type="number" id="item-price"></div>
            <div class="form-group" id="item-remarks-field" style="display:none;"><label>Remarks</label><input type="text" id="item-remarks"></div>
            <div class="modal-actions"><button class="btn-cancel" onclick="closeModal('item-modal')">Back</button><button class="btn-create" onclick="addItemToList()">Add</button></div>
        </div>
    </div>

    <div id="pdf-template">
        <div id="pdf-inner-content" style="position: relative; min-height: 10.5in; font-family: Arial, sans-serif; color: #333; background: #fff; box-sizing: border-box; overflow: hidden; page-break-inside: avoid; padding-right: 15px;">
            
            <div id="pdf-top-left-box" style="position: absolute; top: 0; left: 20px; width: 40px; height: 40px; background: #0000FF; z-index: 10; transform: rotate(90deg);"></div>
            <div id="pdf-top-left-box-2" style="position: absolute; top: 20px; left: 0; width: 40px; height: 40px; background: #0000FF; z-index: 11; transform: rotate(90deg);"></div>

            <div id="pdf-footer-bottom-box" style="position: absolute; bottom: 0; right: 20px; width: 40px; height: 40px; background: #FF0000; z-index: 10;"></div>
            <div id="pdf-footer-bottom-box-2" style="position: absolute; bottom: 20px; right: 0; width: 40px; height: 40px; background: #FF0000; z-index: 11;"></div>

            <div style="text-align: center; border-bottom: 2px solid #FF0000; padding-bottom: 8px;">
                <h1 id="pdf-comp-name" style="margin: 0; font-size: 36px; text-transform: uppercase; color: #FF0000;">ARVIN CONTROLS</h1>
                <p id="pdf-comp-addr-line" style="margin: 3px 0 2px 0; font-size: 14px; color: #0000FF; font-weight: 500;"></p>
                <p id="pdf-comp-contact-line" style="margin: 0; font-size: 14px; color: #0000FF; font-style: normal;"></p>
                <div style="margin-top: 8px; display: flex; justify-content: center;">
                    <img id="pdf-comp-logo" style="max-height: 60px; max-width: 150px; display: none;">
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <h2 id="pdf-type-label" style="margin: 0; color: #0000FF; text-transform: uppercase; font-weight: 900; letter-spacing: 2px; border-bottom: 1px solid #0000FF; display: inline-block; padding-bottom: 2px; font-size: 14px;">QUOTATION</h2>
            </div>

            <div style="display: flex; justify-content: space-between; margin-top: 20px; align-items: flex-start; width: 98%;">
                <div style="width: 55%;">
                    <p style="margin: 0; font-size: 12px; font-weight: bold; color: #555;">To,</p>
                    <p id="pdf-client-name" style="margin: 5px 0 2px 0; font-weight: bold; font-size: 12px; color: #000;"></p>
                    <p id="pdf-client-addr" style="margin: 0; font-size: 12px; line-height: 1.3; color: #444;"></p>
                </div>
                <div style="width: 43%; display: flex; flex-direction: column; align-items: flex-end;">
                    <table style="font-size: 12px; border-collapse: collapse; min-width: 180px;">
                        <tr>
                            <td style="font-weight: bold; padding: 2px 10px 2px 0; text-align: left; width: 40%;">No.</td>
                            <td id="pdf-id" style="padding: 2px 0; text-align: left;"></td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; padding: 2px 10px 2px 0; text-align: left;">Date:</td>
                            <td id="pdf-date" style="padding: 2px 0; text-align: left;"></td>
                        </tr>
                        <tr id="pdf-order-row" style="display:none;">
                            <td id="pdf-ref-label" style="font-weight: bold; padding: 2px 10px 2px 0; text-align: left;">Order No:</td>
                            <td id="pdf-order-id" style="padding: 2px 0; text-align: left;"></td>
                        </tr>
                        <tr id="pdf-gate-row" style="display:none;">
                            <td style="font-weight: bold; padding: 2px 10px 2px 0; text-align: left;">Gate Pass:</td>
                            <td id="pdf-gate-id" style="padding: 2px 0; text-align: left;"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div id="pdf-subject-container" style="margin-top: 15px; font-size: 12px; display: none; border-top: 1px dashed #eee; padding-top: 10px; width: 98%;">
                <strong>Subject:</strong> <span id="pdf-subject-text" style="font-weight: bold; font-size: 12px;"></span>
            </div>

            <div id="pdf-mr-container" style="display:none; margin-top: 25px; border: 1px solid #ddd; padding: 20px; border-radius: 8px; width: 98%;">
                <p style="font-size: 12px; margin: 10px 0;">Received a sum of <strong><span id="pdf-mr-curr"></span> <span id="pdf-mr-amount"></span></strong> only.</p>
                <p style="font-size: 11px; margin: 10px 0; font-style: normal;">In Words: <span id="pdf-mr-words-text"></span></p>
                <p style="font-size: 12px; margin: 10px 0;">Payment Mode: <span id="pdf-mr-mode"></span> <span id="pdf-mr-extra"></span></p>
            </div>

            <div id="pdf-standard-table">
                <table style="width: 98%; border-collapse: collapse; margin-top: 20px; border: 1px solid #ddd; box-sizing: border-box;">
                    <thead id="pdf-table-head-container" style="font-size: 11px;"></thead>
                    <tbody id="pdf-table-body" style="font-size: 10px;"></tbody>
                    <tfoot id="pdf-table-foot-container" style="font-size: 11px;"></tfoot>
                </table>
            </div>

            <div id="pdf-words-container" style="margin-top: 20px; font-size: 11px; width: 98%;">
                <strong>Amount in words:</strong> <span id="pdf-grand-words" style="font-style: normal;"></span>
            </div>

            <div id="pdf-terms-section" style="margin-top: 15px; font-size: 11px; width: 98%;">
                <strong>Terms & Conditions:</strong>
                <div id="pdf-terms" style="white-space: pre-wrap; margin-top: 5px; line-height: 1.4; color: #555; font-size: 11px;"></div>
            </div>
            
            <div style="margin-top: 60px; display: flex; justify-content: space-between; align-items: flex-end; font-size: 11px; width: 98%;">
                <div id="pdf-receiver-section" style="text-align: center; visibility: hidden;">
                    <div style="height: 50px; display: flex; align-items: center; justify-content: center;">
                        <img id="pdf-seal" style="max-height: 50px; display:none;">
                    </div>
                    <div style="border-top: 1px solid #999; width: 140px; padding-top: 5px; font-size: 11px;">Receiver Signature</div>
                </div>
                <div style="text-align: center;">
                    <div style="min-height: 45px; display: flex; align-items: flex-end; justify-content: center; margin-bottom: 5px;">
                        <img id="pdf-auth-sig" style="max-height: 45px; display:none;">
                    </div>
                    <div style="border-top: 1px solid #999; width: 160px; margin: 0 auto; padding-top: 5px;">
                        <div style="text-align: center;">
                            <p style="margin:0; font-weight:bold; font-size:11px; line-height: 1.3;">For <span id="pdf-for-comp">ARVIN CONTROLS</span></p>
                            <p id="pdf-sig-name" style="margin:0; font-size:11px; line-height: 1.3;"></p>
                            <p id="pdf-sig-desig" style="margin:0; font-size:11px; line-height: 1.3; color: #555;"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="pdf-footer-wrapper" style="position: absolute; bottom: 0; left: 0; right: 0; text-align: center; padding-right: 15px;">
                <div style="font-size: 12px; color: #0000FF; font-weight: bold; text-transform: uppercase; border-top: 2px solid #00FF00; padding-top: 10px; width: 70%; margin: 0 auto;" id="pdf-footer-slogan"></div>
            </div>
        </div>
    </div>
    <script>
        let currentDocType = '';
        let docItems = [];
        let selectedDocId = null;
        let selectedFolderColor = '#38bdf8';
        let selectedCategoryColor = '#38bdf8';
        let selectedTabCategoryColor = '#38bdf8';
        let currentActiveFolderId = null;
        let currentTabCategoryParent = '';
        let currentFileFolderContext = null;
        let currentPreviewFile = null;
        let selectedFiles = [];

        const MASTER_LIST_FOLDER_ID = 'master-list-products';

        const viewNameMap = {
            'main-menu': 'Home',
            'inventory-view': 'Stock Inventory',
            'products-menu': 'Products Catalog',
            'category-management-view': 'Category Management',
            'folder-content-view': 'Browse Folder',
            'documents-menu': 'Documents Storage',
            'documents-category-management': 'Documents Folder Management',
            'documents-folder-files-view': 'Documents Folder',
            'projects-menu': 'Projects Management',
            'projects-category-management': 'Projects Folder Management',
            'projects-folder-files-view': 'Projects Folder',
            'clients-view': 'Client Database',
            'supplier-view': 'Supplier Records',
            'settings-view': 'System Settings',
            'commercial-menu': 'Commercial Hub',
            'folder-quotation': 'Quotation Records',
            'folder-invoice': 'Invoice Records',
            'folder-challan': 'Delivery Challans',
            'folder-po': 'Purchase Orders',
            'folder-receipt': 'Money Receipts',
            'accounts-menu': 'Accounts & Ledgers',
            'folder-income': 'Income Management',
            'folder-expense': 'Expense Tracking',
            'folder-transactions': 'Transaction History',
            'workorder-menu': 'Work Orders',
            'workorder-category-management': 'Work Order Folder Management',
            'workorder-folder-files-view': 'Work Order Folder',
            'folder-workorder-summary': 'Work Order Summary'
        };

        function quickFilterTable(tableId, query) {
            const tbody = document.getElementById(tableId);
            const rows = tbody.getElementsByTagName('tr');
            const term = query.toLowerCase();
            for (let i = 0; i < rows.length; i++) {
                const text = rows[i].innerText.toLowerCase();
                rows[i].style.display = text.includes(term) ? '' : 'none';
            }
        }

        function toggleSection(header) {
            const section = header.parentElement;
            const isOpen = section.classList.contains('open');
            document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('open'));
            if (!isOpen) section.classList.add('open');
        }

        function openView(id) {
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            const target = document.getElementById(id);
            if(target) target.classList.add('active');
            const indicator = document.getElementById('active-view-indicator');
            const viewName = viewNameMap[id] || 'Viewing';
            indicator.innerText = viewName;
            indicator.style.display = (id === 'main-menu') ? 'none' : 'inline-block';
            document.querySelectorAll('.quick-search').forEach(input => input.value = '');
            
            if(id === 'settings-view') loadSettings();
            if(id === 'clients-view') renderClients();
            if(id === 'supplier-view') renderSuppliers();
            if(id === 'inventory-view') renderInventory();
            if(id === 'products-menu') renderFolders('products-menu');
            if(id === 'documents-menu') renderTabFolders('documents-menu');
            if(id === 'projects-menu') renderTabFolders('projects-menu');
            if(id === 'workorder-menu') renderTabFolders('workorder-menu');
            if(id === 'category-management-view') renderCategories();
            if(id === 'documents-category-management') renderTabCategories('documents');
            if(id === 'projects-category-management') renderTabCategories('projects');
            if(id === 'workorder-category-management') renderTabCategories('workorder');
            if(id === 'folder-content-view') {
                if(currentActiveFolderId === MASTER_LIST_FOLDER_ID) renderMasterProducts();
                else renderFolderProducts();
            }
            if(id === 'folder-income') renderIncome();
            if(id === 'folder-expense') renderExpense();
            if(id === 'folder-transactions') renderTransactions();
            if(id === 'folder-workorder-summary') renderWorkOrders();
            if(id === 'documents-folder-files-view') renderFolderFiles('documents');
            if(id === 'projects-folder-files-view') renderFolderFiles('projects');
            if(id === 'workorder-folder-files-view') renderFolderFiles('workorder');
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function getDocs() { return JSON.parse(localStorage.getItem('arvin_commercial_docs') || '[]'); }
        function saveDocs(docs) { localStorage.setItem('arvin_commercial_docs', JSON.stringify(docs)); }
        function getInventoryStock() { return JSON.parse(localStorage.getItem('arvin_inventory_stock') || '{}'); }
        function saveInventoryStock(stock) { localStorage.setItem('arvin_inventory_stock', JSON.stringify(stock)); }

        // ==================== FILE MANAGEMENT FUNCTIONS ====================
        function triggerFileUpload(context = 'documents') {
            const fileInput = document.getElementById(`${context}-file-input`);
            if (fileInput) {
                fileInput.click();
            }
        }

        function handleFileSelection(files, context = 'documents') {
            if (files.length > 0) {
                selectedFiles = Array.from(files);
                showFileUploadForm(context);
            }
        }

        function showFileUploadForm(context = 'documents') {
            const form = document.getElementById(`${context}-file-upload-form`);
            if (form) {
                form.classList.add('active');
                // Auto-fill file name if only one file selected
                if (selectedFiles.length === 1) {
                    document.getElementById(`${context}-file-name`).value = selectedFiles[0].name.split('.')[0];
                }
            }
        }

        function cancelFileUpload(context = 'documents') {
            const form = document.getElementById(`${context}-file-upload-form`);
            if (form) {
                form.classList.remove('active');
            }
            selectedFiles = [];
        }

        function uploadFile(context = 'documents') {
            if (selectedFiles.length === 0) {
                alert('Please select files to upload');
                return;
            }

            const fileName = document.getElementById(`${context}-file-name`).value;
            const fileDescription = document.getElementById(`${context}-file-description`).value;
            const folderId = currentFileFolderContext?.folderId;
            
            if (!folderId) {
                alert('Error: No folder selected');
                return;
            }

            const filesData = getFolderFiles(folderId, context);
            
            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onloadend = function() {
                    const fileData = {
                        id: Date.now() + index,
                        name: fileName || file.name.split('.')[0],
                        originalName: file.name,
                        type: file.type,
                        size: file.size,
                        sizeFormatted: formatFileSize(file.size),
                        description: fileDescription,
                        data: reader.result,
                        uploaded: new Date().toISOString(),
                        extension: file.name.split('.').pop().toLowerCase()
                    };
                    
                    filesData.push(fileData);
                    saveFolderFiles(folderId, filesData, context);
                    
                    if (index === selectedFiles.length - 1) {
                        cancelFileUpload(context);
                        selectedFiles = [];
                        renderFolderFiles(context);
                        alert(`Successfully uploaded ${selectedFiles.length} file(s)`);
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getFolderFiles(folderId, context = 'documents') {
            return JSON.parse(localStorage.getItem(`arvin_${context}_files_${folderId}`) || '[]');
        }

        function saveFolderFiles(folderId, files, context = 'documents') {
            localStorage.setItem(`arvin_${context}_files_${folderId}`, JSON.stringify(files));
        }

        function renderFolderFiles(context = 'documents') {
            const grid = document.getElementById(`${context}-files-grid`);
            const folderId = currentFileFolderContext?.folderId;
            
            if (!grid || !folderId) return;
            
            const files = getFolderFiles(folderId, context);
            grid.innerHTML = '';
            
            if (files.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: span 2;">
                        <i class="fas fa-file-upload"></i>
                        <p>No files uploaded yet</p>
                        <p style="font-size: 0.7rem; margin-top: 10px;">Upload your first file to get started</p>
                    </div>
                `;
                return;
            }
            
            // Sort files by upload date (newest first)
            files.sort((a, b) => new Date(b.uploaded) - new Date(a.uploaded));
            
            files.forEach(file => {
                const fileType = getFileType(file.extension, file.type);
                const fileIcon = getFileIcon(fileType);
                const fileCard = document.createElement('div');
                fileCard.className = 'file-card';
                
                fileCard.innerHTML = `
                    <div class="file-icon" style="color: ${getFileTypeColor(fileType)}">
                        <i class="${fileIcon}"></i>
                    </div>
                    <div class="file-name" title="${file.name}">${file.name}</div>
                    <div class="file-size">${file.sizeFormatted}</div>
                    <span class="file-type-badge file-type-${fileType}">${file.extension.toUpperCase()}</span>
                    <div class="file-actions">
                        <button class="file-btn preview-btn" onclick="previewFile('${context}', ${file.id})">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button class="file-btn download-btn" onclick="downloadFile('${context}', ${file.id})">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                `;
                
                grid.appendChild(fileCard);
            });
        }

        function getFileType(extension, mimeType) {
            const imageTypes = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'];
            const pdfTypes = ['pdf'];
            const docTypes = ['doc', 'docx', 'rtf'];
            const excelTypes = ['xls', 'xlsx', 'csv'];
            const textTypes = ['txt', 'xml', 'json', 'hse'];
            
            if (imageTypes.includes(extension)) return 'image';
            if (pdfTypes.includes(extension)) return 'pdf';
            if (docTypes.includes(extension)) return 'doc';
            if (excelTypes.includes(extension)) return 'excel';
            if (textTypes.includes(extension)) return 'text';
            return 'other';
        }

        function getFileIcon(fileType) {
            switch(fileType) {
                case 'image': return 'fas fa-file-image';
                case 'pdf': return 'fas fa-file-pdf';
                case 'doc': return 'fas fa-file-word';
                case 'excel': return 'fas fa-file-excel';
                case 'text': return 'fas fa-file-alt';
                default: return 'fas fa-file';
            }
        }

        function getFileTypeColor(fileType) {
            switch(fileType) {
                case 'image': return '#38bdf8';
                case 'pdf': return '#ef4444';
                case 'doc': return '#2563eb';
                case 'excel': return '#22c55e';
                case 'text': return '#a855f7';
                default: return '#fbbf24';
            }
        }

        function filterFiles(query, context = 'documents') {
            const files = document.querySelectorAll(`#${context}-files-grid .file-card`);
            const term = query.toLowerCase();
            
            files.forEach(file => {
                const fileName = file.querySelector('.file-name').textContent.toLowerCase();
                file.style.display = fileName.includes(term) ? 'block' : 'none';
            });
        }

        function previewFile(context, fileId) {
            const folderId = currentFileFolderContext?.folderId;
            const files = getFolderFiles(folderId, context);
            const file = files.find(f => f.id == fileId);
            
            if (!file) {
                alert('File not found');
                return;
            }
            
            currentPreviewFile = file;
            document.getElementById('file-preview-title').innerText = file.name;
            const previewContainer = document.getElementById('file-preview-container');
            previewContainer.innerHTML = '';
            
            const fileType = getFileType(file.extension, file.type);
            
            switch(fileType) {
                case 'image':
                    previewContainer.innerHTML = `
                        <img src="${file.data}" class="file-preview-img" alt="${file.name}">
                        <div style="margin-top: 10px;">
                            <p><strong>Size:</strong> ${file.sizeFormatted}</p>
                            <p><strong>Uploaded:</strong> ${new Date(file.uploaded).toLocaleDateString()}</p>
                            ${file.description ? `<p><strong>Description:</strong> ${file.description}</p>` : ''}
                        </div>
                    `;
                    break;
                    
                case 'pdf':
                    previewContainer.innerHTML = `
                        <iframe src="${file.data}" class="file-preview-pdf"></iframe>
                        <div style="margin-top: 10px;">
                            <p><strong>Size:</strong> ${file.sizeFormatted}</p>
                            <p><strong>Uploaded:</strong> ${new Date(file.uploaded).toLocaleDateString()}</p>
                            ${file.description ? `<p><strong>Description:</strong> ${file.description}</p>` : ''}
                        </div>
                    `;
                    break;
                    
                case 'text':
                    // For text files, we need to decode the base64 data
                    const textContent = atob(file.data.split(',')[1]);
                    previewContainer.innerHTML = `
                        <div class="file-preview-text">${textContent}</div>
                        <div style="margin-top: 10px;">
                            <p><strong>Size:</strong> ${file.sizeFormatted}</p>
                            <p><strong>Uploaded:</strong> ${new Date(file.uploaded).toLocaleDateString()}</p>
                            ${file.description ? `<p><strong>Description:</strong> ${file.description}</p>` : ''}
                        </div>
                    `;
                    break;
                    
                default:
                    previewContainer.innerHTML = `
                        <div class="file-preview-placeholder">
                            <i class="${getFileIcon(fileType)}"></i>
                            <p>Preview not available for this file type</p>
                            <p>Please download the file to view its contents</p>
                            <div style="margin-top: 10px;">
                                <p><strong>File Type:</strong> ${file.extension.toUpperCase()}</p>
                                <p><strong>Size:</strong> ${file.sizeFormatted}</p>
                                <p><strong>Uploaded:</strong> ${new Date(file.uploaded).toLocaleDateString()}</p>
                                ${file.description ? `<p><strong>Description:</strong> ${file.description}</p>` : ''}
                            </div>
                        </div>
                    `;
            }
            
            document.getElementById('file-preview-modal').style.display = 'flex';
        }

        function downloadPreviewedFile() {
            if (currentPreviewFile) {
                downloadFile(currentFileFolderContext?.context || 'documents', currentPreviewFile.id);
            }
        }

        function downloadFile(context, fileId) {
            const folderId = currentFileFolderContext?.folderId;
            const files = getFolderFiles(folderId, context);
            const file = files.find(f => f.id == fileId);
            
            if (!file) {
                alert('File not found');
                return;
            }
            
            // Create a temporary link element
            const link = document.createElement('a');
            link.href = file.data;
            link.download = file.originalName || file.name + '.' + file.extension;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Close preview modal if open
            closeModal('file-preview-modal');
        }

        function openFolderFilesView(folder, context = 'documents') {
            currentFileFolderContext = {
                folderId: folder.id,
                folderName: folder.name,
                context: context
            };
            
            let viewId = '';
            let backBtnId = '';
            let titleId = '';
            
            switch(context) {
                case 'documents':
                    viewId = 'documents-folder-files-view';
                    backBtnId = 'documents-folder-back-btn';
                    titleId = 'documents-folder-title';
                    break;
                case 'projects':
                    viewId = 'projects-folder-files-view';
                    backBtnId = 'projects-folder-back-btn';
                    titleId = 'projects-folder-title';
                    break;
                case 'workorder':
                    viewId = 'workorder-folder-files-view';
                    backBtnId = 'workorder-folder-back-btn';
                    titleId = 'workorder-folder-title';
                    break;
            }
            
            document.getElementById(backBtnId).onclick = () => {
                if (context === 'documents') openView('documents-menu');
                else if (context === 'projects') openView('projects-menu');
                else if (context === 'workorder') openView('workorder-menu');
            };
            
            document.getElementById(titleId).innerHTML = `<i class="fas fa-folder" style="color:${folder.color}"></i> ${folder.name}`;
            
            openView(viewId);
        }

        // ==================== ACCOUNTS FUNCTIONS ====================
        function getIncomeRecords() { return JSON.parse(localStorage.getItem('arvin_income_records') || '[]'); }
        function saveIncomeRecords(records) { localStorage.setItem('arvin_income_records', JSON.stringify(records)); }
        
        function getExpenseRecords() { return JSON.parse(localStorage.getItem('arvin_expense_records') || '[]'); }
        function saveExpenseRecords(records) { localStorage.setItem('arvin_expense_records', JSON.stringify(records)); }
        
        function getWorkOrders() { return JSON.parse(localStorage.getItem('arvin_work_orders') || '[]'); }
        function saveWorkOrders(orders) { localStorage.setItem('arvin_work_orders', JSON.stringify(orders)); }

        function openIncomeModal(record = null, idx = -1) {
            document.getElementById('income-modal-title').innerText = record ? 'Edit Income Record' : 'Add Income Record';
            document.getElementById('income-date').value = record ? record.date : new Date().toISOString().split('T')[0];
            document.getElementById('income-purpose').value = record ? record.purpose : '';
            document.getElementById('income-amount').value = record ? record.amount : '';
            document.getElementById('income-description').value = record ? record.description : '';
            document.getElementById('income-edit-id').value = idx;
            document.getElementById('income-modal').style.display = 'flex';
        }

        function openExpenseModal(record = null, idx = -1) {
            document.getElementById('expense-modal-title').innerText = record ? 'Edit Expense Record' : 'Add Expense Record';
            document.getElementById('expense-date').value = record ? record.date : new Date().toISOString().split('T')[0];
            document.getElementById('expense-purpose').value = record ? record.purpose : '';
            document.getElementById('expense-amount').value = record ? record.amount : '';
            document.getElementById('expense-description').value = record ? record.description : '';
            document.getElementById('expense-edit-id').value = idx;
            document.getElementById('expense-modal').style.display = 'flex';
        }

        function saveIncome() {
            const records = getIncomeRecords();
            const editId = parseInt(document.getElementById('income-edit-id').value);
            const incomeData = {
                date: document.getElementById('income-date').value,
                purpose: document.getElementById('income-purpose').value,
                amount: parseFloat(document.getElementById('income-amount').value) || 0,
                description: document.getElementById('income-description').value
            };
            
            if(editId > -1) {
                records[editId] = incomeData;
            } else {
                records.push(incomeData);
            }
            
            saveIncomeRecords(records);
            renderIncome();
            closeModal('income-modal');
        }

        function saveExpense() {
            const records = getExpenseRecords();
            const editId = parseInt(document.getElementById('expense-edit-id').value);
            const expenseData = {
                date: document.getElementById('expense-date').value,
                purpose: document.getElementById('expense-purpose').value,
                amount: parseFloat(document.getElementById('expense-amount').value) || 0,
                description: document.getElementById('expense-description').value
            };
            
            if(editId > -1) {
                records[editId] = expenseData;
            } else {
                records.push(expenseData);
            }
            
            saveExpenseRecords(records);
            renderExpense();
            closeModal('expense-modal');
        }

        function formatDateDisplay(dateStr) {
            if (!dateStr) return "";
            const [year, month, day] = dateStr.split('-');
            return `${day.padStart(2, '0')}.${month.padStart(2, '0')}.${year}`;
        }

        function renderIncome() {
            const records = getIncomeRecords();
            const tbody = document.getElementById('income-table-body');
            const grandTotalEl = document.getElementById('income-grand-total');
            const totalIncomeEl = document.getElementById('total-income');
            const monthIncomeEl = document.getElementById('month-income');
            const yearIncomeEl = document.getElementById('year-income');
            
            tbody.innerHTML = '';
            let grandTotal = 0;
            let monthTotal = 0;
            let yearTotal = 0;
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            
            records.forEach((record, idx) => {
                const amount = parseFloat(record.amount) || 0;
                grandTotal += amount;
                
                // Calculate month total
                const recordDate = new Date(record.date);
                if (recordDate.getMonth() + 1 === currentMonth && recordDate.getFullYear() === currentYear) {
                    monthTotal += amount;
                }
                
                // Calculate year total
                if (recordDate.getFullYear() === currentYear) {
                    yearTotal += amount;
                }
                
                tbody.innerHTML += `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${formatDateDisplay(record.date)}</td>
                        <td>${record.purpose}</td>
                        <td class="income-amount"> ${amount.toLocaleString()}</td>
                        <td class="table-actions">
                            <button onclick="editIncome(${idx})" title="Edit"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteIncome(${idx})" title="Delete"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
            
            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 20px; color: var(--text-muted);">No income records found.</td></tr>';
            }
            
            grandTotalEl.innerText = ` ${grandTotal.toLocaleString()}`;
            totalIncomeEl.innerText = ` ${grandTotal.toLocaleString()}`;
            monthIncomeEl.innerText = ` ${monthTotal.toLocaleString()}`;
            yearIncomeEl.innerText = ` ${yearTotal.toLocaleString()}`;
        }

        function renderExpense() {
            const records = getExpenseRecords();
            const tbody = document.getElementById('expense-table-body');
            const grandTotalEl = document.getElementById('expense-grand-total');
            const totalExpenseEl = document.getElementById('total-expense');
            const monthExpenseEl = document.getElementById('month-expense');
            const yearExpenseEl = document.getElementById('year-expense');
            
            tbody.innerHTML = '';
            let grandTotal = 0;
            let monthTotal = 0;
            let yearTotal = 0;
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            
            records.forEach((record, idx) => {
                const amount = parseFloat(record.amount) || 0;
                grandTotal += amount;
                
                // Calculate month total
                const recordDate = new Date(record.date);
                if (recordDate.getMonth() + 1 === currentMonth && recordDate.getFullYear() === currentYear) {
                    monthTotal += amount;
                }
                
                // Calculate year total
                if (recordDate.getFullYear() === currentYear) {
                    yearTotal += amount;
                }
                
                tbody.innerHTML += `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${formatDateDisplay(record.date)}</td>
                        <td>${record.purpose}</td>
                        <td class="expense-amount"> ${amount.toLocaleString()}</td>
                        <td class="table-actions">
                            <button onclick="editExpense(${idx})" title="Edit"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteExpense(${idx})" title="Delete"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
            
            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 20px; color: var(--text-muted);">No expense records found.</td></tr>';
            }
            
            grandTotalEl.innerText = ` ${grandTotal.toLocaleString()}`;
            totalExpenseEl.innerText = ` ${grandTotal.toLocaleString()}`;
            monthExpenseEl.innerText = ` ${monthTotal.toLocaleString()}`;
            yearExpenseEl.innerText = ` ${yearTotal.toLocaleString()}`;
        }

        function renderTransactions() {
            const incomeRecords = getIncomeRecords();
            const expenseRecords = getExpenseRecords();
            const tbody = document.getElementById('transactions-table-body');
            const totalIncomeEl = document.getElementById('summary-total-income');
            const totalExpenseEl = document.getElementById('summary-total-expense');
            const currentBalanceEl = document.getElementById('current-balance');
            
            tbody.innerHTML = '';
            
            // Combine and sort all transactions by date (newest first)
            const allTransactions = [];
            
            incomeRecords.forEach(record => {
                allTransactions.push({
                    ...record,
                    type: 'INCOME',
                    typeDisplay: 'Income',
                    amount: parseFloat(record.amount) || 0
                });
            });
            
            expenseRecords.forEach(record => {
                allTransactions.push({
                    ...record,
                    type: 'EXPENSE',
                    typeDisplay: 'Expense',
                    amount: parseFloat(record.amount) || 0
                });
            });
            
            // Sort by date (newest first)
            allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Calculate totals
            let totalIncome = 0;
            let totalExpense = 0;
            
            allTransactions.forEach(transaction => {
                if (transaction.type === 'INCOME') {
                    totalIncome += transaction.amount;
                } else {
                    totalExpense += transaction.amount;
                }
                
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDateDisplay(transaction.date)}</td>
                        <td><span class="${transaction.type === 'INCOME' ? 'income-amount' : 'expense-amount'}">${transaction.typeDisplay}</span></td>
                        <td>${transaction.purpose}</td>
                        <td class="${transaction.type === 'INCOME' ? 'income-amount' : 'expense-amount'}">${transaction.type === 'INCOME' ? '+' : '-'} ${transaction.amount.toLocaleString()}</td>
                    </tr>
                `;
            });
            
            if (allTransactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 20px; color: var(--text-muted);">No transactions found.</td></tr>';
            }
            
            const balance = totalIncome - totalExpense;
            totalIncomeEl.innerText = ` ${totalIncome.toLocaleString()}`;
            totalExpenseEl.innerText = ` ${totalExpense.toLocaleString()}`;
            currentBalanceEl.innerText = ` ${balance.toLocaleString()}`;
            currentBalanceEl.style.color = balance >= 0 ? 'var(--income-green)' : 'var(--expense-red)';
        }

        function editIncome(idx) {
            const records = getIncomeRecords();
            openIncomeModal(records[idx], idx);
        }

        function editExpense(idx) {
            const records = getExpenseRecords();
            openExpenseModal(records[idx], idx);
        }

        function deleteIncome(idx) {
            if (!confirm('Delete this income record?')) return;
            const records = getIncomeRecords();
            records.splice(idx, 1);
            saveIncomeRecords(records);
            renderIncome();
            renderTransactions();
        }

        function deleteExpense(idx) {
            if (!confirm('Delete this expense record?')) return;
            const records = getExpenseRecords();
            records.splice(idx, 1);
            saveExpenseRecords(records);
            renderExpense();
            renderTransactions();
        }

        // ==================== WORK ORDER FUNCTIONS ====================
        function filterClients(input) {
            const filter = input.value.toUpperCase();
            const clientList = document.getElementById("client-autocomplete");
            clientList.innerHTML = "";
            
            if (filter.length === 0) {
                clientList.style.display = "none";
                return;
            }
            
            const clients = getClients();
            let hasMatches = false;
            
            clients.forEach(client => {
                if (client.name.toUpperCase().includes(filter)) {
                    const item = document.createElement("div");
                    item.className = "autocomplete-suggestion";
                    item.innerHTML = `<strong>${client.name}</strong><br><small>${client.person || ''} - ${client.phone || ''}</small>`;
                    item.onclick = function() {
                        input.value = client.name;
                        clientList.style.display = "none";
                    };
                    clientList.appendChild(item);
                    hasMatches = true;
                }
            });
            
            clientList.style.display = hasMatches ? "block" : "none";
        }

        function openWorkOrderModal(order = null, idx = -1) {
            document.getElementById('workorder-modal-title').innerText = order ? 'Edit Work Order' : 'Add Work Order';
            document.getElementById('workorder-date').value = order ? order.date : new Date().toISOString().split('T')[0];
            
            // Clear autocomplete
            document.getElementById('workorder-client').value = order ? order.client : '';
            document.getElementById('client-autocomplete').innerHTML = '';
            document.getElementById('client-autocomplete').style.display = 'none';
            
            document.getElementById('workorder-id').value = order ? order.id : '';
            document.getElementById('workorder-type').value = order ? order.type : '';
            document.getElementById('workorder-value').value = order ? order.value : '';
            document.getElementById('workorder-cost').value = order ? order.cost : '';
            document.getElementById('workorder-description').value = order ? order.description : '';
            document.getElementById('workorder-edit-id').value = idx;
            document.getElementById('workorder-modal').style.display = 'flex';
        }

        function saveWorkOrder() {
            const orders = getWorkOrders();
            const editId = parseInt(document.getElementById('workorder-edit-id').value);
            const workOrderData = {
                date: document.getElementById('workorder-date').value,
                client: document.getElementById('workorder-client').value,
                id: document.getElementById('workorder-id').value,
                type: document.getElementById('workorder-type').value,
                value: parseFloat(document.getElementById('workorder-value').value) || 0,
                cost: parseFloat(document.getElementById('workorder-cost').value) || 0,
                description: document.getElementById('workorder-description').value
            };
            
            // Calculate profit
            workOrderData.profit = workOrderData.value - workOrderData.cost;
            
            if(editId > -1) {
                orders[editId] = workOrderData;
            } else {
                orders.push(workOrderData);
            }
            
            saveWorkOrders(orders);
            renderWorkOrders();
            closeModal('workorder-modal');
        }

        function renderWorkOrders() {
            const orders = getWorkOrders();
            const tbody = document.getElementById('workorder-table-body');
            const totalOrdersEl = document.getElementById('total-orders');
            const totalValueEl = document.getElementById('total-order-value');
            const totalCostEl = document.getElementById('total-order-cost');
            const totalProfitEl = document.getElementById('total-order-profit');
            const grandValueEl = document.getElementById('workorder-total-value');
            const grandCostEl = document.getElementById('workorder-total-cost');
            const grandProfitEl = document.getElementById('workorder-grand-profit');
            
            tbody.innerHTML = '';
            let totalOrders = 0;
            let totalValue = 0;
            let totalCost = 0;
            let totalProfit = 0;
            
            // Sort by date (newest first)
            orders.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            orders.forEach((order, idx) => {
                const value = parseFloat(order.value) || 0;
                const cost = parseFloat(order.cost) || 0;
                const profit = value - cost;
                
                totalOrders++;
                totalValue += value;
                totalCost += cost;
                totalProfit += profit;
                
                tbody.innerHTML += `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${formatDateDisplay(order.date)}</td>
                        <td>${order.client}</td>
                        <td>${order.id}</td>
                        <td>${order.type}</td>
                        <td class="income-amount"> ${value.toLocaleString()}</td>
                        <td class="expense-amount"> ${cost.toLocaleString()}</td>
                        <td class="${profit >= 0 ? 'profit-amount' : 'loss-amount'}"> ${profit.toLocaleString()}</td>
                        <td class="table-actions">
                            <button onclick="editWorkOrder(${idx})" title="Edit"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteWorkOrder(${idx})" title="Delete"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align:center; padding: 20px; color: var(--text-muted);">No work orders found.</td></tr>';
            }
            
            totalOrdersEl.innerText = totalOrders;
            totalValueEl.innerText = ` ${totalValue.toLocaleString()}`;
            totalCostEl.innerText = ` ${totalCost.toLocaleString()}`;
            totalProfitEl.innerText = ` ${totalProfit.toLocaleString()}`;
            grandValueEl.innerText = ` ${totalValue.toLocaleString()}`;
            grandCostEl.innerText = ` ${totalCost.toLocaleString()}`;
            grandProfitEl.innerText = ` ${totalProfit.toLocaleString()}`;
            
            // Update profit color
            totalProfitEl.style.color = totalProfit >= 0 ? 'var(--income-green)' : 'var(--expense-red)';
            grandProfitEl.style.color = totalProfit >= 0 ? 'var(--income-green)' : 'var(--expense-red)';
        }

        function editWorkOrder(idx) {
            const orders = getWorkOrders();
            openWorkOrderModal(orders[idx], idx);
        }

        function deleteWorkOrder(idx) {
            if (!confirm('Delete this work order?')) return;
            const orders = getWorkOrders();
            orders.splice(idx, 1);
            saveWorkOrders(orders);
            renderWorkOrders();
        }

        // ==================== TAB CATEGORY MANAGEMENT FUNCTIONS ====================
        function openTabCategoryModal(tabName, category = null) {
            currentTabCategoryParent = tabName;
            document.getElementById('tab-category-modal-title').innerText = category ? 'Edit Folder' : 'Create New Folder';
            document.getElementById('tab-category-name').value = category ? category.name : '';
            document.getElementById('tab-category-edit-id').value = category ? category.id : '';
            document.getElementById('tab-category-parent').value = tabName;
            
            // Reset color picker
            document.querySelectorAll('#tab-category-color-picker .color-opt').forEach(opt => opt.classList.remove('selected'));
            
            if (category) {
                // Select the category's color
                const colorOpts = document.querySelectorAll('#tab-category-color-picker .color-opt');
                colorOpts.forEach(opt => {
                    if (opt.style.background === category.color || 
                        opt.style.backgroundColor === category.color) {
                        opt.classList.add('selected');
                        selectedTabCategoryColor = category.color;
                    }
                });
            } else {
                // Default to first color
                const firstColorOpt = document.querySelector('#tab-category-color-picker .color-opt');
                if (firstColorOpt) {
                    firstColorOpt.classList.add('selected');
                    selectedTabCategoryColor = '#38bdf8';
                }
            }
            
            document.getElementById('tab-category-modal').style.display = 'flex';
        }

        function selectTabCategoryColor(color, el) {
            selectedTabCategoryColor = color;
            document.querySelectorAll('#tab-category-color-picker .color-opt').forEach(opt => opt.classList.remove('selected'));
            el.classList.add('selected');
        }

        function saveTabCategory() {
            const name = document.getElementById('tab-category-name').value;
            const editId = document.getElementById('tab-category-edit-id').value;
            const parent = document.getElementById('tab-category-parent').value;
            
            if (!name) {
                alert('Please enter a folder name');
                return;
            }
            
            let categories = getTabCategories(parent);
            
            if (editId) {
                // Edit existing category
                const index = categories.findIndex(c => c.id == editId);
                if (index !== -1) {
                    categories[index].name = name;
                    categories[index].color = selectedTabCategoryColor;
                }
            } else {
                // Add new category
                const newCategory = {
                    id: Date.now(),
                    name: name,
                    color: selectedTabCategoryColor,
                    parent: parent
                };
                categories.push(newCategory);
            }
            
            saveTabCategories(parent, categories);
            closeModal('tab-category-modal');
            renderTabCategories(parent);
            renderTabFolders(parent + '-menu');
        }

        function getTabCategories(tabName) {
            return JSON.parse(localStorage.getItem(`arvin_${tabName}_categories`) || '[]');
        }

        function saveTabCategories(tabName, data) {
            localStorage.setItem(`arvin_${tabName}_categories`, JSON.stringify(data));
        }

        function renderTabCategories(tabName) {
            const categoriesList = document.getElementById(`${tabName}-categories-list`);
            const categories = getTabCategories(tabName);
            
            if (categories.length === 0) {
                categoriesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>No folders found</p>
                        <p style="font-size: 0.7rem; margin-top: 10px;">Create your first folder to organize items</p>
                    </div>
                `;
                return;
            }
            
            categoriesList.innerHTML = '';
            
            // Sort categories alphabetically
            categories.sort((a, b) => a.name.localeCompare(b.name));
            
            categories.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                
                categoryItem.innerHTML = `
                    <div class="category-color" style="background: ${category.color}"></div>
                    <div class="category-name">
                        ${category.name}
                    </div>
                    <div class="category-actions">
                        <button class="category-btn edit-btn" onclick="editTabCategory('${tabName}', ${category.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="category-btn delete-btn" onclick="deleteTabCategory('${tabName}', ${category.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                // Make category clickable to view its contents
                categoryItem.onclick = (e) => {
                    if (!e.target.closest('.category-actions')) {
                        openFolderFilesView(category, tabName);
                    }
                };
                
                categoriesList.appendChild(categoryItem);
            });
        }

        function editTabCategory(tabName, id) {
            const categories = getTabCategories(tabName);
            const category = categories.find(c => c.id == id);
            if (category) {
                openTabCategoryModal(tabName, category);
            }
        }

        function deleteTabCategory(tabName, id) {
            if (!confirm('Are you sure you want to delete this folder? All files in this folder will also be deleted.')) {
                return;
            }
            
            let categories = getTabCategories(tabName);
            categories = categories.filter(f => f.id != id);
            saveTabCategories(tabName, categories);
            
            // Also delete the folder's file data
            localStorage.removeItem(`arvin_${tabName}_files_${id}`);
            
            renderTabCategories(tabName);
            renderTabFolders(tabName + '-menu');
        }

        function filterTabCategories(query, tabName) {
            const categories = document.querySelectorAll(`#${tabName}-categories-list .category-item`);
            const term = query.toLowerCase();
            
            categories.forEach(category => {
                const categoryName = category.querySelector('.category-name').textContent.toLowerCase();
                category.style.display = categoryName.includes(term) ? 'flex' : 'none';
            });
        }

        function renderTabFolders(parentId) {
            const tabName = parentId.replace('-menu', '');
            const grid = document.getElementById(parentId + '-folder-grid');
            if(!grid) return;
            grid.innerHTML = '';
            
            const folders = getTabCategories(tabName);
            folders.forEach(f => {
                const card = document.createElement('div');
                card.className = "nav-card";
                card.onclick = () => {
                    openFolderFilesView(f, tabName);
                };
                card.innerHTML = `<div class="icon-bg" style="background:${f.color}"></div><i class="fas fa-folder" style="color:${f.color}"></i><span>${f.name}</span>`;
                grid.appendChild(card);
            });
            
            // Special handling for workorder menu to keep summary folder
            if (parentId === 'workorder-menu') {
                const grid = document.getElementById('workorder-menu-folder-grid');
                if (grid) {
                    // Add summary card to workorder menu
                    const summaryCard = document.createElement('div');
                    summaryCard.className = "nav-card";
                    summaryCard.onclick = () => openView('folder-workorder-summary');
                    summaryCard.innerHTML = `<div class="icon-bg" style="background:#f59e0b"></div><i class="fas fa-chart-line" style="color:#f59e0b"></i><span>Summary</span>`;
                    grid.prepend(summaryCard);
                }
            }
        }

        // ==================== PRODUCTS CATEGORY MANAGEMENT FUNCTIONS ====================
        function openCategoryModal(category = null) {
            document.getElementById('category-modal-title').innerText = category ? 'Edit Category' : 'Create New Category';
            document.getElementById('category-name').value = category ? category.name : '';
            document.getElementById('category-edit-id').value = category ? category.id : '';
            
            // Reset color picker
            document.querySelectorAll('.color-opt').forEach(opt => opt.classList.remove('selected'));
            
            if (category) {
                // Select the category's color
                const colorOpts = document.querySelectorAll('.color-opt');
                colorOpts.forEach(opt => {
                    if (opt.style.background === category.color || 
                        opt.style.backgroundColor === category.color) {
                        opt.classList.add('selected');
                        selectedCategoryColor = category.color;
                    }
                });
            } else {
                // Default to first color
                const firstColorOpt = document.querySelector('.color-opt');
                if (firstColorOpt) {
                    firstColorOpt.classList.add('selected');
                    selectedCategoryColor = '#38bdf8';
                }
            }
            
            document.getElementById('category-modal').style.display = 'flex';
        }

        function selectCategoryColor(color, el) {
            selectedCategoryColor = color;
            document.querySelectorAll('.color-opt').forEach(opt => opt.classList.remove('selected'));
            el.classList.add('selected');
        }

        function saveCategory() {
            const name = document.getElementById('category-name').value;
            const editId = document.getElementById('category-edit-id').value;
            
            if (!name) {
                alert('Please enter a category name');
                return;
            }
            
            let categories = getFolders();
            
            if (editId) {
                // Edit existing category
                const index = categories.findIndex(c => c.id == editId);
                if (index !== -1) {
                    categories[index].name = name;
                    categories[index].color = selectedCategoryColor;
                }
            } else {
                // Add new category
                const newCategory = {
                    id: Date.now(),
                    name: name,
                    color: selectedCategoryColor,
                    parent: 'products-menu'
                };
                categories.push(newCategory);
            }
            
            saveFolders(categories);
            closeModal('category-modal');
            renderCategories();
            renderFolders('products-menu');
        }

        function renderCategories() {
            const categoriesList = document.getElementById('categories-list');
            const categories = getFolders().filter(f => f.parent === 'products-menu');
            
            if (categories.length === 0) {
                categoriesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>No categories found</p>
                        <p style="font-size: 0.7rem; margin-top: 10px;">Create your first category to organize products</p>
                    </div>
                `;
                return;
            }
            
            categoriesList.innerHTML = '';
            
            // Sort categories alphabetically
            categories.sort((a, b) => a.name.localeCompare(b.name));
            
            categories.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                
                // Count products in this category
                const categoryProducts = JSON.parse(localStorage.getItem(`folder_data_${category.id}`) || '[]');
                const productCount = categoryProducts.length;
                
                categoryItem.innerHTML = `
                    <div class="category-color" style="background: ${category.color}"></div>
                    <div class="category-name">
                        ${category.name}
                        <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 3px;">
                            ${productCount} product${productCount !== 1 ? 's' : ''}
                        </div>
                    </div>
                    <div class="category-actions">
                        <button class="category-btn edit-btn" onclick="editCategory(${category.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="category-btn delete-btn" onclick="deleteCategory(${category.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                // Make category clickable to view its products
                categoryItem.onclick = (e) => {
                    if (!e.target.closest('.category-actions')) {
                        openFolderView(category.id, category.name, 'products-menu');
                    }
                };
                
                categoriesList.appendChild(categoryItem);
            });
        }

        function editCategory(id) {
            const categories = getFolders().filter(f => f.parent === 'products-menu');
            const category = categories.find(c => c.id == id);
            if (category) {
                openCategoryModal(category);
            }
        }

        function deleteCategory(id) {
            if (!confirm('Are you sure you want to delete this category? All products in this category will also be deleted.')) {
                return;
            }
            
            let categories = getFolders();
            categories = categories.filter(f => f.id != id);
            saveFolders(categories);
            
            // Also delete the category's product data
            localStorage.removeItem(`folder_data_${id}`);
            
            renderCategories();
            renderFolders('products-menu');
        }

        function filterCategories(query) {
            const categories = document.querySelectorAll('.category-item');
            const term = query.toLowerCase();
            
            categories.forEach(category => {
                const categoryName = category.querySelector('.category-name').textContent.toLowerCase();
                category.style.display = categoryName.includes(term) ? 'flex' : 'none';
            });
        }

        // ==================== AUTCOMPLETE FUNCTIONS ====================
        function showClientSuggestions(inputElement, type = 'doc') {
            const filter = inputElement.value.toUpperCase();
            const suggestionsId = type === 'mr' ? 'mr-client-suggestions' : 'client-suggestions';
            const suggestionsDiv = document.getElementById(suggestionsId);
            suggestionsDiv.innerHTML = "";
            
            if (filter.length === 0) {
                suggestionsDiv.style.display = "none";
                return;
            }
            
            const clients = getClients();
            let hasMatches = false;
            
            clients.forEach(client => {
                if (client.name.toUpperCase().includes(filter)) {
                    const item = document.createElement("div");
                    item.className = "autocomplete-suggestion";
                    item.innerHTML = `<strong>${client.name}</strong><small>${client.person ? ' - ' + client.person : ''}${client.phone ? ' - ' + client.phone : ''}</small>`;
                    item.onclick = function() {
                        inputElement.value = client.name;
                        suggestionsDiv.style.display = "none";
                        
                        // Auto-fill address based on context
                        if (type === 'mr') {
                            document.getElementById('mr-address').value = client.address || '';
                        } else {
                            document.getElementById('doc-address').value = client.address || '';
                        }
                    };
                    suggestionsDiv.appendChild(item);
                    hasMatches = true;
                }
            });
            
            suggestionsDiv.style.display = hasMatches ? "block" : "none";
        }

        function showProductSuggestions(inputElement) {
            const filter = inputElement.value.toUpperCase();
            const suggestionsDiv = document.getElementById('product-suggestions');
            suggestionsDiv.innerHTML = "";
            
            if (filter.length === 0) {
                suggestionsDiv.style.display = "none";
                return;
            }
            
            // Get all products from all folders
            const allFolders = getFolders().filter(f => f.parent === 'products-menu');
            let allProducts = [];
            allFolders.forEach(folder => {
                const folderProducts = JSON.parse(localStorage.getItem(`folder_data_${folder.id}`) || '[]');
                folderProducts.forEach(p => {
                    allProducts.push({
                        ...p,
                        folderName: folder.name
                    });
                });
            });
            
            let hasMatches = false;
            
            allProducts.forEach(product => {
                if (product.item.toUpperCase().includes(filter) || product.desc.toUpperCase().includes(filter)) {
                    const item = document.createElement("div");
                    item.className = "autocomplete-suggestion";
                    item.innerHTML = `<strong>${product.item}</strong><small>${product.desc ? ' - ' + product.desc : ''}${product.unit ? ' (' + product.unit + ')' : ''}</small>`;
                    item.onclick = function() {
                        inputElement.value = product.item;
                        suggestionsDiv.style.display = "none";
                        
                        // Auto-fill other fields
                        document.getElementById('item-desc').value = product.desc || '';
                        document.getElementById('item-unit').value = product.unit || '';
                        document.getElementById('item-price').value = product.price || '';
                    };
                    suggestionsDiv.appendChild(item);
                    hasMatches = true;
                }
            });
            
            suggestionsDiv.style.display = hasMatches ? "block" : "none";
        }

        // Close suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.autocomplete-container')) {
                document.querySelectorAll('.autocomplete-suggestions').forEach(el => {
                    el.style.display = 'none';
                });
            }
        });

        // ==================== EXISTING FUNCTIONS ====================
        function renderInventory() {
            const body = document.getElementById('inventory-table-body');
            body.innerHTML = '';
            const stock = getInventoryStock();
            const allFolders = getFolders().filter(f => f.parent === 'products-menu');
            let masterData = [];
            allFolders.forEach(folder => {
                const folderProducts = JSON.parse(localStorage.getItem(`folder_data_${folder.id}`) || '[]');
                masterData = masterData.concat(folderProducts);
            });
            masterData.forEach((p, idx) => {
                const stockKey = `${p.item}-${p.desc}`;
                const currentQty = stock[stockKey] || 0;
                body.innerHTML += `<tr><td>${idx + 1}</td><td>${p.item}</td><td>${p.desc}</td><td><input type="number" class="inventory-qty-input" value="${currentQty}" onchange="updateStockQty('${stockKey}', this.value)"></td></tr>`;
            });
            if(masterData.length === 0) body.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 20px; color: var(--text-muted);">No products found.</td></tr>';
        }

        function updateStockQty(key, val) {
            const stock = getInventoryStock();
            stock[key] = parseFloat(val) || 0;
            saveInventoryStock(stock);
        }

        function getFolders() { return JSON.parse(localStorage.getItem('arvin_folders') || '[]'); }
        function saveFolders(data) { localStorage.setItem('arvin_folders', JSON.stringify(data)); }

        function selectFolderColor(color, el) {
            selectedFolderColor = color;
            document.querySelectorAll('.color-opt').forEach(opt => opt.classList.remove('selected'));
            el.classList.add('selected');
        }

        function saveFolder() {
            const name = document.getElementById('f-name').value;
            const parent = document.getElementById('f-parent').value;
            const editId = document.getElementById('f-edit-id').value;
            if(!name) return alert("Enter folder name");
            let folders = getFolders();
            if(editId) {
                const idx = folders.findIndex(f => f.id == editId);
                folders[idx].name = name;
                folders[idx].color = selectedFolderColor;
            } else {
                folders.push({ id: Date.now(), name, color: selectedFolderColor, parent });
            }
            saveFolders(folders);
            closeModal('folder-modal');
            renderFolders(parent);
        }

        function renderFolders(parentId) {
            const grid = document.getElementById(parentId + '-folder-grid');
            if(!grid) return;
            grid.innerHTML = '';
            if(parentId === 'products-menu') {
                const masterCard = document.createElement('div');
                masterCard.className = "nav-card";
                masterCard.onclick = () => openFolderView(MASTER_LIST_FOLDER_ID, 'Master List', parentId);
                masterCard.innerHTML = `<div class="icon-bg" style="background:linear-gradient(45deg, #f06, #4a90e2); opacity: 0.3;"></div><i class="fas fa-layer-group" style="color:#fff;"></i><span style="font-weight: 800; color: #4ade80;">Master List</span>`;
                grid.appendChild(masterCard);
            }
            const folders = getFolders().filter(f => f.parent === parentId);
            folders.forEach(f => {
                const card = document.createElement('div');
                card.className = "nav-card";
                card.onclick = () => openFolderView(f.id, f.name, parentId);
                card.innerHTML = `<div class="icon-bg" style="background:${f.color}"></div><i class="fas fa-folder" style="color:${f.color}"></i><span>${f.name}</span>`;
                grid.appendChild(card);
            });
        }

        function openFolderView(folderId, folderName, parentMenuId) {
            currentActiveFolderId = folderId;
            document.getElementById('folder-view-title').innerText = folderName;
            document.getElementById('folder-view-back-btn').onclick = () => openView(parentMenuId);
            const addBtn = document.getElementById('add-item-btn-container');
            const actionHeader = document.getElementById('folder-action-header');
            if(folderId === MASTER_LIST_FOLDER_ID) {
                addBtn.style.display = 'none';
                actionHeader.style.display = 'none';
                renderMasterProducts();
            } else {
                addBtn.style.display = 'flex';
                actionHeader.style.display = 'table-cell';
                renderFolderProducts();
            }
            openView('folder-content-view');
        }

        function renderMasterProducts() {
            const body = document.getElementById('folder-products-table-body');
            body.innerHTML = '';
            const allFolders = getFolders().filter(f => f.parent === 'products-menu');
            let masterData = [];
            allFolders.forEach(folder => {
                const folderProducts = JSON.parse(localStorage.getItem(`folder_data_${folder.id}`) || '[]');
                masterData = masterData.concat(folderProducts);
            });
            masterData.forEach((p, idx) => {
                body.innerHTML += `<tr><td>${idx + 1}</td><td>${p.item}</td><td>${p.desc}</td><td>${p.unit}</td><td>${p.price}</td><td style="display:none;"></td></tr>`;
            });
        }

        function openProductEntryModal(existingProduct = null, idx = -1) {
            document.getElementById('p-modal-title').innerText = existingProduct ? "Edit Product Info" : "Add Product Info";
            document.getElementById('p-item').value = existingProduct ? existingProduct.item : '';
            document.getElementById('p-desc').value = existingProduct ? existingProduct.desc : '';
            document.getElementById('p-unit').value = existingProduct ? existingProduct.unit : '';
            document.getElementById('p-price').value = existingProduct ? existingProduct.price : '';
            document.getElementById('p-edit-idx').value = idx;
            document.getElementById('product-entry-modal').style.display = 'flex';
        }

        function saveProductEntry() {
            const item = document.getElementById('p-item').value;
            const desc = document.getElementById('p-desc').value;
            const unit = document.getElementById('p-unit').value;
            const price = document.getElementById('p-price').value;
            const editIdx = parseInt(document.getElementById('p-edit-idx').value);

            if(!item) return alert("Enter item name");
            const storageKey = `folder_data_${currentActiveFolderId}`;
            let data = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            if(editIdx > -1) {
                data[editIdx] = { item, desc, unit, price };
            } else {
                data.push({ item, desc, unit, price });
            }
            
            localStorage.setItem(storageKey, JSON.stringify(data));
            closeModal('product-entry-modal');
            renderFolderProducts();
        }

        function renderFolderProducts() {
            const body = document.getElementById('folder-products-table-body');
            body.innerHTML = '';
            const storageKey = `folder_data_${currentActiveFolderId}`;
            const data = JSON.parse(localStorage.getItem(storageKey) || '[]');
            data.forEach((p, idx) => {
                body.innerHTML += `<tr>
                    <td>${idx + 1}</td>
                    <td>${p.item}</td>
                    <td>${p.desc}</td>
                    <td>${p.unit}</td>
                    <td>${p.price}</td>
                    <td>
                        <button onclick="editProductEntry(${idx})" style="color:var(--accent-blue); border:none; background:none; cursor:pointer; margin-right:10px;"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteProductEntry(${idx})" style="color:#ef4444; border:none; background:none; cursor:pointer;"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            });
        }

        function editProductEntry(idx) {
            const storageKey = `folder_data_${currentActiveFolderId}`;
            const data = JSON.parse(localStorage.getItem(storageKey) || '[]');
            openProductEntryModal(data[idx], idx);
        }

        function deleteProductEntry(idx) {
            if(!confirm("Delete this entry?")) return;
            const storageKey = `folder_data_${currentActiveFolderId}`;
            let data = JSON.parse(localStorage.getItem(storageKey) || '[]');
            data.splice(idx, 1);
            localStorage.setItem(storageKey, JSON.stringify(data));
            renderFolderProducts();
        }

        function getClients() { return JSON.parse(localStorage.getItem('arvin_clients') || '[]'); }
        function saveClients(data) { localStorage.setItem('arvin_clients', JSON.stringify(data)); }
        
        function openClientModal(existingClient = null, idx = -1) { 
            document.getElementById('cl-modal-title').innerText = existingClient ? "Edit Client Info" : "Client Information";
            document.getElementById('cl-name').value = existingClient ? existingClient.name : '';
            document.getElementById('cl-address').value = existingClient ? existingClient.address : '';
            document.getElementById('cl-person').value = existingClient ? existingClient.person : '';
            document.getElementById('cl-phone').value = existingClient ? existingClient.phone : '';
            document.getElementById('cl-email').value = existingClient ? existingClient.email : '';
            document.getElementById('cl-edit-idx').value = idx;
            document.getElementById('client-modal').style.display = 'flex'; 
        }
        
        function saveClient() {
            const clients = getClients();
            const editIdx = parseInt(document.getElementById('cl-edit-idx').value);
            const clientData = {
                name: document.getElementById('cl-name').value,
                address: document.getElementById('cl-address').value,
                person: document.getElementById('cl-person').value,
                phone: document.getElementById('cl-phone').value,
                email: document.getElementById('cl-email').value
            };
            
            if(editIdx > -1) {
                clients[editIdx] = clientData;
            } else {
                clients.push(clientData);
            }

            saveClients(clients);
            renderClients();
            closeModal('client-modal');
        }

        function renderClients() {
            const body = document.getElementById('clients-table-body');
            body.innerHTML = '';
            getClients().forEach((c, idx) => {
                body.innerHTML += `<tr>
                    <td>${idx + 1}</td>
                    <td>${c.name}</td>
                    <td>${c.person}</td>
                    <td>${c.phone}</td>
                    <td>
                        <button onclick="editClient(${idx})" style="color:var(--accent-blue); border:none; background:none; cursor:pointer; margin-right:10px;"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteClient(${idx})" style="color:#ef4444; border:none; background:none; cursor:pointer;"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            });
        }

        function editClient(idx) {
            const clients = getClients();
            openClientModal(clients[idx], idx);
        }

        function deleteClient(idx) {
            if(!confirm("Delete client?")) return;
            const c = getClients();
            c.splice(idx, 1);
            saveClients(c);
            renderClients();
        }

        function getSuppliers() { return JSON.parse(localStorage.getItem('arvin_suppliers') || '[]'); }
        function saveSuppliers(data) { localStorage.setItem('arvin_suppliers', JSON.stringify(data)); }
        
        function openSupplierModal(existingSup = null, idx = -1) { 
            document.getElementById('sup-modal-title').innerText = existingSup ? "Edit Supplier Info" : "Supplier Information";
            document.getElementById('sup-org').value = existingSup ? existingSup.org : '';
            document.getElementById('sup-address').value = existingSup ? existingSup.address : '';
            document.getElementById('sup-person').value = existingSup ? existingSup.person : '';
            document.getElementById('sup-phone').value = existingSup ? existingSup.phone : '';
            document.getElementById('sup-email').value = existingSup ? existingSup.email : '';
            document.getElementById('sup-type').value = existingSup ? existingSup.type : '';
            document.getElementById('sup-edit-idx').value = idx;
            document.getElementById('supplier-modal').style.display = 'flex'; 
        }
        
        function saveSupplier() {
            const suppliers = getSuppliers();
            const editIdx = parseInt(document.getElementById('sup-edit-idx').value);
            const supData = {
                org: document.getElementById('sup-org').value,
                address: document.getElementById('sup-address').value,
                person: document.getElementById('sup-person').value,
                phone: document.getElementById('sup-phone').value,
                email: document.getElementById('sup-email').value,
                type: document.getElementById('sup-type').value
            };

            if(editIdx > -1) {
                suppliers[editIdx] = supData;
            } else {
                suppliers.push(supData);
            }

            saveSuppliers(suppliers);
            renderSuppliers();
            closeModal('supplier-modal');
        }

        function renderSuppliers() {
            const body = document.getElementById('supplier-table-body');
            body.innerHTML = '';
            getSuppliers().forEach((s, idx) => {
                body.innerHTML += `<tr>
                    <td>${idx + 1}</td>
                    <td>${s.org}</td>
                    <td>${s.type}</td>
                    <td>${s.phone}</td>
                    <td>
                        <button onclick="editSupplier(${idx})" style="color:var(--accent-blue); border:none; background:none; cursor:pointer; margin-right:10px;"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteSupplier(${idx})" style="color:#ef4444; border:none; background:none; cursor:pointer;"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            });
        }

        function editSupplier(idx) {
            const suppliers = getSuppliers();
            openSupplierModal(suppliers[idx], idx);
        }

        function deleteSupplier(idx) {
            if(!confirm("Delete supplier?")) return;
            const s = getSuppliers();
            s.splice(idx, 1);
            saveSuppliers(s);
            renderSuppliers();
        }

        function formatDate(dateStr) {
            if (!dateStr) return "";
            const [year, month, day] = dateStr.split('-');
            return `${day}.${month}.${year}`;
        }

        function generateReference() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const nums = '0123456789';
            let res = '';
            for(let i=0; i<3; i++) res += chars.charAt(Math.floor(Math.random() * chars.length));
            for(let i=0; i<3; i++) res += nums.charAt(Math.floor(Math.random() * nums.length));
            return res;
        }

        function encodeImg(input, prevId, storageKey) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onloadend = () => {
                const base64 = reader.result;
                localStorage.setItem(storageKey, base64);
                document.getElementById(prevId).src = base64;
                document.getElementById(prevId).style.display = 'block';
            };
            if(file) reader.readAsDataURL(file);
        }

        function saveSettings() {
            const settings = {
                compName: document.getElementById('set-comp-name').value,
                compSlogan: document.getElementById('set-comp-slogan').value,
                compAddr: document.getElementById('set-comp-addr').value,
                mobile: document.getElementById('set-comp-mobile').value,
                email: document.getElementById('set-comp-email').value,
                web: document.getElementById('set-comp-web').value,
                currency: document.getElementById('set-currency').value,
                sigName: document.getElementById('set-sig-name').value,
                sigDesig: document.getElementById('set-sig-desig').value,
                termsQ: document.getElementById('set-terms-q').value,
                termsInv: document.getElementById('set-terms-inv').value,
                termsCh: document.getElementById('set-terms-ch').value,
                termsPo: document.getElementById('set-terms-po').value,
                mTop: document.getElementById('set-m-top').value,
                mBottom: document.getElementById('set-m-bottom').value,
                mLeft: document.getElementById('set-m-left').value,
                mRight: document.getElementById('set-m-right').value
            };
            localStorage.setItem('arvin_settings', JSON.stringify(settings));
            document.getElementById('brand-header').innerText = settings.compName || "ARVIN CONTROLS";
            document.getElementById('brand-slogan').innerText = settings.compSlogan || "ENTERPRISE RESOURCE PLANNING";
            alert("Settings Updated!");
        }

        function loadSettings() {
            const s = JSON.parse(localStorage.getItem('arvin_settings') || '{}');
            document.getElementById('set-comp-name').value = s.compName || '';
            document.getElementById('set-comp-slogan').value = s.compSlogan || '';
            document.getElementById('set-comp-addr').value = s.compAddr || '';
            document.getElementById('set-comp-mobile').value = s.mobile || '';
            document.getElementById('set-comp-email').value = s.email || '';
            document.getElementById('set-comp-web').value = s.web || '';
            document.getElementById('set-currency').value = s.currency || '';
            document.getElementById('set-sig-name').value = s.sigName || '';
            document.getElementById('set-sig-desig').value = s.sigDesig || '';
            document.getElementById('set-terms-q').value = s.termsQ || '';
            document.getElementById('set-terms-inv').value = s.termsInv || '';
            document.getElementById('set-terms-ch').value = s.termsCh || '';
            document.getElementById('set-terms-po').value = s.termsPo || '';
            document.getElementById('set-m-top').value = s.mTop || '0.5';
            document.getElementById('set-m-bottom').value = s.mBottom || '0.5';
            document.getElementById('set-m-left').value = s.mLeft || '0.5';
            document.getElementById('set-m-right').value = s.mRight || '0.5';
            ['logo', 'seal', 'auth-sig'].forEach(key => {
                const data = localStorage.getItem('data-' + key);
                if(data) {
                    const prev = document.getElementById('prev-' + key);
                    prev.src = data; prev.style.display = 'block';
                }
            });
        }

        function renderCard(gridId, docId, color, icon) {
            const grid = document.getElementById(gridId);
            if(!grid) return;
            const card = document.createElement('a');
            card.className = "nav-card";
            card.id = "card-" + docId;
            card.onclick = () => showActions(docId);
            card.innerHTML = `<div class="icon-bg" style="background:${color}"></div><i class="fas ${icon}" style="color:${color}"></i><span>${docId}</span>`;
            grid.appendChild(card);
        }

        function showActions(docId) {
            selectedDocId = docId;
            document.getElementById('action-target-id').innerText = docId;
            const doc = getDocs().find(d => d.id === docId);
            const conv = document.getElementById('convert-options');
            if(doc && doc.type === 'QUOTATION') {
                conv.style.display = 'flex';
            } else {
                conv.style.display = 'none';
            }
            document.getElementById('action-modal').style.display = 'flex';
        }

        function convertDoc(targetType) {
            const sourceDoc = getDocs().find(d => d.id === selectedDocId);
            if(!sourceDoc) return;
            
            const prefix = targetType === 'INVOICE' ? 'AC-INV-' : 'AC-DC-';
            const lastId = localStorage.getItem(`last_id_${targetType}`) || 10049;
            const newId = prefix + (parseInt(lastId) + 1);
            
            const newDoc = {
                ...sourceDoc,
                type: targetType,
                id: newId,
                date: new Date().toISOString().split('T')[0],
                grid: 'grid-' + targetType.toLowerCase()
            };

            // Mapping specific fields
            if(targetType === 'INVOICE') {
                newDoc.orderId = sourceDoc.reference || '';
            } else if (targetType === 'CHALLAN') {
                newDoc.orderId = sourceDoc.reference || '';
                newDoc.items = sourceDoc.items.map(it => ({...it, remarks: ''}));
            }

            updateOrSave(newDoc);
            closeModal('action-modal');
            alert(`Converted to ${targetType}: ${newId}`);
            openView('folder-' + targetType.toLowerCase());
        }

        async function triggerDownload(mode = 'download') {
            const doc = getDocs().find(d => d.id === selectedDocId);
            const s = JSON.parse(localStorage.getItem('arvin_settings') || '{}');
            const element = document.getElementById('pdf-template');
            const innerContent = document.getElementById('pdf-inner-content');
            element.style.display = 'block'; 
            const mTop = parseFloat(s.mTop) || 0.5;
            const mBottom = parseFloat(s.mBottom) || 0.5;
            const mLeft = parseFloat(s.mLeft) || 0.5;
            const mRight = parseFloat(s.mRight) || 0.5;
            innerContent.style.minHeight = (11.69 - (mTop + mBottom)) + "in";
            document.getElementById('pdf-comp-name').innerText = s.compName || "ARVIN CONTROLS";
            document.getElementById('pdf-for-comp').innerText = s.compName || "ARVIN CONTROLS";
            document.getElementById('pdf-comp-addr-line').innerText = s.compAddr || ""; 
            document.getElementById('pdf-comp-contact-line').innerText = `Mobile: ${s.mobile || ''} | Email: ${s.email || ''} | Website: ${s.web || ''}`;
            document.getElementById('pdf-footer-slogan').innerText = s.compSlogan || "";
            const logo = localStorage.getItem('data-logo');
            if(logo) { document.getElementById('pdf-comp-logo').src = logo; document.getElementById('pdf-comp-logo').style.display = 'block'; }
            document.getElementById('pdf-type-label').innerText = doc.type;
            document.getElementById('pdf-id').innerText = doc.id;
            document.getElementById('pdf-date').innerText = formatDate(doc.date);
            document.getElementById('pdf-client-name').innerText = doc.client;
            document.getElementById('pdf-client-addr').innerText = getClientAddrFromStorage(doc.client);
            const orderRow = document.getElementById('pdf-order-row');
            const orderLabel = document.getElementById('pdf-ref-label');
            const orderVal = document.getElementById('pdf-order-id');
            if(doc.type === 'QUOTATION' && doc.reference) {
                orderRow.style.display = 'table-row';
                orderLabel.innerText = 'Ref No:';
                orderVal.innerText = doc.reference;
            } else if (doc.orderId) {
                orderRow.style.display = 'table-row';
                orderLabel.innerText = 'Order No:';
                orderVal.innerText = doc.orderId;
            } else { orderRow.style.display = 'none'; }
            document.getElementById('pdf-gate-row').style.display = doc.gatePass ? 'table-row' : 'none';
            document.getElementById('pdf-gate-id').innerText = doc.gatePass || '';
            if ((doc.type === 'QUOTATION' || doc.type === 'PO') && doc.subject) {
                document.getElementById('pdf-subject-container').style.display = 'block';
                document.getElementById('pdf-subject-text').innerText = doc.subject;
            } else { document.getElementById('pdf-subject-container').style.display = 'none'; }
            document.getElementById('pdf-receiver-section').style.visibility = (doc.type === 'CHALLAN') ? 'visible' : 'hidden';
            if(doc.type === 'RECEIPT') {
                document.getElementById('pdf-terms-section').style.display = 'none';
                document.getElementById('pdf-mr-container').style.display = 'block';
                document.getElementById('pdf-standard-table').style.display = 'none';
                document.getElementById('pdf-words-container').style.display = 'none'; 
                document.getElementById('pdf-mr-amount').innerText = parseFloat(doc.amount).toLocaleString();
                document.getElementById('pdf-mr-words-text').innerText = doc.words;
                document.getElementById('pdf-mr-mode').innerText = doc.mode;
                document.getElementById('pdf-mr-extra').innerText = doc.mode === 'Cheque' ? `(Chq: ${doc.chqNo}, ${doc.bank})` : '';
                document.getElementById('pdf-mr-curr').innerText = s.currency || '';
            } else {
                document.getElementById('pdf-mr-container').style.display = 'none';
                document.getElementById('pdf-standard-table').style.display = 'block';
                document.getElementById('pdf-words-container').style.display = (doc.type === 'CHALLAN') ? 'none' : 'block';
                const thead = document.getElementById('pdf-table-head-container');
                const tbody = document.getElementById('pdf-table-body');
                const tfoot = document.getElementById('pdf-table-foot-container');
                tbody.innerHTML = ''; tfoot.innerHTML = '';
                let headHtml = '';
                const isChallan = doc.type === 'CHALLAN';
                if(isChallan) {
                    headHtml = `<tr style="background: #f8f8f8;"><th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 30px;">SL</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Items</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Description</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 40px;">Qty</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 40px;">Unit</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Remarks</th></tr>`;
                } else {
                    headHtml = `<tr style="background: #f8f8f8;"><th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 30px;">SL</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Items</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Description</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 40px;">Qty</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 40px;">Unit</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 70px;">Unit Price</th><th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 80px;">Total Price</th></tr>`;
                }
                thead.innerHTML = headHtml;
                let subtotal = 0;
                doc.items.forEach((it, idx) => {
                    subtotal += it.total;
                    let rowHtml = `<tr><td style="padding:8px; border:1px solid #ddd; text-align:center;">${idx + 1}</td><td style="padding:8px; border:1px solid #ddd; text-align:left;">${it.name || ''}</td><td style="padding:8px; border:1px solid #ddd; text-align:left;">${it.desc || ''}</td><td style="padding:8px; border:1px solid #ddd; text-align:center;">${it.qty}</td><td style="padding:8px; border:1px solid #ddd; text-align:center;">${it.unit || ''}</td>`;
                    if(isChallan) { rowHtml += `<td style="padding:8px; border:1px solid #ddd; text-align:center;">${it.remarks || ''}</td>`; }
                    else { rowHtml += `<td style="padding:8px; border:1px solid #ddd; text-align:center;">${(it.price || 0).toLocaleString(undefined, {minimumFractionDigits: 2})}</td><td style="padding:8px; border:1px solid #ddd; text-align:center;">${(it.total || 0).toLocaleString(undefined, {minimumFractionDigits: 2})}</td>`; }
                    rowHtml += `</tr>`;
                    tbody.innerHTML += rowHtml;
                });
                if(!isChallan) {
                    const vatAmt = (parseFloat(doc.vat) || 0) / 100 * subtotal;
                    const aitAmt = (parseFloat(doc.ait) || 0) / 100 * subtotal;
                    const grandTotal = subtotal + vatAmt + aitAmt;
                    const paidAmt = parseFloat(doc.paid) || 0;
                    const dueAmt = grandTotal - paidAmt;
                    const curr = s.currency || '';
                    let footHtml = `<tr><td colspan="5" style="padding:8px; border:1px solid #ddd; text-align:right; font-weight:bold;">Sub Total</td><td colspan="2" style="padding:8px; border:1px solid #ddd; text-align:center; font-weight:bold;">${curr} ${subtotal.toLocaleString(undefined, {minimumFractionDigits: 2})}</td></tr>`;
                    if(vatAmt > 0) footHtml += `<tr><td colspan="5" style="padding:8px; border:1px solid #ddd; text-align:right;">VAT (${doc.vat}%)</td><td colspan="2" style="padding:8px; border:1px solid #ddd; text-align:center;">${vatAmt.toLocaleString(undefined, {minimumFractionDigits: 2})}</td></tr>`;
                    if(aitAmt > 0) footHtml += `<tr><td colspan="5" style="padding:8px; border:1px solid #ddd; text-align:right;">AIT (${doc.ait}%)</td><td colspan="2" style="padding:8px; border:1px solid #ddd; text-align:center;">${aitAmt.toLocaleString(undefined, {minimumFractionDigits: 2})}</td></tr>`;
                    footHtml += `<tr style="background:#f0f9ff;"><td colspan="5" style="padding:8px; border:1px solid #ddd; text-align:right; font-weight:800; color:#000;">GRAND TOTAL</td><td colspan="2" style="padding:8px; border:1px solid #ddd; text-align:center; font-weight:800; color:#000;">${curr} ${grandTotal.toLocaleString(undefined, {minimumFractionDigits: 2})}</td></tr>`;
                    
                    if(doc.type === 'INVOICE') {
                        footHtml += `<tr><td colspan="5" style="padding:8px; border:1px solid #ddd; text-align:right; font-weight:bold; color: #4ade80;">Paid Amount</td><td colspan="2" style="padding:8px; border:1px solid #ddd; text-align:center; font-weight:bold; color: #4ade80;">${curr} ${paidAmt.toLocaleString(undefined, {minimumFractionDigits: 2})}</td></tr>`;
                        footHtml += `<tr><td colspan="5" style="padding:8px; border:1px solid #ddd; text-align:right; font-weight:bold; color: #ef4444;">Due Amount</td><td colspan="2" style="padding:8px; border:1px solid #ddd; text-align:center; font-weight:bold; color: #ef4444;">${curr} ${dueAmt.toLocaleString(undefined, {minimumFractionDigits: 2})}</td></tr>`;
                        document.getElementById('pdf-grand-words').innerText = numberToWords(Math.round(dueAmt)) + " Taka Only";
                    } else {
                        document.getElementById('pdf-grand-words').innerText = numberToWords(Math.round(grandTotal)) + " Taka Only";
                    }
                    tfoot.innerHTML = footHtml;
                }
            }
            const seal = localStorage.getItem('data-seal');
            if(seal) { document.getElementById('pdf-seal').src = seal; document.getElementById('pdf-seal').style.display = 'block'; }
            const auth = localStorage.getItem('data-auth-sig');
            if(auth) { document.getElementById('pdf-auth-sig').src = auth; document.getElementById('pdf-auth-sig').style.display = 'block'; }
            document.getElementById('pdf-sig-name').innerText = s.sigName || "";
            document.getElementById('pdf-sig-desig').innerText = s.sigDesig || "";
            const opt = { margin: [mTop, mLeft, mBottom, mRight], filename: `${doc.id}.pdf`, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, useCORS: true }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } };
            const worker = html2pdf().set(opt).from(element);
            if(mode === 'download') worker.save().then(() => { element.style.display = 'none'; });
            else if (mode === 'print') worker.toPdf().get('pdf').then(function (pdf) { window.open(pdf.output('bloburl'), '_blank').print(); element.style.display = 'none'; });
            else if (mode === 'share') worker.outputPdf('blob').then(function (blob) { element.style.display = 'none'; const file = new File([blob], `${doc.id}.pdf`, { type: 'application/pdf' }); if (navigator.canShare && navigator.canShare({ files: [file] })) { navigator.share({ files: [file], title: doc.id }); } else { window.open(`https://wa.me/?text=Arvin%20Controls%20${doc.type}%20${doc.id}`, '_blank'); } });
            closeModal('action-modal');
        }

        function triggerDelete() {
            if(!confirm("Delete?")) return;
            let docs = getDocs();
            docs = docs.filter(d => d.id !== selectedDocId);
            saveDocs(docs);
            document.getElementById('card-' + selectedDocId).remove();
            closeModal('action-modal');
        }

        function triggerEdit() {
            const doc = getDocs().find(d => d.id === selectedDocId);
            closeModal('action-modal');
            if(doc.type === 'RECEIPT') openMR(doc);
            else openDocModal(doc.type, doc);
        }

        function openDocModal(type, existingDoc = null) {
            currentDocType = type;
            docItems = existingDoc ? [...existingDoc.items] : [];
            document.getElementById('doc-modal').style.display = 'flex';
            const extras = document.getElementById('extra-fields');
            const taxDiv = document.getElementById('tax-fields');
            const paymentDiv = document.getElementById('payment-fields');
            extras.innerHTML = '';
            taxDiv.style.display = (type === 'QUOTATION' || type === 'PO') ? 'grid' : 'none';
            paymentDiv.style.display = (type === 'INVOICE') ? 'block' : 'none';
            document.getElementById('doc-vat').value = existingDoc ? (existingDoc.vat || 0) : 0;
            document.getElementById('doc-ait').value = existingDoc ? (existingDoc.ait || 0) : 0;
            document.getElementById('doc-paid').value = existingDoc ? (existingDoc.paid || 0) : 0;
            let prefix = ''; let tableHead = '';
            if(type === 'QUOTATION') { prefix = 'AC-Q-'; tableHead = '<th>Item</th><th>Qty</th><th>Price</th><th>Total</th>'; extras.innerHTML = `<div class="form-group"><label>Reference</label><input type="text" id="extra-ref" readonly></div><div class="form-group"><label>Subject</label><input type="text" id="extra-sub"></div>`; }
            else if (type === 'INVOICE') { prefix = 'AC-INV-'; tableHead = '<th>Item</th><th>Qty</th><th>Price</th><th>Total</th>'; extras.innerHTML = `<div class="form-group"><label>Order ID</label><input type="text" id="extra-order"></div>`; }
            else if (type === 'CHALLAN') { prefix = 'AC-DC-'; tableHead = '<th>Item</th><th>Desc</th><th>Qty</th><th>Remarks</th>'; extras.innerHTML = `<div style="display:flex; gap:10px;"><div class="form-group" style="flex:1;"><label>Order ID</label><input type="text" id="extra-order"></div><div class="form-group" style="flex:1;"><label>Gate Pass</label><input type="text" id="extra-gate"></div></div>`; }
            else if (type === 'PO') { prefix = 'AC-PO-'; tableHead = '<th>Desc</th><th>Qty</th><th>Price</th><th>Total</th>'; extras.innerHTML = `<div class="form-group"><label>Subject</label><input type="text" id="extra-sub"></div>`; }
            
            if(existingDoc) {
                document.getElementById('doc-id').value = existingDoc.id;
                document.getElementById('doc-date').value = existingDoc.date;
                document.getElementById('doc-client').value = existingDoc.client;
                if(document.getElementById('extra-ref')) document.getElementById('extra-ref').value = existingDoc.reference || '';
                if(document.getElementById('extra-order')) document.getElementById('extra-order').value = existingDoc.orderId || '';
                if(document.getElementById('extra-gate')) document.getElementById('extra-gate').value = existingDoc.gatePass || '';
                if(document.getElementById('extra-sub')) document.getElementById('extra-sub').value = existingDoc.subject || '';
                document.getElementById('doc-address').value = getClientAddrFromStorage(existingDoc.client);
            } else {
                const lastId = localStorage.getItem(`last_id_${type}`) || 10049;
                document.getElementById('doc-id').value = prefix + (parseInt(lastId) + 1);
                document.getElementById('doc-date').valueAsDate = new Date();
                document.getElementById('doc-client').value = '';
                document.getElementById('doc-address').value = '';
                if(type === 'QUOTATION') document.getElementById('extra-ref').value = generateReference();
            }
            document.getElementById('doc-table-head').innerHTML = tableHead;
            renderDocTable();
        }

        function openMR(existingDoc = null) {
            document.getElementById('mr-modal').style.display = 'flex';
            if(existingDoc) {
                document.getElementById('mr-id').value = existingDoc.id;
                document.getElementById('mr-date').value = existingDoc.date;
                document.getElementById('mr-client').value = existingDoc.client;
                document.getElementById('mr-amount').value = existingDoc.amount;
                document.getElementById('mr-words').value = existingDoc.words;
                document.getElementById('mr-mode').value = existingDoc.mode;
                toggleChequeFields();
                if(existingDoc.mode === 'Cheque') { document.getElementById('mr-chq-no').value = existingDoc.chqNo; document.getElementById('mr-bank').value = existingDoc.bank; }
                document.getElementById('mr-address').value = getClientAddrFromStorage(existingDoc.client);
            } else {
                const lastId = localStorage.getItem('last_id_RECEIPT') || 10049;
                document.getElementById('mr-id').value = 'AC-MR-' + (parseInt(lastId) + 1);
                document.getElementById('mr-date').valueAsDate = new Date();
                document.getElementById('mr-amount').value = ''; document.getElementById('mr-words').value = '';
                document.getElementById('mr-client').value = ''; document.getElementById('mr-address').value = '';
            }
        }

        function updateWords() {
            const amt = document.getElementById('mr-amount').value;
            document.getElementById('mr-words').value = numberToWords(amt) + " Taka Only";
        }

        function numberToWords(num) {
            if (!num || isNaN(num)) return "";
            const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
            const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Five', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
            if (!n) return '';
            let str = '';
            str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'Crore ' : '';
            str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'Lakh ' : '';
            str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'Thousand ' : '';
            str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'Hundred ' : '';
            str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) : '';
            return str.trim();
        }

        function saveDocument() {
            const id = document.getElementById('doc-id').value;
            const docData = {
                type: currentDocType, id, date: document.getElementById('doc-date').value,
                client: document.getElementById('doc-client').value, grid: 'grid-' + currentDocType.toLowerCase(),
                items: docItems, 
                vat: document.getElementById('doc-vat').value || 0,
                ait: document.getElementById('doc-ait').value || 0,
                paid: document.getElementById('doc-paid')?.value || 0,
                orderId: document.getElementById('extra-order')?.value || '',
                reference: document.getElementById('extra-ref')?.value || '',
                gatePass: document.getElementById('extra-gate')?.value || '', 
                subject: document.getElementById('extra-sub')?.value || ''
            };
            updateOrSave(docData);
            closeModal('doc-modal');
        }

        function saveMoneyReceipt() {
            const id = document.getElementById('mr-id').value;
            const docData = {
                type: 'RECEIPT', id, date: document.getElementById('mr-date').value,
                client: document.getElementById('mr-client').value, amount: document.getElementById('mr-amount').value,
                words: document.getElementById('mr-words').value,
                mode: document.getElementById('mr-mode').value, chqNo: document.getElementById('mr-chq-no').value,
                bank: document.getElementById('mr-bank').value, grid: 'grid-receipt'
            };
            updateOrSave(docData);
            closeModal('mr-modal');
        }

        function updateOrSave(newDoc) {
            let docs = getDocs();
            const index = docs.findIndex(d => d.id === newDoc.id);
            if(index > -1) docs[index] = newDoc;
            else {
                docs.push(newDoc);
                localStorage.setItem(`last_id_${newDoc.type}`, newDoc.id.split('-').pop());
                renderCard(newDoc.grid, newDoc.id, (newDoc.type === 'RECEIPT' ? '#34d399' : '#c084fc'), (newDoc.type === 'RECEIPT' ? 'fa-receipt' : 'fa-file-contract'));
            }
            saveDocs(docs);
        }

        function renderDocTable() {
            const body = document.getElementById('doc-table-body');
            const foot = document.getElementById('doc-table-foot');
            const s = JSON.parse(localStorage.getItem('arvin_settings') || '{}');
            const curr = s.currency || '';
            body.innerHTML = ''; let subtotal = 0;
            docItems.forEach(it => {
                subtotal += it.total;
                if(currentDocType === 'CHALLAN') body.innerHTML += `<tr><td>${it.name}</td><td>${it.desc}</td><td>${it.qty}</td><td>${it.remarks}</td></tr>`;
                else body.innerHTML += `<tr><td>${it.name||it.desc}</td><td>${it.qty}</td><td>${it.price}</td><td>${it.total.toFixed(2)}</td></tr>`;
            });
            if(currentDocType !== 'CHALLAN') {
                const vat = parseFloat(document.getElementById('doc-vat').value) || 0;
                const ait = parseFloat(document.getElementById('doc-ait').value) || 0;
                const grandTotal = subtotal + (vat/100 * subtotal) + (ait/100 * subtotal);
                let footHtml = `<tr class="grand-total-row"><td colspan="3">Grand Total</td><td>${curr} ${grandTotal.toLocaleString()}.00</td></tr>`;
                if(currentDocType === 'INVOICE') {
                    const paid = parseFloat(document.getElementById('doc-paid').value) || 0;
                    const due = grandTotal - paid;
                    footHtml += `<tr><td colspan="3" style="color:#4ade80">Paid Amount</td><td>${curr} ${paid.toLocaleString()}</td></tr>`;
                    footHtml += `<tr><td colspan="3" style="color:#ef4444">Due Amount</td><td>${curr} ${due.toLocaleString()}</td></tr>`;
                }
                foot.innerHTML = footHtml;
            } else { foot.innerHTML = ''; }
        }

        function openItemModal() {
            document.getElementById('item-modal').style.display = 'flex';
            document.getElementById('item-remarks-field').style.display = (currentDocType === 'CHALLAN') ? 'block' : 'none';
            document.getElementById('item-price-field').style.display = (currentDocType === 'CHALLAN') ? 'none' : 'block';
            document.getElementById('item-select').value = '';
            document.getElementById('item-desc').value = '';
            document.getElementById('item-qty').value = '';
            document.getElementById('item-unit').value = '';
            document.getElementById('item-price').value = '';
            document.getElementById('item-remarks').value = '';
        }

        function addItemToList() {
            const item = {
                name: document.getElementById('item-select').value, desc: document.getElementById('item-desc').value,
                qty: parseFloat(document.getElementById('item-qty').value) || 0, unit: document.getElementById('item-unit').value,
                price: parseFloat(document.getElementById('item-price').value) || 0, remarks: document.getElementById('item-remarks').value
            };
            item.total = item.qty * item.price;
            docItems.push(item);
            renderDocTable();
            closeModal('item-modal');
        }

        function getClientAddrFromStorage(name) {
            const clients = getClients();
            const c = clients.find(client => client.name === name);
            return c ? c.address : "";
        }

        function autoFillItem() {
            // Not needed anymore since we use autocomplete
        }

        function autoFillAddress() { 
            // Not needed anymore since we use autocomplete
        }

        function autoFillAddressMR() { 
            // Not needed anymore since we use autocomplete
        }

        function toggleChequeFields() { document.getElementById('cheque-details').style.display = (document.getElementById('mr-mode').value === 'Cheque' ? 'block' : 'none'); }

        /** SYNC LOGIC **/
        function syncAllData() {
            const s = JSON.parse(localStorage.getItem('arvin_settings') || '{}');
            if(s.compName) document.getElementById('brand-header').innerText = s.compName;
            if(s.compSlogan) document.getElementById('brand-slogan').innerText = s.compSlogan;
            
            // Re-render view dependent data if active
            const activeView = document.querySelector('.view-container.active')?.id;
            if(activeView === 'settings-view') loadSettings();
            if(activeView === 'clients-view') renderClients();
            if(activeView === 'supplier-view') renderSuppliers();
            if(activeView === 'inventory-view') renderInventory();
            if(activeView === 'products-menu') renderFolders('products-menu');
            if(activeView === 'documents-menu') renderTabFolders('documents-menu');
            if(activeView === 'projects-menu') renderTabFolders('projects-menu');
            if(activeView === 'workorder-menu') renderTabFolders('workorder-menu');
            if(activeView === 'category-management-view') renderCategories();
            if(activeView === 'documents-category-management') renderTabCategories('documents');
            if(activeView === 'projects-category-management') renderTabCategories('projects');
            if(activeView === 'workorder-category-management') renderTabCategories('workorder');
            if(activeView === 'folder-content-view') {
                 if(currentActiveFolderId === MASTER_LIST_FOLDER_ID) renderMasterProducts();
                 else renderFolderProducts();
            }
            if(activeView === 'folder-income') renderIncome();
            if(activeView === 'folder-expense') renderExpense();
            if(activeView === 'folder-transactions') renderTransactions();
            if(activeView === 'folder-workorder-summary') renderWorkOrders();
            if(activeView === 'documents-folder-files-view') renderFolderFiles('documents');
            if(activeView === 'projects-folder-files-view') renderFolderFiles('projects');
            if(activeView === 'workorder-folder-files-view') renderFolderFiles('workorder');

            // Sync Commercial Cards
            ['grid-quotation', 'grid-invoice', 'grid-challan', 'grid-po', 'grid-receipt'].forEach(gid => {
                const grid = document.getElementById(gid);
                if(grid) {
                    const header = grid.querySelector('.nav-header');
                    grid.innerHTML = '';
                    if(header) grid.appendChild(header);
                    getDocs().filter(d => d.grid === gid).forEach(d => {
                        let icon = d.type === 'RECEIPT' ? 'fa-receipt' : 'fa-file-contract';
                        let col = d.type === 'RECEIPT' ? '#34d399' : '#c084fc';
                        renderCard(gid, d.id, col, icon);
                    });
                }
            });
        }

        window.onload = () => {
            syncAllData();
            // Listen for changes from other tabs
            window.addEventListener('storage', (e) => {
                syncAllData();
            });
            
            // Update viewNameMap with new views
            viewNameMap['documents-category-management'] = 'Documents Folder Management';
            viewNameMap['projects-category-management'] = 'Projects Folder Management';
            viewNameMap['workorder-category-management'] = 'Work Order Folder Management';
        };
    </script>
</body>
</html>